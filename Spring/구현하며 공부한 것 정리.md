### ğŸ’» í”„ë¡œì íŠ¸ë¥¼ ë§Œë“¤ì–´ ë”°ë¡œ ì ê¸° ì• ë§¤í•œ ê³µë¶€ë‚´ìš© ì •ë¦¬~

# ğŸ“Œ ì´ë¯¸ì§€ ì „ì†¡
***
- ### Html form
````html
<form id="input-image" method="post" enctype="multipart/form-data">
    <input type="file" name="image" >
    <button type="button" class="btn btn-success" id="btn-upload">íŒŒì¼ ì—…ë¡œë“œ</button>
</form>
````
- inputì— enctypeì„ ì£¼ë©´ ì´ë¯¸ì§€ë¥¼ multipart/form-dataë¡œ ì „ì†¡ ê°€ëŠ¥. 
- multipleì„ ì£¼ë©´ ì—¬ëŸ¬ê°œì˜ íŒŒì¼ë„ ì—…ë¡œë“œ ê°€ëŠ¥í•˜ë‹¤.

- ### Ajax
````javascript
 upload : function () {
        var formData = new FormData($('#input-image')[0]);
        console.log(formData);

        $.ajax({
            type: 'POST',
            url: '/api/input',
            data: formData,
            enctype: 'multipart/form-data',
            processData: false,
            contentType: false,
            dataType: 'text',
            success: function (result) {
                alert("íŒŒì¼ ì—…ë¡œë“œ ì™„ë£Œ.");
                window.location.href = "/wait-page";
            },
            error: function (e) {
                alert("íŒŒì¼ ì—…ë¡œë“œ ì‹¤íŒ¨: " + JSON.stringify(e));
            }
        });
    }
````
-  Post ë°©ì‹ìœ¼ë¡œ ì „ì†¡. ì²˜ìŒì—ëŠ” dataTypeì„ jsonìœ¼ë¡œ í–ˆì—ˆëŠ”ë°, ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ë°ì´í„°ëŠ” ìˆ˜ì‹ í•˜ì—¬
status 200 codeë¥¼ ë°›ì§€ë§Œ ë°˜í™˜ í˜•ì‹ì´ ë§ì§€ì•Šì•„ errorê°€ ë°œìƒí•˜ì˜€ë‹¤. ë•Œë¬¸ì— ë¦¬í„´ íƒ€ì…ì— ë§ì¶° textë¡œ ë³€ê²½.

- ### Controller
````java
@PostMapping("/api/input")
    public @ResponseBody void inputSaveTest( @RequestParam("image")MultipartFile image) throws IOException {
        String filePath="/Users/kimtaejun/Desktop/Capstone/pidetection/src/main/java/com/back/pidetection/web/";

        String fileName = image.getOriginalFilename();
        System.out.println("íŒŒì¼ ì´ë¦„ : "+fileName);
        byte[] im = image.getBytes();
        long fileSize = (long)im.length;
        System.out.println("íŒŒì¼ í¬ê¸° : "+im.length);

        try{
            image.transferTo(new File(filePath + fileName));

        } catch (IOException e) {
            System.out.println("ì‚¬ìš©ì ì´ë¯¸ì§€ ì €ì¥ ì‹¤íŒ¨.");
            e.printStackTrace();
        }
        System.out.println("ì‚¬ìš©ì ì´ë¯¸ì§€ ì €ì¥ ì„±ê³µ.");

    }
````
- @ResponseBody ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë©´ ajaxì—ì„œ ì‘ë‹µì„ ë°›ì§€ ëª»í•´ errorë¡œ íŒë‹¨í•œë‹¤.     
- RequestParamì—ì„œ ì•„ê¹Œ inputì˜ nameìœ¼ë¡œ ì…ë ¥í•˜ì˜€ë˜ "image"ë¥¼ ì„¤ì •í•˜ê³ , MultipartFile í˜•ì‹ìœ¼ë¡œ ë°ì´í„°ë¥¼ ìˆ˜ì‹ í•œë‹¤.     
- ì´ë¦„, í¬ê¸° ë“±ì˜ ì •ë³´ë¥¼ ì–»ê³  transferTo ë©”ì†Œë“œë¥¼ ì´ìš©í•˜ì—¬ íŒŒì¼ì„ ì €ì¥í•œë‹¤.


# ğŸ“Œ RestTemplate
****
> kakao SDK API ìš”ì²­ì„ ë³´ë‚´ê¸° ìœ„í•´ ì‚¬ìš©.


```java
public JsonNode getInfoByToken(String token) {
        HttpHeaders headers = new HttpHeaders();
        headers.add("Content-type", "application/x-www-form-urlencoded;charset=utf-8");
        headers.add("Authorization", "Bearer " + token);

        HttpEntity entity = new HttpEntity(headers);

        try {
            ResponseEntity<JsonNode> responseEntity = restTemplate.postForEntity("https://kapi.kakao.com/v2/user/me", entity, JsonNode.class);
            if (responseEntity.getStatusCode().is2xxSuccessful()) {
                return responseEntity.getBody();
            }
        }catch (Exception e) {
            log.error(e.getMessage());
        }
        return null;
    }
```
- HttpHeaders ì— í—¤ë”ë¥¼ ì¶”ê°€í•´ ì£¼ê³  HttpEntityë¥¼ ìƒì„±í•˜ì˜€ë‹¤.
- ì´ë¥¼ RestTemplateì˜ postForEntity ë©”ì„œë“œë¥¼ ì´ìš©í•˜ì—¬ Post ìš”ì²­ì„ ë³´ëƒˆë‹¤.
- ì‘ë‹µ ë°ì´í„°ëŠ” JsonNode í˜•ì‹ìœ¼ë¡œ ë°›ì•„ ê°’ì„ êº¼ë‚´ê¸° ì‰½ê²Œ í–ˆë‹¤.
- getForEntity, excute, exchage ë“±ì˜ ë©”ì†Œë“œë¡œ ë‹¤ì–‘í•œ í˜•ì‹ìœ¼ë¡œ ìš”ì²­ì„ ë³´ë‚¼ ìˆ˜ ìˆë‹¤.


# ğŸ“Œ Cache
***
```xml
implementation 'org.springframework.boot:spring-boot-starter-cache:2.5.3'
implementation 'org.ehcache:ehcache:3.9.5'
implementation 'javax.cache:cache-api:1.1.1'
```


- ### springBoot Cache

 ```java
import java.util.concurrent.ConcurrentHashMap;

@Configuration
@EnableCaching
public class CachingConfig {

    @Bean
    public CacheManager cacheManager() {
        SimpleCacheManager cacheManager = new SimpleCacheManager();
        cacheManager.setCaches(Arrays.asList(
                new ConcurrentMapCache("test1"), new ConcurrentHashMap("test2")));
        return cacheManager;
    }
}
```
- ê¸°ë³¸ì ìœ¼ë¡œ ConcurrentMapCacheë¥¼ ì‚¬ìš©

- ### @Cacheable
```java
@Cacheable(cacheNames = "test1", key = "#param1")
public String test1(String param1){
               ...
        
    return result;
}
```
> - í•´ë‹¹ ë°ì´í„°ê°€ ìºì‹œì— ì¡´ì¬í•œë‹¤ë©´ ë§Œë£Œë˜ê±°ë‚˜ ì—…ë°ì´íŠ¸ í•˜ê¸° ì „ì—ëŠ” ë©”ì„œë“œë¥¼ ì‹¤í–‰í•˜ì§€ ì•Šê³  ìºì‹œì—ì„œ ê°’ì„ ëŒë ¤ì¤€ë‹¤.
> - ìµœì´ˆ ì‹¤í–‰ì‹œ test1ì— key=param1, value = resultë¡œ ìºì‹±.

- ### CachePut
```java
@CachePut(cacheNames = "test1", key = "#param1")
public String test1(String param1){
               ...
        
    return result;
}
```
> - Cacheableê³¼ ìœ ì‚¬í•˜ì§€ë§Œ í•­ìƒ ë©”ì„œë“œë¥¼ ì‹¤í–‰í•˜ê³  í•œë‹¤.


- ### @CacheEvict
```java
@CacheEvict(cacheNames = "test1", key = "#param1")
public String test1(String param1){
        ...

        return result;
}
```
> - ìºì‹±ë˜ì–´ ìˆëŠ” ë°ì´í„°ë¥¼ keyë¥¼ ì´ìš©í•˜ì—¬ ì œê±°í•œë‹¤.

- ### CacheManager
```java
cacheManager.getCache("test1").get("key").get();
cacheManager.getCache("test1").put("key, param");
Collection<String> cacheNames = cacheManager.getCacheNames();
cacheManager.getCache("test1").clear();
cacheManager.getCache("test1").evict("key");
```
> - CacheManagerì„ ì´ìš©í•´ ë©”ì„œë“œ ì• ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•˜ì§€ ì•Šê³  ë°ì´í„°ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤.



## ğŸ§ EhCache
> - Springì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” Java ê¸°ë°˜ ì˜¤í”ˆì†ŒìŠ¤ ìºì‹œ ë¼ì´ë¸ŒëŸ¬ë¦¬
> - ì´ ì™¸ì— redis(ë³„ë„ ì„œë²„), memcached(ë³„ë„ êµ¬ë™) ë“±ì´ ì¡´ì¬í•œë‹¤. í•˜ì§€ë§Œ EhCacheëŠ” Spring ë‚´ë¶€ì—ì„œ ë™ì‘í•˜ê¸° ë•Œë¬¸ì— ì‚¬ìš©í•˜ê¸° ê°„í¸í•˜ë‹¤.
> - 3.x ì´í›„ ë²„ì „ javax.cache API (JSR-107)ì™€ì˜ í˜¸í™˜ì„± ì œê³µ.
> - offheapì— ë°ì´í„° ì €ì¥ (heapì„ ë²—ì–´ë‚œ ë©”ëª¨ë¦¬, GCì— ì˜í•´ ë°ì´í„°ê°€ ì •ë¦¬ë˜ì§€ ì•ŠëŠ” ê³µê°„.)

- ### config
```xml
<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns="http://www.ehcache.org/v3"
        xmlns:jsr107="http://www.ehcache.org/v3/jsr107"
        xsi:schemaLocation="
            http://www.ehcache.org/v3 http://www.ehcache.org/schema/ehcache-core-3.0.xsd
            http://www.ehcache.org/v3/jsr107 http://www.ehcache.org/schema/ehcache-107-ext-3.0.xsd">

    <cache-template name="defaultCacheTemplate">
        <listeners>
            <listener>
                <class>com.hocket.infra.config.CacheEventLogger</class>
                <event-firing-mode>ASYNCHRONOUS</event-firing-mode>
                <event-ordering-mode>UNORDERED</event-ordering-mode>
                <events-to-fire-on>CREATED</events-to-fire-on>
                <events-to-fire-on>EXPIRED</events-to-fire-on>
                <events-to-fire-on>EVICTED</events-to-fire-on>
            </listener>
        </listeners>
    </cache-template>

    <cache alias="account" uses-template="defaultCacheTemplate">
        <key-type>java.lang.String</key-type>
        <value-type>java.lang.Long</value-type>
        <expiry>
            <ttl unit="hours">1</ttl>
        </expiry>
        <resources>
            <heap unit="entries">1</heap>
            <offheap unit="MB">10</offheap>
        </resources>
    </cache>

</config>
```
> - listenerë¥¼ ì‚¬ìš©í•˜ì—¬ ìºì‹œ ì´ë²¤íŠ¸ ë°œìƒì‹œ ë¡œê¹… ê°€ëŠ¥.
```properties
spring.cache.jcache.config=classpath:ehcache.xml
```
> - cache config íŒŒì¼ ë“±ë¡.

- ### ìºì‹œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
```java
@Slf4j
public class CacheEventLogger implements CacheEventListener<Object, Object> {
    @Override
    public void onEvent(CacheEvent<?, ?> cacheEvent) {
        log.info("Cache log - "+ cacheEvent.getType() +":: <"+(String) cacheEvent.getKey()+", "+ cacheEvent.getNewValue() +">");


    }
}
```


# ğŸ“Œ QueryDSL
***
```java
plugins {
    id 'com.ewerk.gradle.plugins.querydsl' version '1.0.10'

}


configurations{
        compileOnly{
            extendsFrom annotationProcessor
        }
}


def querydslDir = "$buildDir/generated/queryDsl"
def generatedDir = "$buildDir/generated"

querydsl {
    library = "com.querydsl:querydsl-apt"
    jpa = true
    querydslSourcesDir = querydslDir
}
sourceSets {
    main.java.srcDirs = ['src/main/java', querydslDir]
}

compileQuerydsl {
    options.annotationProcessorPath = configurations.querydsl
}

configurations {
    querydsl.extendsFrom compileClasspath
}


initQuerydslSourcesDir.doFirst {
    if(file(generatedDir).exists() ) delete(file(generatedDir))
}


dependencies{
    implementation'com.querydsl:querydsl-jpa:5.0.0'
    implementation'com.querydsl:querydsl-apt:5.0.0'
    implementation'com.querydsl:querydsl-core:5.0.0'
}

```

- QueryDSL ì‚¬ìš©ì‹œ Qí´ë˜ìŠ¤ë¥¼ ìë™ìœ¼ë¡œ ìƒì„±í•˜ê¸° ìœ„í•œ í”ŒëŸ¬ê·¸ì¸ì„ ì¶”ê°€í–ˆë‹¤.
- ì†ŒìŠ¤ í´ë”ì™€, Qí´ë˜ìŠ¤ì˜ ê²½ë¡œë¥¼ ì„¤ì •í•´ì£¼ê³  java ì»´íŒŒì¼ ì´ì „ì— queryDSLì„ ì»´íŒŒì¼ í•˜ë„ë¡ í•œë‹¤.
- ë§¤ ì‹¤í–‰ì „ì— Qí´ë˜ìŠ¤ë¥¼ ì§€ìš°ê³  ìƒˆë¡œ ìƒì„±í•œë‹¤.

```java
@Transactional(readOnly = true)
public class HocketRepositoryExtensionImpl extends QuerydslRepositorySupport implements HocketRepositoryExtension {

    public HocketRepositoryExtensionImpl() {
        super(Hocket.class);
    }

    public List<Hocket> findByCategory(String category){
        QHocket hocket = QHocket.hocket;

        JPQLQuery<Hocket> query = from(hocket).where(hocket.categories.any().title.containsIgnoreCase(category));

        return query.fetch();
    }

}
```
### ğŸ§ ì¥ì 
> - íƒ€ì… ì•ˆì „ì„±.
> - ì •ì ì¸ ì¿¼ë¦¬ë¡œëŠ” ìƒì„±í•  ìˆ˜ ì—†ëŠ” ì¿¼ë¦¬ë¥¼ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.
> - IDEì˜ ìë™ì™„ì„±ì˜ ë„ì›€ì„ ë°›ì„ ìˆ˜ ìˆê³ , ë¦¬íŒ©í† ë§ì´ ìˆ˜ì›”í•˜ë‹¤.
> - ë„ë©”ì¸ íƒ€ì…ê³¼ í”„ë¡œí¼í‹°ì˜ ì°¸ì¡°ê°€ í¸ë¦¬í•˜ë‹¤.


# ğŸ“Œ @ControllAdvice: @ExceptionHandler
***
- ### Html ì‘ë‹µ
    ```java
    @Slf4j
    @ControllerAdvice
    public class ExceptionAdvice {
    
        @ResponseStatus(HttpStatus.BAD_REQUEST)
        @ExceptionHandler
        public String handleIllegalArgumentException(IllegalArgumentException exception, @CurrentUser Account account, HttpServletRequest request){
            String username ="";
            if(account != null){
                username = account.getUsername();
            }
            log.error("[{} Requested {}] But, throw IllegalArgumentException {}",username, request.getRequestURI(),exception.getMessage());
    
            return "/error/4xx.html";
        }
    }
    ```
    - IllegalArgumentException ê³¼ ê°™ì€ í´ë¼ì´ì–¸íŠ¸ ì—ëŸ¬ë¥¼ ë˜ì ¸ë„. ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ í´ë¼ì´ì–¸íŠ¸ì—ì„œëŠ” 5xxì„œë²„ ì—ëŸ¬ë¡œ í‘œê¸°í•˜ê²Œ ëœë‹¤.
    - ExceptionHandlerë¥¼ ì´ìš©í•˜ì—¬ ë¡œê·¸ë¥¼ ë‚¨ê¸°ê³ , ì¶”ê°€ì ì¸ ì²˜ë¦¬ë¥¼ í•  ìˆ˜ ìˆë‹¤.
    - return ì„ ì´ìš©í•˜ì—¬ error í˜ì´ì§€ë¥¼ ì—°ê²°í•  ìˆ˜ ìˆë‹¤.
    - ResponseSatus Codeë¥¼ ì›í•˜ëŠ” ì‘ë‹µìœ¼ë¡œ ëª…ì‹œí•´ì¤„ ìˆ˜ ìˆë‹¤.
    
- ### Json ì‘ë‹µ
    ```java
    public Map<String, String> handle(IllegalArgumentException exception) {
        log.error(exception.getMessage());
        Map<String, String> errorAttributes = new HashMap<>();
        errorAttributes.put("code", "BAD_REQUEST");
        errorAttributes.put("message", e.getMessage());
  
        return errorAttributes;
    }
    ```
  
### ğŸ“Œ Spring Data JPA UniqueConstraints
****
```java
@Table(uniqueConstraints =
        @UniqueConstraint(
                name = "nameAndUniqueNumber",
                columnNames = { "col1", "col2"})
        )
@Column(name="name")
private String name;

@Column(name="uniqueNumber")
private String uniqueNumber;
```
- ì—´ì˜ ì¡°í•©ìœ¼ë¡œ ê³ ìœ í•œ ì œì•½ ì¡°ê±´ì„ ì§€ì •í•  ìˆ˜ ìˆë‹¤.


# ğŸ“Œ ìˆœí™˜ì°¸ì¡°
****
ğŸ”‘ í•´ê²° 
> 1. ìˆœí™˜ ì°¸ì¡° ì œê±°.
> 2. ìƒì„±ì ì£¼ì…ë°©ì‹ -> setter ì£¼ì…ìœ¼ë¡œ ë³€ê²½
> ```java
> private PlaceService placeService;
>
> @Autowired
> public void setPlaceService(PlaceService placeService) {
>     this.placeService = placeService;
> }
> ```

