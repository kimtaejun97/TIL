# 🔑 활용 소개.
> ### 스프링 부트 핵심 기능.
> > - SpringApplication
> > - 외부 설정
> > - 프로파일
> > - 로깅
> > - 테스트
> > - Spring-Dev-Tools

> ### 각종 기술 연동
> > - 스프링 웹 MVC
> > - ㅅㅍ링 데이터
> > - 스프링 시큐리티
> > - REST API 클라이언트

# 📜 목차
****
- #### [SpringApplication](-springapplication)
- #### [외부 설정](-외부-설정)
- #### [Profile](-profile)
- #### [Logging](-logging)
- #### [Test](-test)





# 📌 SpringApplication
****
- ### FailureAnalizer : 오류 메시지 커스텀.
  

- ### 배너
> - resource에 banner.txt | gif | jpg | png 를 추가하여 변경.
> - spring.banner.location 을 이용하여 banner파일 위치 설정 가능.
> - ${spring-boot.version} 등의 변수를 사용할 수 있다.
> - Banner 클래스를 구현하고 SpringApplicaiton.setBanner()로 설정 가능.
> - SpringApplication.setBannerMode(Banner.Mode.OFF)

- ### SpringApplicationBuilder()
```java
new SpringApplicationBuilder()
    .sources(SpringApplication.class)
    .run(args);
```

- ### ApplicationEvents

```java
@Component
public class SampleListener implements ApplicationListener<ApplicationStartingEvent> {

    @Override
    public void onApplicationEvent(ApplicationStartingEvent applicationStartingEvent) {
        System.out.println("==========================");
        System.out.println("Application is Starting");
        System.out.println("==========================");
    }
}
```
> ApplicationContext가 만들어지기 전의 이벤트 -> Bean으로 등록해도 Listener가 동작하지 않는다.


```java
SpringApplication app = new SpringApplication(ApplicationeventsApplication.class);
        app.addListeners(new SampleListener());
        app.run(args);
```
> Listener를 수동으로 추가해준다.


- ### WebApplicationType 설정.
```java
SpringApplication app = new SpringApplication(ApplicationeventsApplication.class);
app.setWebApplicationType();
```
> - WebApplicationType.SERVELET : WebMVC   
> - WebApplicationType.REACTIVE : WebMVC가 없고 WebFlux만 존재할 때.     
> - WebApplicationType.NONE : 둘 다 없을 때.


- ### 애플리케이션 argument 사용하기.
> - Program arguments : --

```java
@Component
public class PrintArgs {

    public PrintArgs(ApplicationArguments applicationArguments){
        System.out.println(applicationArguments.containsOption("bar"));
    }
}
```
> ☝️ Bean에 생성자가 한개고, 그 생성자의 파라미터가 Bean일 경우 자동으로 주입. 


- ### 애플리케이션 실행 후 실행 (ApplicaiontRunner)
> - implements ApplicationRunner   
> - @Order()로 우선순위 가능.



# 📌 외부 설정
****
- ### 사용할 수 있는 외부 설정
> - properties
> - YAML
> - 환경 변수
> - 커맨드 라인 argument

- ### ☝️ 프로퍼티 우선순위
> 1. 유저 홈 디렉토리에 있는 spring-boot-dev-tools.properties
> 2. 테스트에 있는 @TestPropertySource
> ```java
>- @TestPropertySource(locations = "classpath:/test.properties")
>``` 
>
> 3. @SpringBootTest 애노테이션의 properties 애트리뷰트.
> ```java
>- @SpringBootTest(properties = "bigave.name=kimtaejun2")
>``` 
> 4. 커맨드라인 argument
> ``` - java -jar ... --bigave.name=kim ```
> 5. SPRING_APPLICATION_JSON(환경 변수 또는 시스템 프로퍼티에 들어있는 프로퍼티)
> 6. ServletConfig 파라미터.
> 7. ServletContext 파라미터.
> 8. java:comp/env JNDI 애트리뷰트.
> 9. System.getProperties() 자바 시스템 프로퍼티.
> 10. OS 환경 변수
> 11. RandomValuePropertySource ( ${random.int[start,end]})
> 12. JAR 밖에 있는 특정 프로파일용 application.properties
> 13. JAR 안에 있는 특정 프로파일용 application.properties
> 14. JAR 밖에 있는 application.properties
> 15. JAR 안에 있는 application.properties
> 16. @PropertySource



> 👎 test 디렉토리에 application.properties를 생성하면, Test 수행시 먼저 main을 빌드하여 클래스 패스에 추가하고,
> test를 빌드하여 추가하기 때문에 main의 properties 파일이  test의 properties 파일로 덮어진다.     
> 이 때, test properties에서 main properties의 값을 누락하고, 해당 값을 main이나 test에서 사용하게 되면 빌드하는 과정에서 값을 찾을 수 없어 오류가 발생한다.

> 👍 test properties 파일을 생성하지 않고 ,@TestPropertySource 나, @SpringBootTest의 properties 속성을 사용한다.

>application.properties 우선순위.
> > 1. file:./config/ (project root/config/)
> > 2. file:./
> > 3. classpath:/config/
> > 4. classpath:/

- ### 타입-세이프 프로퍼티 @ConfigurationProperties
> - 여러 프로퍼티를 묶어서 읽어올 수 있음.
> - 빈으로 등록해서 다른 빈에 주입할 수 있음.
> > - @EnableConfigurationProperties(properties.class)
> > - @Component
> > - @Bean
> - 융통성 있는 바인딩(프로퍼티를 네이밍 할 때 아래는 모두 같게 바인딩 됨.)
> > - context-path(케밥)
> > - context_path(언더스코어)
> > - contextPath(카멜)
> > - CONTEXTPATH
> - 프로퍼티 타입 컨버전(String(100) - int(100) , String(25s) - Duration(PT25s) ...)
> - 프로퍼티 값 검증(@Validated, JSR-303(@NotNull, ...))
```properties
bigave.name = taejun
bigave.age = ${random.int[0,100]} 
```

```java
@Component
@ConfigurationProperties("bigave") //key 
public class BigaveProperties {

    String name;
    int age;

    public int getAge() {
        return age;
    }
    public void setAge(int age) {
        this.age = age;
    }
    public String getName() {
        return name;
    }
    public void setName(String name) {
        this.name = name;
    }
}
```

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-configuration-processor</artifactId>
    <optional>true</optional>
</dependency>
```
> @ConfigurationProperties를 사용하기 위한 의존성.


```java
@Autowired
BigaveProperties bigaveProperties;

@Override
public void run(ApplicationArguments args) throws Exception {
        System.out.println(bigaveProperties.getName);
        System.out.println(bigaveProperties.getAge);
}
```


# 📌 Profile
****

> @Profile 애노테이션은 어디에?