# ğŸ”‘ í™œìš© ì†Œê°œ.

> ### ìŠ¤í”„ë§ ë¶€íŠ¸ í•µì‹¬ ê¸°ëŠ¥.
> > - SpringApplication
> > - ì™¸ë¶€ ì„¤ì •
> > - í”„ë¡œíŒŒì¼
> > - ë¡œê¹…
> > - í…ŒìŠ¤íŠ¸
> > - Spring-Dev-Tools

> ### ê°ì¢… ê¸°ìˆ  ì—°ë™
> > - ìŠ¤í”„ë§ ì›¹ MVC
> > - ìŠ¤ë§ ë°ì´í„°
> > - ìŠ¤í”„ë§ ì‹œíë¦¬í‹°
> > - REST API í´ë¼ì´ì–¸íŠ¸

# ğŸ“œ ëª©ì°¨

****

- #### [SpringApplication](#-springapplication)
- #### [ì™¸ë¶€ ì„¤ì •](#-ì™¸ë¶€-ì„¤ì •)
- #### [Profile](#-profile)
- #### [Logging](#-logging)
- #### [Test](#-test)
- #### [Spring Boot Devtools](#-Spring-Boot-Devtools)
- #### [ìŠ¤í”„ë§ ì›¹ MVC](#-ìŠ¤í”„ë§-ì›¹-mvc)

    - [Http Message Converters](#-httpmessageconverters)
    - [View Resolve](#-viewresolve)
    - [ì •ì  ë¦¬ì†ŒìŠ¤ ìì›](#-ì •ì -ë¦¬ì†ŒìŠ¤-ìì›)
    - [ì›¹ JAR](#-ì›¹-jar)
    - [index í˜ì´ì§€ì™€ íŒŒë¹„ì½˜](#-index-í˜ì´ì§€ì™€-íŒŒë¹„ì½˜)
    - [Thymeleaf](#-thymeleaf)
    - [HtmlUnit](#-htmlunit)
    - [Exception Handler](#-exceptionhandler)
    - [Cross Origin Resource Sharing](#-Cross-Origin-Resource-Sharing)
    
- #### [ìŠ¤í”„ë§ ë°ì´í„°](#-ìŠ¤í”„ë§-ë°ì´í„°)

    - [Inmemory Database](#-inmemory-database)
    - [MySQL](#-mysql)
    - [PostgreSQL](#-postgresql)
    - [Spring Data JPA](#-spring-data-jpa)
    - [ë°ì´í„° ë² ì´ìŠ¤ ì´ˆê¸°í™”](#-ë°ì´í„°ë² ì´ìŠ¤-ì´ˆê¸°í™”)
    - [Database Migration](#-database-migration)
    
- #### [Spring Security](#-spring-security)
- #### [Spring REST Client](#-spring-rest-client)

# ğŸ“Œ SpringApplication

****

- ### FailureAnalizer : ì˜¤ë¥˜ ë©”ì‹œì§€ ì»¤ìŠ¤í…€.


- ### ë°°ë„ˆ

> - resourceì— banner.txt | gif | jpg | png ë¥¼ ì¶”ê°€í•˜ì—¬ ë³€ê²½.
> - spring.banner.location ì„ ì´ìš©í•˜ì—¬ banneríŒŒì¼ ìœ„ì¹˜ ì„¤ì • ê°€ëŠ¥.
> - ${spring-boot.version} ë“±ì˜ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
> - Banner í´ë˜ìŠ¤ë¥¼ êµ¬í˜„í•˜ê³  SpringApplicaiton.setBanner()ë¡œ ì„¤ì • ê°€ëŠ¥.
> - SpringApplication.setBannerMode(Banner.Mode.OFF)

- ### SpringApplicationBuilder()

```java
new SpringApplicationBuilder()
    .sources(SpringApplication.class)
    .run(args);
```

- ### ApplicationEvents

```java
@Component
public class SampleListener implements ApplicationListener<ApplicationStartingEvent> {

    @Override
    public void onApplicationEvent(ApplicationStartingEvent applicationStartingEvent) {
        System.out.println("==========================");
        System.out.println("Application is Starting");
        System.out.println("==========================");
    }
}
```

> ApplicationContextê°€ ë§Œë“¤ì–´ì§€ê¸° ì „ì˜ ì´ë²¤íŠ¸ -> Beanìœ¼ë¡œ ë“±ë¡í•´ë„ Listenerê°€ ë™ì‘í•˜ì§€ ì•ŠëŠ”ë‹¤.

```java
SpringApplication app = new SpringApplication(ApplicationeventsApplication.class);
        app.addListeners(new SampleListener());
        app.run(args);
```

> Listenerë¥¼ ìˆ˜ë™ìœ¼ë¡œ ì¶”ê°€í•´ì¤€ë‹¤.

- ### WebApplicationType ì„¤ì •.

```java
SpringApplication app = new SpringApplication(ApplicationeventsApplication.class);
app.setWebApplicationType();
```

> - WebApplicationType.SERVELET : WebMVC
> - WebApplicationType.REACTIVE : WebMVCê°€ ì—†ê³  WebFluxë§Œ ì¡´ì¬í•  ë•Œ.
> - WebApplicationType.NONE : ë‘˜ ë‹¤ ì—†ì„ ë•Œ.

- ### ì• í”Œë¦¬ì¼€ì´ì…˜ argument ì‚¬ìš©í•˜ê¸°.

> - Program arguments : --

```java
@Component
public class PrintArgs {

    public PrintArgs(ApplicationArguments applicationArguments){
        System.out.println(applicationArguments.containsOption("bar"));
    }
}
```

> â˜ï¸ Beanì— ìƒì„±ìê°€ í•œê°œê³ , ê·¸ ìƒì„±ìì˜ íŒŒë¼ë¯¸í„°ê°€ Beanì¼ ê²½ìš° ìë™ìœ¼ë¡œ ì£¼ì….

- ### ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ í›„ ì‹¤í–‰ (ApplicaiontRunner)

> - implements ApplicationRunner
> - @Order()ë¡œ ìš°ì„ ìˆœìœ„ ê°€ëŠ¥.

# ğŸ“Œ ì™¸ë¶€ ì„¤ì •

****

- ### ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì™¸ë¶€ ì„¤ì •

> - properties
> - YAML
> - í™˜ê²½ ë³€ìˆ˜
> - ì»¤ë§¨ë“œ ë¼ì¸ argument

- ### â˜ï¸ í”„ë¡œí¼í‹° ìš°ì„ ìˆœìœ„

> 1. ìœ ì € í™ˆ ë””ë ‰í† ë¦¬ì— ìˆëŠ” spring-boot-dev-tools.properties
> 2. í…ŒìŠ¤íŠ¸ì— ìˆëŠ” @TestPropertySource
> ```java
>- @TestPropertySource(locations = "classpath:/test.properties")
>``` 
>
> 3. @SpringBootTest ì• ë…¸í…Œì´ì…˜ì˜ properties ì• íŠ¸ë¦¬ë·°íŠ¸.
> ```java
>- @SpringBootTest(properties = "bigave.name=kimtaejun2")
>``` 
> 4. ì»¤ë§¨ë“œë¼ì¸ argument
     > ``` - java -jar ... --bigave.name=kim ```
> 5. SPRING_APPLICATION_JSON(í™˜ê²½ ë³€ìˆ˜ ë˜ëŠ” ì‹œìŠ¤í…œ í”„ë¡œí¼í‹°ì— ë“¤ì–´ìˆëŠ” í”„ë¡œí¼í‹°)
> 6. ServletConfig íŒŒë¼ë¯¸í„°.
> 7. ServletContext íŒŒë¼ë¯¸í„°.
> 8. java:comp/env JNDI ì• íŠ¸ë¦¬ë·°íŠ¸.
> 9. System.getProperties() ìë°” ì‹œìŠ¤í…œ í”„ë¡œí¼í‹°.
> 10. OS í™˜ê²½ ë³€ìˆ˜
> 11. RandomValuePropertySource ( ${random.int[start,end]})
> 12. JAR ë°–ì— ìˆëŠ” íŠ¹ì • í”„ë¡œíŒŒì¼ìš© application.properties
> 13. JAR ì•ˆì— ìˆëŠ” íŠ¹ì • í”„ë¡œíŒŒì¼ìš© application.properties
> 14. JAR ë°–ì— ìˆëŠ” application.properties
> 15. JAR ì•ˆì— ìˆëŠ” application.properties
> 16. @PropertySource



> ğŸ‘ test ë””ë ‰í† ë¦¬ì— application.propertiesë¥¼ ìƒì„±í•˜ë©´, Test ìˆ˜í–‰ì‹œ ë¨¼ì € mainì„ ë¹Œë“œí•˜ì—¬ í´ë˜ìŠ¤ íŒ¨ìŠ¤ì— ì¶”ê°€í•˜ê³ ,
> testë¥¼ ë¹Œë“œí•˜ì—¬ ì¶”ê°€í•˜ê¸° ë•Œë¬¸ì— mainì˜ properties íŒŒì¼ì´ testì˜ properties íŒŒì¼ë¡œ ë®ì–´ì§„ë‹¤.     
> ì´ ë•Œ, test propertiesì—ì„œ main propertiesì˜ ê°’ì„ ëˆ„ë½í•˜ê³ , í•´ë‹¹ ê°’ì„ mainì´ë‚˜ testì—ì„œ ì‚¬ìš©í•˜ê²Œ ë˜ë©´ ë¹Œë“œí•˜ëŠ” ê³¼ì •ì—ì„œ ê°’ì„ ì°¾ì„ ìˆ˜ ì—†ì–´ ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤.

> ğŸ‘ test properties íŒŒì¼ì„ ìƒì„±í•˜ì§€ ì•Šê³  ,@TestPropertySource ë‚˜, @SpringBootTestì˜ properties ì†ì„±ì„ ì‚¬ìš©í•œë‹¤.

> - application.properties ìš°ì„ ìˆœìœ„.
> > 1. file:./config/ (project root/config/)
> > 2. file:./
> > 3. classpath:/config/
> > 4. classpath:/

- ### íƒ€ì…-ì„¸ì´í”„ í”„ë¡œí¼í‹° @ConfigurationProperties

> - ì—¬ëŸ¬ í”„ë¡œí¼í‹°ë¥¼ ë¬¶ì–´ì„œ ì½ì–´ì˜¬ ìˆ˜ ìˆìŒ.
> - ë¹ˆìœ¼ë¡œ ë“±ë¡í•´ì„œ ë‹¤ë¥¸ ë¹ˆì— ì£¼ì…í•  ìˆ˜ ìˆìŒ.
> > - @EnableConfigurationProperties(properties.class)
> > - @Component
> > - @Bean
> - ìœµí†µì„± ìˆëŠ” ë°”ì¸ë”©(í”„ë¡œí¼í‹°ë¥¼ ë„¤ì´ë° í•  ë•Œ ì•„ë˜ëŠ” ëª¨ë‘ ê°™ê²Œ ë°”ì¸ë”© ë¨.)
> > - context-path(ì¼€ë°¥)
> > - context_path(ì–¸ë”ìŠ¤ì½”ì–´)
> > - contextPath(ì¹´ë©œ)
> > - CONTEXTPATH
> - í”„ë¡œí¼í‹° íƒ€ì… ì»¨ë²„ì „(String(100) - int(100) , String(25s) - Duration(PT25s) ...)
> - í”„ë¡œí¼í‹° ê°’ ê²€ì¦(@Validated, JSR-303(@NotNull, ...))

```properties
bigave.name = taejun
bigave.age = ${random.int[0,100]} 
```

```java
@Component
@ConfigurationProperties("bigave") //key 
public class BigaveProperties {

    String name;
    int age;

    public int getAge() {
        return age;
    }
    public void setAge(int age) {
        this.age = age;
    }
    public String getName() {
        return name;
    }
    public void setName(String name) {
        this.name = name;
    }
}
```

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-configuration-processor</artifactId>
    <optional>true</optional>
</dependency>
```

> @ConfigurationPropertiesë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•œ ì˜ì¡´ì„±.

```java
@Autowired
BigaveProperties bigaveProperties;

@Override
public void run(ApplicationArguments args) throws Exception {
        System.out.println(bigaveProperties.getName);
        System.out.println(bigaveProperties.getAge);
}
```

# ğŸ“Œ Profile

****

> - @Profile ì• ë…¸í…Œì´ì…˜ì€ ì–´ë””ì— ë¶™ì´ë‚˜?
>```
> @Configuration
> @Component
>```
> - í”„ë¡œ íŒŒì¼ í™œì„±í™”.
>```properties
>spring.profiles.active= ...
>```
> - í”„ë¡œ íŒŒì¼ìš© í”„ë¡œí¼í‹°
>```
> application-{profile}.properties
>```
> - í”„ë¡œ íŒŒì¼ ì¶”ê°€.
>```properties
>spring.profiles.include= ...
>```

```java
@Profile("prod")
@Configuration
public class BaseConfiguration {

    @Bean
    public String hello(){
        return "hello prod";
    }
}
```

```properties
spring.profiles.active=prod
spring.profiles.include=proddb
```

> í”„ë¡œíŒŒì¼ì€ prodë¡œ ì„¤ì •, í•´ë‹¹ properties íŒŒì¼ì´ ì½í ë•Œ proddbë¥¼ ì¶”ê°€í•œë‹¤.


![img_5.png](img_5.png)
> - ìš°ì„ ìˆœìœ„
> > avtivate í”„ë¡œíŒŒì¼ í”„ë¡œí¼í‹° > include ëœ í”„ë¡œíŒŒì¼ í”„ë¡œí¼í‹°(ëŠ¦ê²Œ ì¶”ê°€ëœ ê²ƒì´ ë®ì–´ ì”€.) > application.properties

# ğŸ“Œ Logging

****
> - ìŠ¤í”„ë§ ë¶€íŠ¸ëŠ” ê¸°ë³¸ì ìœ¼ë¡œëŠ” Commons Loggingì„ ì‚¬ìš©í•˜ì§€ë§Œ ê²°êµ­ì—ëŠ” SLF4j(Simple Logging Facade4java)ë¥¼ ê±°ì³ -> Logbackì„ ì‚¬ìš©í•˜ê²Œ ëœë‹¤.
> - SLF4jëŠ” ë¡œê±° APIë¥¼ ì¶”ìƒí™” í•´ë‘” Interface.
> - SLF4jë¥¼ ì‚¬ìš©í•  ë•Œì˜ ì¥ì  : êµ¬í˜„ì²´ì¸ JUL, Log4J2, Logback ë“±ìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥.
> - Spring-JCL : Commons Logging -> SLF4j or Log4j2(SLF4jê°€ ì—†ì„ ë•Œ.)


> - --debug : embedded container, Hibernate, Spring Bootì™€ ê°™ì€ ì¼ë¶€ í•µì‹¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ë§Œ ë””ë²„ê¹… ëª¨ë“œë¡œ.
> - --trace : ì „ë¶€ ë””ë²„ê¹… ëª¨ë“œë¡œ.
> - íŒŒì¼ ì¶œë ¥ : logging.file(íŒŒì¼) | logging.path(ë””ë ‰í† ë¦¬)
> - ë¡œê·¸ ë ˆë²¨ : logging.level.íŒ¨í‚¤ì§€ = ë¡œê·¸ ë ˆë²¨ (DEBUG,INFO ...)

```java
@Component
public class AppRunner implements ApplicationRunner {

    Logger logger = LoggerFactory.getLogger(AppRunner.class);

    @Override
    public void run(ApplicationArguments args) throws Exception {
        logger.debug("====================================");
        logger.debug("logger.debug");
        logger.debug("====================================");
    }
}
```

![img_6.png](img_6.png)

- ### ì»¤ìŠ¤í…€ ë¡œê·¸ ì„¤ì • íŒŒì¼ ì‚¬ìš©í•˜ê¸°.

> - Logback-spring.xml
> - Log4J2 : log4j2-spring.xml
> - JUL : logging.properties
> - Logback extension
> > - í”„ë¡œíŒŒì¼ : \<springProfile name="í”„ë¡œíŒŒì¼"> --> í•´ë‹¹ í”„ë¡œíŒŒì¼ì—ë§Œ ì ìš©.

```xml
<?xml version="1.0" encoding="UTF-8" ?>
<springProfile name ="test">
    <configuration>
        <include resource="org/springframework/boot/logging/logback/base.xml"/>
        <logger name="com.bigave.logging" level="DEBUG"/>
    </configuration>
</springProfile>
```

> - í”„ë¡œíŒŒì¼ì´ testì¼ ê²½ìš°ì—ë§Œ íŒ¨í‚¤ì§€ì˜ ë¡œê·¸ ë ˆë²¨ì„ DEBUGë¡œ ì„¤ì •.

- ë¡œê±°ë¥¼ Log4j2ë¡œ ë³€ê²½í•˜ê¸°

> spring-boot-starter-loggingì„ exclusion ì‹œí‚¤ê³  spring-boot-starter-log4j2 ì˜ì¡´ì„±ì„ ì¶”ê°€.

# ğŸ“Œ Test

****
> spring-boot-starter-test ì˜ì¡´ì„± test scopeë¡œ ì¶”ê°€.

- ### @SpringBootTest

> - @RunWith(SpringBootRunner.class)
> - @SpringBootApplicaiton ë¶€í„° ì•Œì•„ì„œ ë¹ˆì„ ì°¾ì•„ ë“±ë¡í•´ì¤Œ.
> - webEnvironment
> > - MOCK : mock servlet environment (default), ë‚´ì¥ í†°ìº£ êµ¬ë™ ì•ˆí•¨.
> > - RANDOM_PORT, DEFINE_PORT : ë‚´ì¥ í†°ìº£ ì‚¬ìš©.
> > - NONE : servlet í™˜ê²½ ì œê³µ ì•ˆí•¨.

#### 1. MockMvcë¥¼ ì´ìš©í•œ í…ŒìŠ¤íŠ¸.

```java
@RunWith(SpringRunner.class)
@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.MOCK)
@AutoConfigureMockMvc
public class SampleControllerTest {

    @Autowired
    MockMvc mockMvc;

    @Test
    public void hello() throws Exception {
        mockMvc.perform(get("/hello"))
                .andExpect(status().isOk())
                .andExpect(content().string("hello taejun"))
                .andDo(print());
    }
}
```

> @AutoConfigurationMockMvc ì• ë…¸í…Œì´ì…˜ì„ ì´ìš©í•˜ì—¬ @Autowiredë¡œ MockMvcë¥¼ ì£¼ì…ë°›ëŠ” ë°©ë²•ì´ ê°€ì¥ ê°„í¸.

#### 2. TestRestTemplateë¥¼ ì´ìš©í•œ í…ŒìŠ¤íŠ¸.

```java

@RunWith(SpringRunner.class)
@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
public class SampleControllerTest {
    
    @Autowired
    TestRestTemplate testRestTemplate;

    @MockBean
    SampleService mockSampleService;

    @Test
    public void restHello(){
        when(mockSampleService.getName()).thenReturn("kimtaejun");

        String result = testRestTemplate.getForObject("/hello", String.class);

        assertThat(result).isEqualTo("hello kimtaejun");
    }
```

> - Random_portë¡œ ì‹¤ì œë¡œ servletì„ ë„ìš°ëŠ” í…ŒìŠ¤íŠ¸.
> - Controllerë§Œ í…ŒìŠ¤íŠ¸ í•˜ê³  ì‹¶ì€ë° serviceê¹Œì§€ í…ŒìŠ¤íŠ¸í•˜ê²Œ ë˜ì–´ í…ŒìŠ¤íŠ¸ê°€ ë„ˆë¬´ í° ë¬¸ì œê°€ ìˆë‹¤.
> - Service í´ë˜ìŠ¤ë§Œ Mockë¡œ ìƒì„±í•˜ì—¬ ì‚¬ìš©í•˜ì—¬ í•´ê²°.

#### 3. WebTestClientë¥¼ ì´ìš©í•œ í…ŒìŠ¤íŠ¸.

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-webflux</artifactId>
</dependency>
```

```java
@Autowired
WebTestClient webTestClient;

 @Test
public void clientHello(){
    when(mockSampleService.getName()).thenReturn("kimtaejun");

    webTestClient.get().uri("/hello").exchange()
            .expectStatus().isOk()
            .expectBody(String.class).isEqualTo("hello kimtaejun");
}
```

> Asynchronized

- ### ìŠ¬ë¼ì´ìŠ¤ í…ŒìŠ¤íŠ¸.

> - @JsonTest
> - @WebMvcTest(controller.class) : ì›¹ê³¼ ê´€ë ¨ëœ Bean ë“¤ë§Œ ë“±ë¡. @Controller, Converter, @JsonComponent ...    
    > @Repository, @Serviceì™€ ê°™ì€ Beanë“¤ì€ ë“±ë¡ë˜ì§€ ì•ŠëŠ”ë‹¤. --> @MockBeanìœ¼ë¡œ ì±„ì›Œì¤˜ì•¼ í•¨.
> - WebFluxTest
> - DataJpaTest : @Repository bean ë“±ë¡.

- ### í…ŒìŠ¤íŠ¸ ìœ í‹¸.

> - OutputCapture : ë¡œê·¸ë¥¼ ë¹„ë¡¯í•œ ì½˜ì†”ì˜ ëª¨ë“ ê²ƒì„ ìº¡ì³.

# ğŸ“Œ Spring Boot Devtools

****

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-devtools</artifactId>
</dependency>
```

> - ìºì‹œ ì„¤ì •ì„ ê°œë°œ í™˜ê²½ì— ë§ê²Œ ì„¤ì •í•´ ì¤Œ.
> - í´ë˜ìŠ¤ íŒ¨ìŠ¤ì— ìˆëŠ íŒŒì¼ì´ ë³€ê²½ë  ë•Œ ë§ˆë‹¤ ìë™ìœ¼ë¡œ ì¬ì‹œì‘.
> > - ì§ì ‘ ë¦¬ìŠ¤íƒ€íŠ¸(cold start)ë³´ë‹¤ ë¹ ë¦„. --> ìŠ¤í”„ë§ì€ base class loader, restart class loader ë‚˜ë‰¨.
> > - ë¦¬ìŠ¤íƒ€íŠ¸ í•˜ê³  ì‹¶ì§€ ì•Šì€ ë¦¬ì†ŒìŠ¤ : spring.devtools.restart.exclude
> > - ë¦¬ìŠ¤íƒ€íŠ¸ ê¸°ëŠ¥ ë„ê¸° : spring.devtools.restart.enabled = false
> - ë¼ì´ë¸Œ ë¦¬ë¡œë“œ : ë¦¬ìŠ¤íƒ€íŠ¸ í›„ ìë™ìœ¼ë¡œ ë¸Œë¼ìš°ì € ë¦¬í”„ë ˆì‰¬. --> ë¸Œë¼ìš°ì € í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜ í•„ìš”.
> > ë¼ì´ë¸Œ ë¦¬ë¡œë“œ ë„ê¸° : spring.devtools.liveload.enabled = false

# ğŸ“ƒ <mark style="background-color:#fff5b1">ìŠ¤í”„ë§ ì›¹ MVC<mark>

****
> - ìŠ¤í”„ë§ ë¶€íŠ¸ MVC : ìë™ ì„¤ì •ìœ¼ë¡œ ì œê³µí•˜ëŠ” ì—¬ëŸ¬ ê¸°ë³¸ ê¸°ëŠ¥.
> - ìŠ¤í”„ë§ MVC í™•ì¥ : @Configuration + WebMvcConfigure interface
> - ìŠ¤í”„ë§ MVC ì¬ì •ì˜ : @Configuration + @EnableWebMvc

# ğŸ“Œï¸ HttpMessageConverters
***

> HTTP ìš”ì²­ ë³¸ë¬¸ì„ ê°ì²´ë¡œ ë³€ê²½í•˜ê±°ë‚˜, ê°ì²´ë¥¼ HTTP ì‘ë‹µ ë³¸ë¬¸ìœ¼ë¡œ ë³€ê²½í•  ë•Œ ì‚¬ìš©.    
> {"username" : "taejun", "password":"aa123"} <--> User
> - @ResponseBody, @RequestBody
> - ê¸°ë³¸ì ìœ¼ë¡œ ì»´í¬ì§€ì…˜ íƒ€ì…ì¼ ê²½ìš°ì—ëŠ” JsonMessageConverterê°€ ì‚¬ìš©ë¨.

````java
@PostMapping("/users/create")
public User create(@RequestBody User user){
      return user;
}
````

> - @RestController ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ëŠ” @ResponseBodyëŠ” ìƒëµí•´ë„ ë¨.
> - @Controller ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ì—ëŠ” @ResponseBodyê°€ ì—†ë‹¤ë©´ Viewë¥¼ ì°¾ê²Œ ëœë‹¤.
> - User Classì—ëŠ” ìë°” ë¹ˆ ê·œì•½ì— ë”°ë¼ ê° ë§¤í•‘ í•„ë“œì˜ Getter, Setterê°€ ì¡´ì¬í•´ì•¼ í•œë‹¤.

```java
@Test
public void createuser_JSON() throws Exception {
    String userJson = "{\"userName\":\"Taejun\", \"password\":\"aaa123\"}";
    mockMvc.perform(post("/users/create")
        .contentType(MediaType.APPLICATION_JSON)
        .accept(MediaType.APPLICATION_JSON)
        .content(userJson))
            .andExpect(status().isOk())
            .andExpect(jsonPath("$.userName", is(equalTo("Taejun"))));
}
```

# ğŸ“Œ ViewResolve
****

> ContentNegotiatingViewResolver
> - ì–´ë–¤ íƒ€ì…ì˜ ë³¸ë¬¸ í˜•ì‹ì„ ì›í•˜ëŠ”ì§€.
> - ëŒ€í‘œì ìœ¼ë¡œ accept í—¤ë”.

```java
String userJson = "{\"userName\":\"Taejun\", \"password\":\"aaa123\"}";
      mockMvc.perform(post("/users/create")
      .contentType(MediaType.APPLICATION_JSON)
      .accept(MediaType.APPLICATION_XML)
      .content(userJson))
      .andExpect(status().isOk())
      .andExpect(xpath("/User/userName").string("Taejun"));
```

- XML ë©”ì‹œì§€ ì»¨ë²„í„° ì˜ì¡´ì„± ì¶”ê°€.

```xml
<dependency>
    <groupId>com.fasterxml.jackson.dataformat</groupId>
    <artifactId>jackson-dataformat-xml</artifactId>
</dependency>
```

# ğŸ“Œï¸ ì •ì  ë¦¬ì†ŒìŠ¤ ìì›
****

> ì´ë¯¸ ë§Œë“¤ì–´ì§„ ë¦¬ì†ŒìŠ¤ë¥¼ ì œê³µí•˜ëŠ” ë°©ë²•.

- #### ì •ì  ë¦¬ì†ŒìŠ¤ ë§µí•‘ "/**"

> ê¸°ë³¸ ë¦¬ì†ŒìŠ¤ ìœ„ì¹˜
> - classpath:/static -- > ex) /hello.html ==> /static/hello.html
> - classpath:/public
> - classpath:/resources/
> - classpath:/META_INF/resources
> - spring.mvc.static-path-pattern : ë§¤í•‘ ì„¤ì • ë³€ê²½ ê°€ëŠ¥.    
    > ex) spring.mvc.static-path-pattern=/resource/** -->  /static/hello.html ë¡œ ìš”ì²­í•´ì•¼ í•¨.
> - spring.mvc.static-locations : ë¦¬ì†ŒìŠ¤ ì°¾ì„ ìœ„ì¹˜ ë³€ê²½ ê°€ëŠ¥. --> ê¸°ì¡´ ì°¾ì„ ìœ„ì¹˜ë¥¼ ëª¨ë‘ ì‚¬ìš©í•  ìˆ˜ ì—†ê²Œ ë¨.


> ğŸ‘ ResourceHttpRequestHandler
> - WebMvcConfigurerì˜ addResourceHandlersë¡œ ì»¤ìŠ¤í…€ ê°€ëŠ¥.

```java
@Configuration
public class WebConfig implements WebMvcConfigurer {

    @Override
    public void addResourceHandlers(ResourceHandlerRegistry registry) {
        registry.addResourceHandler("/m/**")
                .addResourceLocations("classpath:/m/")
                .setCachePeriod(20);
    }
}
```

> /m/hello.html ë¡œ ì ‘ì† ê°€ëŠ¥.

# ğŸ“Œï¸ ì›¹ JAR
****

> - jaríŒŒì¼ ì˜ì¡´ì„± ì¶”ê°€í•˜ì—¬ ì‚¬ìš©.(css, jquery ë“± ..)
> - ì›¹ JAR ë§¤í•‘ "/webjars/**"
> - ë²„ì „ ìƒëµ : webjars-locator-core ì˜ì¡´ì„± ì¶”ê°€.

# ğŸ“Œï¸ Index í˜ì´ì§€ì™€ íŒŒë¹„ì½˜
****

- ì›°ì»´ í˜ì´ì§€

> - index.html ì°¾ì•„ ë³¸ í›„ ì¡´ì¬í•œë‹¤ë©´ ì‚¬ìš©.
> - index í…œí”Œë¦¿ ì°¾ì•„ë³´ê³  ìˆìœ¼ë©´ ì‚¬ìš©.
> - ë‘˜ ë‹¤ ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´ ìŠ¤í”„ë§ì—ì„œ ì œê³µí•˜ëŠ” ì—ëŸ¬ í˜ì´ì§€ë¥¼ ë³´ì—¬ ì¤Œ.

- íŒŒë¹„ì½˜

> - favicon.ico
> - íŒŒë¹„ì½˜ ë§Œë“¤ê¸° https:/favicon.io/

# ğŸ“Œ Thymeleaf
***

- ìŠ¤í”„ë§ ë¶€íŠ¸ê°€ ìë™ ì„¤ì •ì„ ì§€ì›í•˜ëŠ” í…œí”Œë¦¿ ì—”ì§„

> - FreeMarker
> - Groovy
> - Thymeleaf
> - Mustache

- JSPë¥¼ ê¶Œì¥í•˜ì§€ ì•ŠëŠ” ì´ìœ ?

> - JAR íŒ¨í‚¤ì§• í•  ë•ŒëŠ” ë™ì‘í•˜ì§€ ì•Šê³  , WAR íŒ¨í‚¤ì§•ì„ í•´ì•¼ í•¨.
> - UndertowëŠ” JSPë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŒ.

- ### Thymeleaf ì‚¬ìš©í•˜ê¸°

> - https://www.thymeleaf.org/
> - https://www.thymeleaf.org/doc/articles/standarddialect5minutes.html

```html
<!DOCTYPE html>
<html lang="en" xmlns:th = "http://www.thymeleag.org">
<head>
    <meta charset="UTF-8">
    <title>Hello</title>
</head>
<body>
    <h1 th:text="${hello}"></h1>
</body>
</html>
```

```java
@RunWith(SpringRunner.class)
@WebMvcTest(SampleController.class)
public class SampleControllerTest {

    @Autowired
    MockMvc mockMvc;

    @Test
    public void hello() throws Exception {

        mockMvc.perform(get("/"))
                .andExpect(status().isOk())
                .andExpect(view().name("index"))
                .andExpect(model().attribute("hello","hello"))
                .andExpect(content().string(containsString("hello")))
                .andDo(print());
    }
}
```

> - view()ë¡œ í•´ë‹¹ view file name í™•ì¸ ê°€ëŠ¥.
> - model().attribute() ë¡œ ê°’ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥.

# ğŸ“Œ HtmlUnit
****

```xml
<dependency>
    <groupId>org.seleniumhq.selenium</groupId>
    <artifactId>htmlunit-driver</artifactId>
    <scope>test</scope>
</dependency>
<dependency>
    <groupId>net.sourceforge.htmlunit</groupId>
    <artifactId>htmlunit</artifactId>
    <scope>test</scope>
</dependency>
```

- HtmlUnit : HTML í…œí”Œë¦¿ ë·° í…ŒìŠ¤íŠ¸ë¥¼ ë³´ë‹¤ ì „ë¬¸ì ìœ¼ë¡œ.

```java
import com.gargoylesoftware.htmlunit.WebClient;
import com.gargoylesoftware.htmlunit.html.HtmlHeading1;
import com.gargoylesoftware.htmlunit.html.HtmlPage;


@Autowired
WebClient webClient;

@Test
public void htmlUnitHello() throws IOException {
        HtmlPage page = webClient.getPage(("/"));
        HtmlHeading1 h1 = page.getFirstByXPath("//h1");

        assertThat(h1.getTextContent()).isEqualTo("hello");
}
```

# ğŸ“Œ ExceptionHandler

****

- ### ìŠ¤í”„ë§ ë¶€íŠ¸ì˜ ê¸°ë³¸ ì˜ˆì™¸ ì²˜ë¦¬ê¸°

> BasicErrorController : HTMLê³¼ JSON ì‘ë‹µ ì§€ì›.

![img_7.png](img_7.png)

![img_8.png](img_8.png)

- ### Custom Error

> ErrorController êµ¬í˜„

```java
@RestController
public class SampleController {

    @GetMapping("/MyError")
    public String error(){
        throw new CustomException();
    }

    @ExceptionHandler(CustomException.class)
    public AppError sampleError(CustomException e){
        AppError appError = new AppError();
        appError.setMessage("app.error.key");
        appError.setReason("ì¼ë¶€ëŸ¬ ë°œìƒ.");

        return appError;
    }
}
```

![img_9.png](img_9.png)

- ### ìƒíƒœ ì½”ë“œì— ë”°ë¥¸ ì—ëŸ¬ í˜ì´ì§€.

> src/main/resources/staric | template /error/
> > 404.html, 5xx.html

![img_10.png](img_10.png)

# ğŸ“Œ Cross Origin Resource Sharing

****

- ### ìŠ¤í”„ë§ MVCì—ì„œ ì§€ì›í•˜ëŠ” Single-Origin Policy(SOP)ë¥¼ ìš°íšŒí•˜ê¸° ìœ„í•œ í‘œì¤€ ê¸°ìˆ .

    ğŸ§ Origin : URL ìŠ¤í‚¤ë§ˆ(http,https), HostName, Portë¥¼ ì¡°í•©í•œ ê²ƒ.

- ### ìŠ¤í”„ë§ MVC @CrossOrigin
> ServerëŠ” 18080í¬íŠ¸, ClientëŠ” 8080 í¬íŠ¸ë¡œ ì„¤ì •.


![img_11.png](img_11.png)

### 1. @CrossOrigin
```java
@CrossOrigin("http://localhost:8080")
@GetMapping("/cross")
public String cross(){
    return "Hello Cross Server";
}
```


### 2. WebMvcConfigurer
```java
@Configuration
public class WebCofiguration implements WebMvcConfigurer {

    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/cross") // ì „ë¶€: /**
        .allowedOrigins("http://localhost:8080");

    }
}

```

![img_12.png](img_12.png)


# ğŸ“ƒ <mark style="background-color:#fff5b1">ìŠ¤í”„ë§ ë°ì´í„°<mark>
*****

# ğŸ“Œ Inmemory Database
****

```java
@Autowired
DataSource dataSource;

@Autowired
JdbcTemplate jdbcTemplate;

@Override
public void run(ApplicationArguments args) throws Exception {

    try(Connection connection = dataSource.getConnection()){
        System.out.println(connection.getMetaData().getUserName());
        System.out.println(connection.getMetaData().getURL());

        Statement statement = connection.createStatement();
        String sql = "CREATE TABLE USER(ID INTEGER  NOT null, name Varchar(255), PRIMARY Key(ID))";
        statement.executeUpdate(sql);
    }

    jdbcTemplate.execute("INSERT into user values (1, 'taejun')");
}
```
> JdbcTemplateë¥¼ ì‚¬ìš©í•˜ë©´ ê°„ê²°í•˜ê²Œ ì‘ì„±ê°€ëŠ¥, ì˜ˆì™¸ì˜ ê°€ë…ì„±ì´ ì¢‹ìŒ. ë¦¬ì†ŒìŠ¤ ë°˜ë‚©ì²˜ë¦¬ê°€ ì˜ ë˜ì–´ìˆìŒ.

```properties
spring.h2.console.enabled=true
spring.datasource.url=jdbc:h2:mem:testdb
spring.jpa.show-sql=true
```

# ğŸ“Œ MySQL
***
- ### DBCP
> spring ì—ì„œëŠ” ê¸°ë³¸ì ìœ¼ë¡œ HikariCP ë¼ëŠ” DBCPë¥¼ ì§€ì›.
> ì´ ì™¸ : Tomcat CP, Commons DBCP2

#### DBCP ì„¤ì •
```properties
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.auto-commit=true
spring.datasource.hikari.maximum-pool-size=10
...
```

- ### MySQL ì»¤ë„¥í„° ì˜ì¡´ì„± ì¶”ê°€.
```xml
<dependency>
    <groupId>mysql</groupId>
    <artifactId>mysql-connector-java</artifactId>
</dependency>
```

- ### MySQL ë„ì»¤ë¡œ ì¶”ê°€.

```
docker run -p 3306:3306 --name mysql_boot -e MYSQL_ROOT_PASSWORD=1 -e MYSQL_USER=kim -e MYSQL_DATABASE=springboot -e MYSQL_PASSWORD=pass -d mysql

docker exec -i -t mysql_boot bash

mysql -u root -p
```

- ### MySQLìš© DataSource ì„¤ì •
```properties
spring.datasource.url=jdbc:mysql://localhost:3306/springboot?useSSL=false
spring.datasource.username=kim
spring.datasource.password=pass
```

# ğŸ“Œ PostgreSQL
***
```xml
<dependency>
    <groupId>org.postgresql</groupId>
    <artifactId>postgresql</artifactId>
</dependency>
```

- ### PostgreSQL ë„ì»¤ë¡œ ì¶”ê°€.

```
docker run -p 5432:5432 --name postgres_boot -e POSTGRES_USER=kim -e POSTGRES_DB=springboot -e POSTGRES_PASSWORD=pass -d postgres

docker exec -i -postgres_boot bash

su -postgres

psql springboot

// ë°ì´í„° ë² ì´ìŠ¤ ì¡°íšŒ
\list

í…Œì´ë¸” ì£„íšŒ
\dt
```

- ### DataSource ì„¤ì •
```properties
spring.datasource.url=jdbc:postgresql://localhost:5432/springboot
spring.datasource.username=kim
spring.datasource.password=pass
```


# ğŸ“Œ Spring Data JPA
***
### ORM(Object-Relational Mapping)ê³¼ JPA(Java Persistence API)
    - ê°ì²´ì™€ ë¦´ë ˆì´ì…˜ì„ ë§¤í•‘í•  ë•Œ ë°œìƒí•˜ëŠ” ê°œë…ì  ë¶ˆì¼ì¹˜ë¥¼ í•´ê²°í•˜ëŠ” í”„ë ˆì„ì›Œí¬.
    - JPA : ORMì„ ìœ„í•œ ìë°” í‘œì¤€

> Spring Data JPA -> JPA -> Hibernate -> DAtasource

- ì˜ì¡´ì„± ì¶”ê°€
```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-jpa</artifactId>
</dependency>
```
```java
public interface AccountRepository extends JpaRepository<Account, Long> {
    List<Account> findByUserName(String userName);
}
```

```java
@RunWith(SpringRunner.class)
@DataJpaTest
//@SpringBootTest(properties = "spring.datasource.url=jdbc:h2:mem:testdb")
public class AccountRepositoryTest {
    @Autowired
    DataSource dataSource;
    @Autowired
    JdbcTemplate jdbcTemplate;
    @Autowired
    AccountRepository accountRepository;

    @Test
    public void di() throws SQLException {
        try(Connection connection = dataSource.getConnection()){
            System.out.println(connection.getMetaData().getURL());
            System.out.println(connection.getMetaData().getDriverName());
        }
        Account account = new Account();
        account.setPassword("123");
        account.setUserName("kim");

        accountRepository.save(account);
        List<Account> results = accountRepository.findByUserName("kim");
        assertThat(results.get(0).getUserName()).isEqualTo("kim");
    }
}
```
- Datasource, JdbcTemplate ë˜í•œ ì£¼ì… ê°€ëŠ¥.

- @SpringBootTestë¥¼ ì´ìš©í•˜ì—¬ í†µí•© í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•˜ê²Œ ë˜ë©´ Testìš© DBê°€ ì•„ë‹Œ ìš´ì˜ DBê°€ ì‚¬ìš©ë˜ê²Œ ë¨.
- @SpringBootTest(properties = "spring.datasource.url=")ë¡œ ì˜¤ë²„ë¼ì´ë”© í•˜ì—¬ DBë¥¼ ë³€ê²½í•  ìˆ˜ ìˆë‹¤. 

# ğŸ“Œ ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™”
***

- ## Schemaì˜ ìë™ ìƒì„±
### 1. properties ì„¤ì •.
```properties
spring.jpa.hibernate.ddl-auto=update
spring.jpa.generate-ddl=true
```
- update : ê¸°ì¡´ì˜ ê²ƒì€ ë‘ê³ , ì¶”ê°€ëœ ê²ƒë§Œ ìƒì„±.
- create : ì „ë¶€ dropí•œ í›„ ìƒˆë¡œ ìƒì„±.
- create-drop : ìƒˆë¡œ ìƒì„±í•œ í›„, ì¢…ë£Œë  ë•Œ ëª¨ë‘ drop

### 2.ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì´ìš©í•œ ì„¤ì •.
- resource/schema.sql :  í…Œì´ë¸” ìƒì„±í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸.
- resource/data.sql : ì´ˆê¸° ë°ì´í„°.


- ## Schema ê²€ì¦
```properties
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.generate-ddl=false #(default)
```
:: ì—”í‹°í‹°ì™€ ë¦´ë ˆì´ì…˜ DBê°€ ë§¤í•‘í•  ìˆ˜ ìˆëŠ” ìƒí™©ì¸ì§€ ê²€ì¦. ë§¤í•‘í•  ìˆ˜ ì—†ë‹¤ë©´ ì—ëŸ¬ë°œìƒ. 


# ğŸ“Œ Database Migration
****
> Schemaì˜ ë²„ì „ê´€ë¦¬.   
> ë§ˆì´ê·¸ë ˆì´ì…˜ íˆ´ : Flyway, Liquibase

- ### Flyway ì˜ì¡´ì„± ì¶”ê°€.
```xml
<dependency>
        <groupId>org.flywaydb</groupId>
        <artifactId>flyway-core</artifactId>
</dependency>
```


![img_13.png](img_13.png)
> í…Œì´ë¸”ì„ ëª¨ë‘ ì§€ìš°ê³  validateë¡œ ì‹¤í–‰ì‹œ tableì´ ì—†ì–´ ì—ëŸ¬ ë°œìƒ.

- ### ë§ˆì´ê·¸ë ˆì´ì…˜ ë””ë ‰í† ë¦¬
    - db/migration or db/migration/{vender}
    - spring.flyway.locationìœ¼ë¡œ ìœ„ì¹˜ ë³€ê²½ ê°€ëŠ¥.

- ### ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ì´ë¦„.
    - Vìˆ«ì__ì´ë¦„.sql : VëŠ” ê¼­ ëŒ€ë¬¸ì, ìˆ«ìëŠ” ìˆœì°¨ì , ì–¸ë”ë°” ë‘ê°œ, ì´ë¦„ì€ ê°€ëŠ¥í•œ ì„œìˆ ì ìœ¼ë¡œ.

#### -- V1__init.sql
```sql
create sequence hibernate_sequence start with 1 increment by 1;
create table account (id int8 not null, password varchar(255), user_name varchar(255), primary key (id));
```
![img_14.png](img_14.png)

> í…Œì´ë¸”ì„ ìƒì„±í•´ì£¼ë©° ê²€ì¦ ì„±ê³µ.
> - flyway_schema_history : flywayê°€ ìì‹ ì˜ ì •ë³´ë¥¼ ê´€ë¦¬í•˜ëŠ” í…Œì´

#### -- column ì¶”ê°€. (V2__add_account_active.sql)
```sql
ALTER TABLE account ADD COLUMN active BOOLEAN;
```



# ğŸ“Œ Spring Security
****
- ### ì˜ì¡´ì„± ì¶”ê°€
```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-security</artifactId>
</dependency>
```

- ### ìŠ¤í”„ë§ ì‹œíë¦¬í‹°
  - ì›¹ ì‹œíë¦¬í‹°
  - ë©”ì†Œë“œ ì‹œíë¦¬í‹°
  - ë‹¤ì–‘í•œ ì¸ì¦ ë°¥ë²• ì§€ì› : LDAP, í¼ ì¸ì¦, Basic ì¸ì¦, OAuth, ...
  

- ### ìŠ¤í”„ë§ ë¶€íŠ¸ ì‹œíë¦¬í‹° ìë™ ì„¤ì •
  - SecurityAutoConfiguration : ì‚¬ì‹¤ìƒ spring boot ì—ì„œ ë³€ê²½í•œ ë¶€ë¶„ì€ ë³„ë¡œ ì—†ë‹¤.
  - UserDetatilsSeviceAutoConfiguration :
    > UserDetailsService.class, AuthenticationManager.class, AuthenticationProvider.class ê°€ ì—†ì„ ë•Œ ì„¤ì • íŒŒì¼ì´ ì ìš©ë˜ê³ , 
    ëœë¤í•œ ìœ ì €ë¥¼ ìƒì„±í•´ ì¤€ë‹¤.

- ### ê¸°ë³¸ ì‚¬ìš©ì.
  - UserName : user
  - password : applicationì„ ì‹¤í–‰ í•  ë•Œ ë§ˆë‹¤ ìƒì„±ë˜ëŠ” ëœë˜ ê°’(consoleì— ì¶œë ¥ë¨.)
  - spring.security.username
  - spring.security.password
  

- ## ìŠ¤í”„ë§ ì‹œíë¦¬í‹° Test
```xml
<dependency>
    <groupId>org.springframework.security</groupId>
    <artifactId>spring-security-test</artifactId>
</dependency>
```

### 1. method
```java
mockMvc.perform(get("/hello")
                .with(user("kim").password("1234"))
```
> ê°€ì§œ ì¸ì¦ ìœ ì €ë¥¼ ë„£ì–´ì£¼ì–´, ê¶Œí•œì´ ì—†ì–´ ì‹¤í–‰í•  ìˆ˜ ì—†ëŠ” í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤.

### 2. Annotation
```java
@WithMockUser
class or Method
```
> ìœ ì € ì •ë³´ë¥¼ ì§ì ‘ ë„£ì–´ì£¼ì–´ í…ŒìŠ¤íŠ¸.


# ğŸ“Œ Spring Security Custom
***

## 1. extends WebSecurityConfigurerAdapter
```java
//@Configuration
@EnableWebSecurity
public class SecurityConfig extends WebSecurityConfigurerAdapter {

    @Override
    protected void configure(HttpSecurity http) throws Exception {
      http.authorizeRequests()
              .antMatchers("/admin").hasRole(Role.ADMIN.name())  // admin URLì€ ê´€ë¦¬ì ì ‘ê·¼ ê°€ëŠ¥.
              .antMatchers("/my").hasRole(Role.STUDENT.name())  // my URL ì€ í•™ìƒë§Œ ì ‘ê·¼ ê°€ëŠ¥
              .anyRequest().permitAll() // ë‚˜ë¨¸ì§€ URLì€ ì¸ì¦ í•„ìš”.
              .and()
            .formLogin()// ë§Œë“¤ì–´ì£¼ëŠ” formLogin template ì‚¬ìš©.
              .and()
            .httpBasic() // accept headerì— httpê°€ ì—†ëŠ” ê²½ìš° httpBasic ì‚¬ìš©.
              .and()
            .logout()
              .logoutSuccessUrl("/");
    }

    @Bean
    public PasswordEncoder passwordEncoder(){
        return PasswordEncoderFactories.createDelegatingPasswordEncoder();
    }
}
```
> - confugure ë©”ì†Œë“œë¥¼ ì˜¤ë²„ë¼ì´ë”© í•˜ì—¬ ì ‘ê·¼ ê¶Œí•œ, ë¡œê·¸ì¸ í¼ ë“± ì„¤ì •.ì„
> > hasRole ì—ì„œ ìë™ìœ¼ë¡œ ì•ì— ROLE_ ì„ ë¶™ì—¬ì£¼ê¸° ë•Œë¬¸ì— .name()ìœ¼ë¡œ ê°€ì ¸ì˜´.

## 2. implements UserDatailsService
```java
@Service
public class AccountService implements UserDetailsService {
    @Autowired
    private AccountRepository accountRepository;
    @Autowired
    private PasswordEncoder passwordEncoder;

    // User ì •ë³´ë¥¼ ë°›ì•„ ê³„ì • ìƒì„±.
    public Account createAccount(String username, String password){
        Account account = new Account();
        account.setUserName(username);
        account.setPassword(passwordEncoder.encode(password));

        return accountRepository.save(account);
    }


    @Override
    public UserDetails loadUserByUsername(String userName) throws UsernameNotFoundException {
          Optional<Account> byUserName= accountRepository.findByUserName(userName);
          Account account =  byUserName.orElseThrow(()-> new UsernameNotFoundException(userName)); // ì—†ìœ¼ë©´ ì˜ˆì™¸ë¥¼ ë˜ì§€ê³ , ìˆìœ¼ë©´ Account ê°ì²´ return
    
          return new User(account.getUserName(), account.getPassword(), authorities(account));
    }
    
    private Collection<? extends GrantedAuthority> authorities(Account account) {
        return Arrays.asList(new SimpleGrantedAuthority(account.getRole().getKey()));
    }
}
```
> - ìœ ì €ì— ëŒ€í•œ í´ë˜ìŠ¤ì¸ Userì„ Spring Securityì—ì„œ ì§€ì›. ì‚¬ìš©ìê°€ ì…ë ¥í•œ ì •ë³´ì™€ DBì— ì €ì¥ëœ ìœ ì € ì •ë³´ë¥¼ ë¹„êµí•˜ê³  ì¡´ì¬í•˜ë©´ ROLE ë¶€ì—¬.
> - getKey()ê°’ìœ¼ë¡œ ê¶Œí•œì„ ìƒì„±.

## 3.Password Encode 
```java
// config í´ë˜ìŠ¤ì— ì •ì˜.
@Bean
public PasswordEncoder passwordEncoder(){
    return PasswordEncoderFactories.createDelegatingPasswordEncoder();
}

// Service í´ë˜ìŠ¤ì—ì„œ ì‚¬ìš©.
@Autowired
private PasswordEncoder passwordEncoder;
account.setPassword(passwordEncoder.encode(password));
```
> - Password ì¸ì½”ë”ë¥¼ Beanìœ¼ë¡œ ì •ì˜.
> - Passwordë¥¼ DBì— ì €ì¥í•˜ê¸° ì „ ì•”í˜¸í™”í•˜ê³  ì €ì¥.
> > ![img_15.png](img_15.png)


# ğŸ“Œ Spring Rest Client
***

- ### RestTemplate
> - Blocking I/O ê¸°ë°˜ì˜ Synchronous API
> - RestTemplateAutoConfiguration
> - í”„ë¡œì íŠ¸ì— spring-web ëª¨ë“ˆì´ ìˆë‹¤ë©´ RestTemplateBuilderë¥¼ ë¹ˆìœ¼ë¡œ ë“±ë¡í•´ ì¤€ë‹¤.


```java
private final RestTemplateBuilder restTemplateBuilder;

@Override
public void run(ApplicationArguments args) throws Exception {
    RestTemplate restTemplate = restTemplateBuilder.build();
    
    String helloResult = restTemplate.getForObject("http://localhost:8080/hello", String.class);
    String worldResult = restTemplate.getForObject("http://localhost:8080/world", String.class);
}
```

- ### WebClient
> - Nono-Blocking I/O ê¸°ë°˜ì˜ Asynchronous API
> - WebClientAutoConfiguration
> - í”„ë¡œì íŠ¸ì— spring-webflux ëª¨ë“ˆì´ ìˆë‹¤ë©´ WebClient.Builderë¥¼ ë¹ˆìœ¼ë¡œ ë“±ë¡í•´ ì¤€ë‹¤.


```java
private final WebClient.Builder builder;

@Override
public void run(ApplicationArguments args) throws Exception {
    WebClient webClient = builder.build();


    Mono<String> helloMono = webClient.get().uri("http://localhost:8080/hello")
            .retrieve()
            .bodyToMono(String.class);
    helloMono.subscribe(s->{
        System.out.println(s);
    });

    Mono<String> worldMono = webClient.get().uri("http://localhost:8080/world")
            .retrieve()
            .bodyToMono(String.class);
    worldMono.subscribe(s->{
        System.out.println(s);
    });
}
```

- ## WebClient ì»¤ìŠ¤í„° ë§ˆì´ì§•
![img_16.png](img_16.png)

- #### ë¡œì»¬ ì»¤ìŠ¤í„°ë§ˆì´ì§•
```java
WebClient webClient = builder
                .baseUrl("http://localhost:8080")
                .build();
```

- #### ê¸€ë¡œë²Œ ì»¤ìŠ¤í„°ë§ˆì´ì§•
```java
@Bean
  public WebClientCustomizer webClientCustomizer(){
      return new WebClientCustomizer() {
          @Override
          public void customize(WebClient.Builder webClientBuilder) {
              webClientBuilder.baseUrl("http://localhost:8080");
          }
      };
  }
```