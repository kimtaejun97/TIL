# ğŸ“ƒ ëª©ì°¨
- #### âœï¸ [JPAë€?](#-jpa)
- #### âœï¸[ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸(Persistence Context)](#-ì˜ì†ì„±-ì»¨í…ìŠ¤íŠ¸-persistence-context)
- #### âœï¸[Flush](#-flush)
- #### âœï¸[ì—”í‹°í‹° ë§¤í•‘](#-ì—”í‹°í‹°-ë§¤)
- #### âœï¸[ì—°ê´€ê´€ê³„ ë§¤í•‘](#-ì—°ê´€ê´€ê³„-ë§¤í•‘)
- #### âœï¸[ë‹¤ì–‘í•œ ì—°ê´€ê´€ê³„ ë§¤í•‘](#-ë‹¤ì–‘í•œ-ì—°ê´€ê´€ê³„-ë§¤í•‘)
- #### âœï¸[ìƒì†ê´€ê³„ ë§¤í•‘](#-ìƒì†ê´€ê³„-ë§¤í•‘)
- #### âœï¸[@MappedSuperclass](#-mappedsuperclass)
- #### âœï¸[í”„ë¡ì‹œ(Proxy)](#-í”„ë¡ì‹œ)
- #### âœï¸[ì¦‰ì‹œ ë¡œë”©ê³¼ ì§€ì—° ë¡œë”©](#-ì¦‰ì‹œ-ë¡œë”©ê³¼-ì§€ì—°-ë¡œë”©)
- #### âœï¸[ì˜ì†ì„± ì „ì´ Cascadeì™€ ê³ ì•„ ê°ì²´](#-ì˜ì†ì„±-ì „ì´-cascadeì™€-ê³ ì•„-ê°ì²´)
- #### âœï¸[ê°’ íƒ€ì…](#-ê°’-íƒ€ì…)
- #### âœï¸[ê°ì²´ì§€í–¥ ì¿¼ë¦¬ ì–¸ì–´ JPQL](#-ê°ì²´ì§€í–¥-ì¿¼ë¦¬-ì–¸ì–´jpql)
- #### âœï¸[í”„ë¡œì ì…˜](#-í”„ë¡œì ì…˜)
- #### âœï¸[í˜ì´ì§•](#-í˜ì´ì§•)
- #### âœï¸[ì¡°ì¸](#-ì¡°ì¸)
- #### âœï¸[ì„œë¸Œ ì¿¼ë¦¬](#-ì„œë¸Œ-ì¿¼ë¦¬)
- #### âœï¸[JPQL íƒ€ì… í‘œí˜„](#-jpql-íƒ€ì…-í‘œí˜„)
- #### âœï¸[ì¡°ê±´ì‹, Case](#-ì¡°ê±´ì‹case-ë“±)
- #### âœï¸[JPQL í•¨](#-jpql--í•¨ìˆ˜)
- #### âœï¸[ê²½ë¡œ í‘œí˜„ì‹](#-ê²½ë¡œ-í‘œí˜„ì‹)
- #### âœï¸[Fetch Join](#-fetch-join)
- #### âœï¸[ë‹¤í˜•ì„± ì¿¼ë¦¬](#-ë‹¤í˜•ì„±-ì¿¼ë¦¬)
- #### âœï¸[ì—”í‹°í‹° ì§ì ‘ ì‚¬ìš©](#-ì—”í‹°í‹°-ì§ì ‘-ì‚¬ìš©)
- #### âœï¸[Named ì¿¼ë¦¬](#-named-ì¿¼ë¦¬)
- #### âœï¸[ë²Œí¬ ì—°ì‚°](#-ë²Œí¬-ì—°ì‚°)

<br>
<br>
<br>

### ğŸ¤” SQL ì¤‘ì‹¬ì ì¸ ê°œë°œì˜ ë¬¸ì œ.
> - ë°˜ë³µì ì¸ SQLì˜ ì‘ì„±, ìœ ì§€ë³´ìˆ˜ê°€ í˜ë“¤ë‹¤.
> - ê°ì²´, ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ì˜ íŒ¨ëŸ¬ë‹¤ì„ ë¶ˆì¼ì¹˜.
> - ìƒì†, ì—°ê´€ê´€ê³„, ë°ì´í„° íƒ€ì…, ë°ì´í„° ì‹ë³„ ë°©ë²• ë“±ì˜ ì°¨ì´.

> - ì²˜ìŒ ì‹¤í–‰í•˜ëŠ” SQLì— ë”°ë¼ íƒìƒ‰ ë²”ìœ„ê°€ ê²°ì •ëœë‹¤.
> > - ì²˜ìŒì— memberì˜ teamë§Œ joiní•˜ì˜€ë‹¤ë©´ teamì€ ì–»ì–´ì˜¬ ìˆ˜ ìˆì§€ë§Œ joiní•˜ì§€ ì•Šì€ orderì— ëŒ€í•œ ì •ë³´ë¥¼ êº¼ë‚¼ ìˆ˜ ì—†ë‹¤.
> > - ì—”í‹°í‹° ì‹ ë¢° ë¬¸ì œê°€ ë°œìƒí•œë‹¤. ì–´ë–¤ ì •ë³´ë¥¼ ê°€ì ¸ì™”ëŠ”ì§€ ì•Œ ìˆ˜ ì—†ê¸° ë•Œë¬¸ì—, í•¨ë¶€ë¡œ ë°ì´í„°ë¥¼ êº¼ë‚¼ ìˆ˜ ì—†ê²Œëœë‹¤.

> - ê°ì²´ ë‹µê²Œ ëª¨ë¸ë§ì„ í•  ìˆ˜ë¡ ë§¤í•‘ ì‘ì—…ë§Œ ëŠ˜ì–´ë‚œë‹¤.(ìƒì†, equals ë“± ..)
> > ğŸ¤” ê°ì²´ë¥¼ ìë°” ì»¬ë ‰ì…˜ì— ì €ì¥ í•˜ë“¯ì´ DBì— ì €ì¥ í•  ìˆ˜ ì—†ì„ê¹Œ?   
> > -> JPAì˜ ë“±ì¥.


# ğŸ“Œ JPA?
****
> - Java Persistence API
> - ìë°” ì§„ì˜ì˜ ORM ê¸°ìˆ  í‘œì¤€   
> - ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ JDBC ì‚¬ì´ì—ì„œ ë™ì‘.
> 
> ğŸ¤” ORM? Object Relational Mapping:
> ê°ì²´ëŠ” ê°ì²´ëŒ€ë¡œ, ê´€ê³„í˜• DBëŠ” ê´€ê³„í˜• DB ëŒ€ë¡œ ì„¤ê³„, ORM í”„ë ˆì„ì›Œí¬ê°€ ì¤‘ê°„ì—ì„œ ë§¤í•‘.

- JPAëŠ” ì¸í„°í˜ì´ìŠ¤ì˜ ëª¨ìŒ
- JPA 2.1 í‘œì¤€ ëª…ì„¸ë¥¼ êµ¬í˜„í•œ êµ¬í˜„ì²´ :Hibernate, EclipseLink, DataNucleus

## ğŸ§ JPAë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ 
> SQL ì¤‘ì‹¬ ê°œë°œì—ì„œ ê°ì²´ ì¤‘ì‹¬ ê°œë°œë¡œ.
â„â„â„
- ### â˜ï¸ ìƒì‚°ì„±
    - CRUD ë©”ì†Œë“œê°€ ê°„ë‹¨í•œë‹¤(persist(), find(), set*(), remove())

- ### â˜ï¸ ìœ ì§€ë³´ìˆ˜
    - ê¸°ì¡´: í•„ë“œ ìˆ˜ì • ëª¨ë“  SQL ìˆ˜ì •.
    - JPA: í•„ë“œë§Œ ì¶”ê°€í•˜ë©´ ëœë‹¤. SQLì€ JPAì—ì„œ ê´€ë¦¬.
    
- ### â˜ï¸ íŒ¨ëŸ¬ë‹¤ì„ì˜ ë¶ˆì¼ì¹˜ í•´ê²°
  > âœï¸ ìƒì†
  > - ì €ì¥: í•˜ë‚˜ì˜ ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ë©´ ìƒìœ„ í´ë˜ìŠ¤ì™€ í•˜ìœ„ í´ë˜ìŠ¤ë¥¼ ë‚˜ëˆ„ì–´ ì¿¼ë¦¬ë¥¼ ìƒì„±, ê°ê° ë°ì´í„°ë¥¼ ì €ì¥í•œë‹¤.
  > - ì¡°íšŒ: í•„ìš”í•œ ë°ì´í„°ë¥¼ ìë™ìœ¼ë¡œ ì¡°ì¸í•´ì„œ ê°€ì ¸ì˜¨ë‹¤.   
  > 
  > âœï¸ ì—°ê´€ê´€ê³„, ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰
  > - ìë°” ì»¬ë ‰ì…˜ì„ ì‚¬ìš©í•˜ë“¯ì´ ë°ì´í„°ë¥¼ ì €ì¥í•˜ê³ , ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.
  > - ì§€ì—°ë¡œë”©ì„ ì´ìš©í•œ ììœ ë¡œìš´ ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰ -> ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì—”í‹°í‹°
  > 
  > âœï¸ ì—”í‹°í‹°ì˜ ë¹„êµ
  > - ê¸°ì¡´: ë™ì¼í•œ ë°ì´í„°ë¥¼ ê°€ì¡Œë”ë¼ë„ ìƒˆë¡œ ê°ì²´ë¥¼ ìƒì„±í•˜ê¸° ë•Œë¬¸ì— '==' ë¹„êµë¥¼ í–ˆì„ ë•Œ ë‹¤ë¥¸ ê°ì²´ë¡œ ë‚˜ì˜¤ê²Œ ëœë‹¤. equalsì˜ ì¬ì •ì˜ í•„ìš”.
  > - JPA: ë™ì¼í•œ íŠ¸ë™ì­ì…˜ì—ì„œ ì¡°íšŒí•œ ì—”í‹°í‹°ëŠ” ê°™ìŒì„ ë³´ì¥í•œë‹¤.
  > 
  > âœï¸ JPAì˜ ì„±ëŠ¥ ìµœì í™”
  > - 1ì°¨ ìºì‹œì™€ ë™ì¼ì„± ë³´ì¥
  >     - ê°™ì€ íŠ¸ë™ì­ì…˜ ì•ˆì—ì„œëŠ” ê°™ì€ ì—”í‹°í‹°ë¥¼ ë°˜í™˜ -> ì•½ê°„ì˜ ì¡°íšŒ ì„±ëŠ¥ í–¥ìƒ
  >     - DB Isolation Levelì´ Read Commit ì´ì–´ë„ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ Repeatable Read ë³´ì¥.
  >     ```java
  >     Member m1 = jpa.find(Member.class, 0); // SQL
  >     Member m2 = jpa.find(Member.class, 0); // Cache
  >     m1 == m2 // true
  >     ```
  >   ğŸ– ê²°ê³¼ì ìœ¼ë¡œ SQLì€ í•œë²ˆë§Œ ì‹¤í–‰ëœë‹¤.
  >  
  > âœï¸ íŠ¸ëœì­ì…˜ì„ ì§€ì›í•˜ëŠ” ì“°ê¸° ì§€ì—°
  > - íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í•  ë•Œ ê¹Œì§€ INSERT SQLì„ ëª¨ìŒ.
  > - JDBC BATCH SQL ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ì„œ í•œë²ˆì— SQL ì „ì†¡.
  > - ë„¤íŠ¸ì›Œí¬ ì „ì†¡ íšŸìˆ˜ë¥¼ ì¤„ì¼ ìˆ˜ ìˆë‹¤.
  >   ```java
  >   transaction.begin(); // íŠ¸ëœì­ì…˜ ì‹œì‘
  >   em.persist(A);
  >   em.persist(B);
  >   em.persist(C);
  >   transaction.commit() // íŠ¸ëœì­ì…˜ ì»¤ë°‹
  >   ```
  > âœï¸ ì§€ì—° ë¡œë”©, ì¦‰ì‹œ ë¡œë”©
  > - ğŸ– ì§€ì—° ë¡œë”© : ê°ì²´ê°€ ì‹¤ì œ ì‚¬ìš©ë  ë•Œ ë¡œë”©.(ì¿¼ë¦¬ê°€ ì¦ê°€í•  ìˆ˜ ìˆë‹¤.)
  > - ğŸ– ì¦‰ì‹œ ë¡œë”©: JOIN SQLë¡œ í•œë²ˆì— ì—°ê´€ëœ ê°ì²´ê¹Œì§€ <strong>ë¯¸ë¦¬ ì¡°íšŒ.</strong>
  > - JPAì—ì„œëŠ” ì˜µì…˜ìœ¼ë¡œ ì„¤ì •ì´ ê°€ëŠ¥í•˜ë‹¤.
  > - í•­ìƒ í•¨ê»˜ ë¡œë”©í•´ì•¼ í•˜ëŠ” ë°ì´í„°ê°€ ìˆë‹¤ -> ì¦‰ì‹œ ë¡œë”©ì´ ìœ ë¦¬í•  ìˆ˜ ìˆë‹¤.(ì¿¼ë¦¬ ìˆ˜ê°€ ì ì–´ì§„ë‹¤.)
  > 

# ğŸ“Œ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ (Persistence Context)
***
> - JPAë¥¼ ì´í•´í•˜ê¸°ì— ê°€ì¥ ì¤‘ìš” ê°œë….
> - ì—”í‹°í‹°ë¥¼ ì˜êµ¬ ì €ì¥í•˜ëŠ” í™˜ê²½ ```EntityManager.persist(entity)```
> - J2SE í™˜ê²½ : EntityManager,PersistenceContextëŠ” 1:1
> - J2EE, springê³¼ ê°™ì€ ì»¨í…Œì´ë„ˆ í™˜ê²½ : N:1

### â˜ï¸ ì—”í‹°í‹°ì˜ ìƒëª… ì£¼ê¸°
![img_1.png](img/img_1.png)

### â˜ï¸ ë¹„ì˜ì†
- ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì™€ ì•„ë¬´ ê´€ê³„ê°€ ì—†ëŠ” ìƒíƒœ, (ìƒˆë¡œ ìƒì„±ëœ ê°ì²´ ë“±)

### â˜ï¸ ì˜ì†(persist)
- ê°ì²´ë¥¼ ì €ì¥í•œ ìƒíƒœ ```em.persist(entity)```
- ê°ì²´ë¥¼ find() ```em.find(entity.class, entity)```

### â˜ï¸ ì¤€ì˜ì†(detached)
- ì—”í‹°í‹°ê°€ ì˜ì†ì„± ì»¨í…íŠ¸ìŠ¤ì—ì„œ ë¶„ë¦¬ëœ ìƒíƒœ. ```em.detach(entity)```
- ê°ì²´ë¥¼ ì‚­ì œí•œ ìƒíƒœ ```em.remove(entity)```
- ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ì´ˆê¸°í™” ```em.clear()```
- ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ì¢…ë£Œ ```em.close()```


## ğŸ§ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ ì´ì 

  - ### â˜ï¸ 1ì°¨ ìºì‹œ
    ![img_2.png](img/img_2.png)
    > - ë™ì¼í•œ íŠ¸ëœì ì…˜ì—ì„œ ë‹¤ì‹œ ì¡°íšŒë¥¼ í•˜ë©´ ë¨¼ì € 1ì°¨ ìºì‹œì—ì„œ ì¡°íšŒ.
    > - ìºì‹œì— ì¡´ì¬í•˜ë©´ ìºì‹œì—ì„œ ê°€ì ¸ì˜¤ê³  ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´ DBì—ì„œ ì¡°íšŒ, ìºì‹œì— ì €ì¥.
    > 
    ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ 1ì°¨ ìºì‹œì˜ ì¡°íšŒëŠ” ì¡°íšŒì˜ íŒŒë¼ë¯¸í„°ê°€ ì‹ë³„ìì¼ ê²½ìš°ì—ë§Œ ê°€ëŠ¥í•˜ë‹¤.(1ì°¨ ìºì‹œì˜ í‚¤ê°€ ì‹ë³„ìì´ê¸° ë•Œë¬¸)
    
    ì˜ˆë¥¼ ë“¤ì–´ ì²˜ìŒì— findById()ë¥¼ ì´ìš©í•˜ì—¬ ì¡°íšŒí•œ í›„ì— findByUsername() ì„ ì´ìš©í•˜ì—¬
    usename ìœ¼ë¡œ ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•˜ê²Œ ëœë‹¤ë©´, ë™ì¼í•œ ê²ƒì„ ì—”í‹°í‹°ë¥¼ ê°€ì ¸ì˜¤ë”ë¼ë„ 1ì°¨ ìºì‹œì—ì„œ usernameì„ í‚¤ë¡œ í•œ ì—”í‹°í‹°ë¥¼
    ì°¾ì„ ìˆ˜ ì—†ì–´ ìƒˆë¡œ DBì—ì„œ ì¡°íšŒí•´ì˜¨ë‹¤.
    
    ê·¸ë ‡ë‹¤ë©´ ë°˜ëŒ€ì˜ ìˆœì„œë¡œ ì¡°íšŒí•œë‹¤ë©´ ì–´ë–¨ê¹Œ? ì´ ê²½ìš°ì—ëŠ” username ìœ¼ë¡œ ì¡°íšŒëœ ì—”í‹°í‹°ì˜ ì‹ë³„ìë¥¼ í‚¤ë¡œ
    ì—”í‹°í‹°ë¥¼ 1ì°¨ ìºì‹œì— ë³´ê´€í•˜ê¸° ë•Œë¬¸ì— ì²« username ìœ¼ë¡œ ì¡°íšŒí•  ë•Œë§Œ í•œë²ˆì˜ ì¿¼ë¦¬ê°€ ë°œìƒí•œë‹¤.
    
    **ê·¸ë ‡ë‹¤ë©´ Idë¡œ ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•œ ë‹¤ìŒì— JPQLì„ ì´ìš©í•˜ì—¬ ì¡°íšŒí•˜ê²Œ ëœë‹¤ë©´?**
    2ë²ˆì˜ ì¿¼ë¦¬ê°€ ë°œìƒí•œë‹¤. JPQLì€ ìºì‹œë¥¼ ê±°ì¹˜ì§€ ì•Šê³  DBì— ì§ì ‘ ì¿¼ë¦¬í•˜ê¸° ë•Œë¬¸ì— ìºì‹œì˜ ì—¬ë¶€ì™€ ìƒê´€ì—†ì´
    ì¿¼ë¦¬ê°€ ë°œìƒí•œë‹¤.
  
  - ### â˜ï¸ ì˜ì† ì—”í‹°í‹°ì˜ ë™ì¼ì„± ë³´ì¥
    > - ì—¬ëŸ¬ë²ˆ ì¡°íšŒí•˜ì—¬ ê°™ì€ ì—”í‹°í‹°ë¥¼ ê°€ì ¸ì˜¤ë©´ == ë™ì¼ì„± ë¹„êµ true
  
  - ### â˜ï¸ íŠ¸ëœì­ì…˜ì„ ì§€ì›í•˜ëŠ” ì“°ê¸° ì§€ì—°
    > - commit ë˜ëŠ” flush ì „ê¹Œì§€ ì“°ê¸°ì§€ì—° ì €ì¥ì†Œì— ìƒì„±ëœ sqlì„ ì €ì¥í•˜ë‹¤ê°€ í•œë²ˆì— ì „ì†¡.
    
  - ### â˜ï¸ ì—”í‹°í‹° ë³€ê²½ ê°ì§€.
    > - commit ì‹œì ì— flush ê°€ ì‹¤í–‰ë˜ë©° ìë™ìœ¼ë¡œ ì—”í‹°í‹° ë³€ê²½ ì‚¬í•­ì„ ê°ì§€(ì—”í‹°í‹°ì™€ ìŠ¤ëƒ…ìƒ· ë¹„êµ, ë”í‹° ì²´í‚¹)
    > - Update SQLì„ ìƒì„±, ì¿¼ë¦¬ ì „ì†¡.
    > 
    > ![img_3.png](img/img_3.png)
    > 

# ğŸ“Œ flush
****
- ë³€ê²½ ê°ì§€(Dirty Checking)
- ìˆ˜ì •ëœ ì—”í‹°í‹° ì“°ê¸° ì§€ì—° SQL ì €ì¥ì†Œì— ë“±ë¡
- ì“°ê¸°ì§€ì—° SQL ì €ì¥ì†Œì˜ ì¿¼ë¦¬ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ì „ì†¡(ë“±ë¡, ìˆ˜ì •, ì‚­ì œ)
- ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ë¹„ìš°ì§€ëŠ” ì•ŠëŠ”ë‹¤. ë™ê¸°í™”ë§Œ. (ì“°ê¸° ì§€ì—° ì €ì¥ì†ŒëŠ” ì „ì†¡ í›„ ë¹„ìš´ë‹¤)

> 1. ì§ì ‘ í˜¸ì¶œ : ```em.flush()```
> 2. íŠ¸ëœì­ì…˜ ì»¤ë°‹ : flush ìë™ í˜¸ì¶œ.
> 3. JPQL ì¿¼ë¦¬ ì‹¤í–‰ : flush ìë™ í˜¸ì¶œ.
> > - FlushModeType.AUTO (defualt)
> > - FlushModeType.COMMIT (commit í• ë•Œë§Œ ì‹¤í–‰)

#### ğŸ’¡ JPQL ì‹¤í–‰ì‹œ flushëŠ” ë°˜ë“œì‹œ ì¼ì–´ë‚ ê¹Œ?
JPQL ì‹¤í–‰ì‹œ flushê°€ ìë™ìœ¼ë¡œ í˜¸ì¶œë˜ì–´ ì“°ê¸° ì§€ì—°ë˜ë˜ ì¿¼ë¦¬ê°€ DBì— ì „ë‹¬ëœë‹¤ê³  í•œë‹¤. í•˜ì§€ë§Œ í•­ìƒ ê·¸ëŸ°ê²ƒì¼ê¹Œ?
ê²°ë¡ ë¶€í„° ë§í•˜ìë©´ í•­ìƒ ê·¸ëŸ°ê²ƒì€ ì•„ë‹ˆë‹¤.

ì˜ˆë¥¼ë“¤ì–´ ```em.persist(member)``` ë¥¼ ì´ìš©í•˜ì—¬ member ì—”í‹°í‹°ë¥¼ ì €ì¥í•˜ì˜€ë‹¤.
ê·¸ë‹¤ìŒì— ```em.createQuery("select t from Team t");``` ë¥¼ ì‹¤í–‰í•œë‹¤ë©´ ì–´ë–»ê²Œ ë ê¹Œ? ì´ë•ŒëŠ” flushëŠ” ì¼ì–´ë‚˜ì§€ ì•ŠëŠ”ë‹¤.
```em.createQuery("select m from Member m");``` ë¥¼ ì‹¤í–‰í•´ì•¼ flushê°€ ë°œìƒí•˜ëŠ” ê²ƒì„ í™•ì¸ í•  ìˆ˜ ìˆë‹¤.

JPQLì„ ì‹¤í–‰í•  ë•Œ ìë™ìœ¼ë¡œ flushê°€ ë˜ëŠ”ê²ƒì€ ë§ì§€ë§Œ ì •í™•íˆëŠ” **ëŒ€ê¸° ì¤‘ì¸ ì—”í‹°í‹° ì‘ì—…ê³¼ ê²¹ì¹˜ëŠ”** JPQL ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•  ë•Œ flushê°€ ë°œìƒí•œë‹¤.


#### ğŸ’¡ remove í•œ ì—”í‹°í‹°ë¥¼ 1ì°¨ ìºì‹œì—ì„œ ì¡°íšŒí•œë‹¤ë©´?
ë‹¤ìŒê³¼ ê°™ì€ ìƒí™©ì„ ê°€ì •í•´ë³´ì.
```java
em.remove(member);
em.find(Member.class, member.getId());
```
remove() ê°€ ì‹¤í–‰ë˜ì—ˆì§€ë§Œ ì•„ì§ ì»¤ë°‹ì´ ë˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì—, DBì—ëŠ” ë°˜ì˜ì´ ë˜ì§€ ì•Šì•˜ê³  ì“°ê¸° ì§€ì—° ì €ì¥ì†Œì—ë§Œ delete ì¿¼ë¦¬ë¥¼ ì €ì¥í•œë‹¤.
í•˜ì§€ë§Œ, find()ë¥¼ ì‹¤í–‰í•˜ë©´ ì—”í‹°í‹°ê°€ ì•„ë‹Œ nullì„ ë°˜í™˜í•œë‹¤.

find()ê°€ ì‹¤í–‰ë˜ì—ˆì„ ë•Œ, 1ì°¨ ìºì‹œì—ì„œ ì—”í‹°í‹°ë¥¼ ì°¾ì„ ìˆ˜ëŠ” ìˆì§€ë§Œ, í•´ë‹¹ ì—”í‹°í‹°ëŠ” remove ìƒíƒœë¡œ ì˜ˆì•½ì´ ë˜ì–´ ìˆëŠ” ìƒíƒœê³ ,
ì´ë¥¼ ì¡°íšŒí•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— nullì„ ë°˜í™˜í•˜ê³ , ì¿¼ë¦¬ ë˜í•œ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤.

#### ğŸ’¡ Update í›„ Delete í•œë‹¤ë©´ ì¿¼ë¦¬ê°€ ì–´ë–»ê²Œ ë°œìƒí• ê¹Œ?
ì‹¤ì œë¡œ ì—”í‹°í‹°ë¥¼ ë³€ê²½í•œ í›„ ì œê±°í•˜ë©´ ì»¤ë°‹ ë˜ì—ˆì„ ë•Œ ë”í‹°ì²´í‚¹ì— ì˜í•´ Update ì¿¼ë¦¬ê°€ ìƒì„±ë˜ê³ , Delete ì¿¼ë¦¬ê°€ ìƒì„±ë  ê²ƒ ê°™ì§€ë§Œ
ì‹¤ì œë¡œëŠ” ë‘ê°€ì§€ê°€ í•¨ê»˜ ë°œìƒí•˜ì—¬ flush ë˜ëŠ” ê²½ìš°ëŠ” ì—†ë‹¤. ì¦‰, íŠ¸ëœì­ì…˜ì´ ì»¤ë°‹ë  ì‹œì ì´ ìƒíƒœ í•œë²ˆë§Œ ì¿¼ë¦¬ê°€ ë°œìƒë˜ë¯€ë¡œ delete ì¿¼ë¦¬ë§Œ ë°œìƒí•œë‹¤.




# ğŸ“Œ ì—”í‹°í‹° ë§¤í•‘
*** 
### â˜ï¸ ê°ì²´ì™€ í…Œì´ë¸” ë§¤í•‘: @Entity, @Table
- #### @Entity : JPAê°€ ê´€ë¦¬í•˜ëŠ” ì—”í‹°í‹°. í•„ìˆ˜
  - ê¸°ë³¸ ìƒì„±ì í•„ìˆ˜ (public or protected) : ë¦¬í”Œë™ì…˜ê³¼ ê°™ì€ ê¸°ìˆ ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´.
  - final, enum, interface, inner í´ë˜ìŠ¤ëŠ” ì—”í‹°í‹°ë¡œ ì‚¬ìš© ë¶ˆê°€.
  - ì €ì¥í•  í•„ë“œì— finalì„ ì‚¬ìš©í•˜ë©´ ì•ˆëœë‹¤.

- #### @Table
  - name: ë§¤í•‘í•  í…Œì´ë¸” ì´ë¦„ (defaultë¡œëŠ” ì—”í‹°í‹° ì´ë¦„ì„ ì‚¬ìš©) 
  
### â˜ï¸ í•„ë“œì™€ ì»¬ëŸ¼ ë§¤í•‘
 
  - #### @Column : ì»¬ëŸ¼ ë§¤í•‘
    > - name : í•„ë“œì™€ ë§¤í•‘í•  í…Œì´ë¸”ì˜ ì»¬ëŸ¼ ì´ë¦„ (default = ê°ì²´ì˜ í•„ë“œ ì´ë¦„)
    > - Insertable, updatable : ë“±ë¡, ë³€ê²½ ê°€ëŠ¥ ì—¬ë¶€. (default = true)
    > - nullable(DDL) : null ì œì•½ì¡°ê±´
    > - unique(DDL) : unique ì œì•½ì¡°ê±´, í•˜ì§€ë§Œ ì£¼ë¡œ @Tableì˜ uniqueConstraintsë¥¼ ì‚¬ìš©í•œë‹¤.(ì´ë¦„ì„ ì„¤ì •í•˜ê¸° ìœ„í•´)
    > - columnDefinition: ì»¬ëŸ¼ ì •ë³´ë¥¼ ì§ì ‘ ì¤„ ìˆ˜ ìˆë‹¤ ```columnDefinition = "varchar(100) default 'EMPTY'"```
    > - length : ë¬¸ì ê¸¸ì´ ì œì•½ì¡°ê±´, Stringì—ë§Œ ì‚¬ìš© (default = 255)
    > - precision, scale(DDL): BigDecimal, BigIntegerì—ì„œ ì‚¬ìš©, precisionì€ ì†Œìˆ˜ì ì„ í¬í•¨í•œ ìë¦¿ìˆ˜, scaleì€ ì†Œìˆ˜ì ì˜ ìë¦¬ìˆ˜ë¥¼ ëª…ì‹œí•œë‹¤. ```scale = 19```
    
  - #### @Temporal : ë‚ ì§œ íƒ€ì… ë§¤í•‘
    - java8 ì´í›„ë¶€í„°ëŠ” LocalDate, LocalDateTimeì„ ì‚¬ìš©í•˜ë©´ ìƒëµ ê°€ëŠ¥.
    ```
      @Temporal(TemporalType.TIMESTAMP) | DATE,TIME
      private Date createdDate
    ```
  - #### @Enumerated : enum íƒ€ì… ë§¤í•‘ ```@Enumerated(EnumType.STRING)```-> varchar(ì´ë¦„)
    - defalut = ORDINARY(íƒ€ì…ì˜ ìˆœì„œ) -> Integerë¡œ ë“¤ì–´ê°, ì•ì— ìƒˆë¡œìš´ Roleì„ ì¶”ê°€í•˜ê²Œë˜ë©´ ìˆœì„œê°€ ë°”ë€ŒëŠ” ìœ„í—˜ì„±ì´ ìˆë‹¤.
  - #### @Lob : ëŒ€ìš©ëŸ‰ ì»¨í…ì¸  
    - ë§¤í•‘í•˜ëŠ” ë°ì´í„°ê°€ ë¬¸ìë©´ CLOB, ë‚˜ë¨¸ì§€ëŠ” BLOB
  - #### @Transient : í•„ë“œë¥¼ DBì— ë§¤í•‘í•˜ì§€ ì•Šê² ë‹¤.

### â˜ï¸ ê¸°ë³¸í‚¤ ë§¤í•‘
  - @Id
  - @GeneratedValue : Id ìë™ ìƒì„± 
    - ```strategy = GenerationType.Identity``` : ê¸°ë³¸ í‚¤ ìƒì„±ì„ DBì— ìœ„ì„(MySQLì˜ ê¸°)
    - ```strategy = GenerationType.SEQUENCE``` : Sequence Objectë¥¼ ë”°ë¡œ ë‘ê³  ê¸°ë³¸í‚¤ ìƒì„±ì„ ê´€ë¦¬.
      - í…Œì´ë¸” ë§ˆë‹¤ ë”°ë¡œ Sequence Object ë‘˜ ìˆ˜ë„ ìˆë‹¤.
        ```java
            @SequenceGenerator(
                name = "MEMBER_SEQ_GENERATOR",
                initialValue = 1, allocationSize = 1 /*(ì¦ê°€ í•˜ëŠ” ìˆ˜)*/)
      
            ...
            
            @GeneratedValue(strategy = Generationtype.SEQUENCE, generator = "MEMBER_SEQ_GENERATOR")
        ```
    - ```strategy = GenerationType.TABLE ``` : Sequence ì „ëµì„ í‰ë‚´ë‚¸ ê²ƒ, í‚¤ ìƒì„±ìš© í…Œì´ë¸”ì„ ë”°ë¡œ ë‘”ë‹¤.
        - ëª¨ë“  DBì— ì ìš©ì´ ê°€ëŠ¥í•˜ë‹¤ëŠ” ì¥ì ì´ ìˆìœ¼ë‚˜, ì„±ëŠ¥ ì´ìŠˆê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.
        ```java
            @TableGenerator(
                name = "MEMBER_SEQ_GENERATOR",
                table = "MY_SEQUENCES",
                pkColumnValue = "MEMBER_SEQ", allocationSize = 1)
      
            ...
            
            @GeneratedValue(strategy = Generationtype.TABLE, generator = "MEMBER_SEQ_GENERATOR")
        ```
        - MY_SEQUENCES í…Œì´ë¸”ì´ ìƒì„±ë˜ê³  pk value = MEMBER_SEQ, next_val ì€ 1ì„ ê°€ì§€ëŠ” íˆ¬í”Œì´ ìƒì„±ëœë‹¤. next_val ê°’ì„ ê³„ì† ì¦ê°€ ì‹œí‚¨ë‹¤.
    
- #### ğŸ”‘ ê¶Œì¥í•˜ëŠ” ê¸°ë³¸ í‚¤ ì œì•½ ì¡°ê±´
    - ê¸°ë³¸í‚¤ ì œì•½ ì¡°ê±´: null ì•„ë‹˜. ìœ ì¼, ë³€í•˜ë©´ ì•ˆë¨.
    - ìœ„ì˜ ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ìì—°í‚¤ëŠ” ì°¾ê¸° ì–´ë µë‹¤. ëŒ€ì²´í‚¤ë¥¼ ì‚¬ìš©(Sequence, UUID ë“±)
    - ê¶Œì¥ : Long, ëŒ€ì²´í‚¤ + í‚¤ ìƒì„± ì „ëµ ì‚¬ìš©.
    

- #### ğŸ¤” Identity ì „ëµì˜ íŠ¹ì´ì 
     - ì˜ì†ì„± ê´€ë¦¬ë¥¼ í•˜ê¸°ìœ„í•´ì„œëŠ” pk ì •ë³´ê°€ í•„ìš”í•˜ë‹¤. í•˜ì§€ë§Œ Identity ì „ëµì—ì„œëŠ” DBì— ì €ì¥í• ë•Œ idë¥¼ ìƒì„±í•˜ê¸° ë•Œë¬¸ì—, persistì‹œì ì— idê°’ì´ ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤.
       ë•Œë¬¸ì— ì›ë˜ëŠ” commit ì‹œì ì— ì¿¼ë¦¬ë¥¼ ì „ë‹¬í•˜ì§€ë§Œ Identity ì „ëµì—ì„œëŠ” íŠ¹ì´í•˜ê²Œ persist ì‹œì ì— ì¿¼ë¦¬ë¥¼ ì „ë‹¬í•œë‹¤.
   
- #### ğŸ¤” Sequence ì „ëµì˜ íŠ¹ì´ì .
    - persistë¥¼ ì‹¤í–‰í•˜ë©´ pkë¥¼ ê°€ì ¸ì˜¤ê¸° ìœ„í•´ DBì˜ Sequence Objectì—ì„œ ê°’ì„ ì–»ì–´ì˜¨ í›„ ì—”í‹°í‹°ì— ë„£ì–´ì£¼ê³  ì˜ì†ì„± ì»¨í…ŒìŠ¤íŠ¸ì— ì €ì¥í•œë‹¤.
    - allocationSizeë¥¼ ì´ìš©í•œ ì„±ëŠ¥ ìµœì í™”:  defaultê°’ì´ 50ìœ¼ë¡œ ì„¤ì •ë˜ì–´ ìˆë‹¤. í•œë²ˆ ê°’ì„ ì–»ì–´ì˜¬ ë•Œ DBì—ì„œëŠ” 50ì´ ì¦ê°€í•˜ê²Œ ë˜ì–´ìˆìœ¼ë¯€ë¡œ.
    ê·¸ ë‹¤ìŒë¶€í„°ëŠ” id ê°’ì´ 51ì´ ë ë•Œê¹Œì§€ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œëŠ” ë‹¤ì‹œ ê°’ì„ ì–»ì–´ì˜¤ì§€ ì•Šê³  ë©”ëª¨ë¦¬ì—ì„œ í˜¸ì¶œí•˜ì—¬ ì‚¬ìš©í•œë‹¤. ì¶©ë¶„í•œ ê°’ì„ ì‚¬ìš©í•´ë„ ë˜ì§€ë§Œ ì›¹ ì„œë²„ë¥¼ ë‚´ë¦¬ëŠ” ì‹œì ì— ì‚¬ë¼ì§€ê¸° ë•Œë¬¸ì— ì ì ˆí•œ ê°’ì„ ì‚¬ìš©í•œë‹¤.
      

     ğŸ– Spring Boot ì—ì„œëŠ” ë„¤ì´ë°ì˜ ê´€ë¡€ë¥¼ ì†Œë¬¸ì ì–¸ë”ìŠ¤ì½”ì–´ë¥¼ ì‚¬ìš©í•œë‹¤. createdDate -> create_date 

### ğŸ‘ í…Œì´ë¸”ì˜ ì™¸ë˜í‚¤ë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ì‹
```java
public class Order {

    @Id @GeneratedValue
    @Column(name = "order_id")
    private Long id;

    private Long memberId;

    private LocalDateTime orderDate;

    @Enumerated(EnumType.STRING)
    private OrderStatus status;
}
```
> - ìœ„ì˜ ì˜ˆì œì²˜ëŸ¼ ì£¼ë¬¸ìì˜ memberIdë¥¼ ì™¸ë˜í‚¤ë¡œ ì €ì¥í•˜ê²Œ ë˜ë©´ ì£¼ë¬¸í•œ ì‚¬ëŒì„ ì°¾ëŠ” ê³¼ì •ì—ì„œ ê°ì²´ ê·¸ë˜í”„ íƒìƒ‰ì´ ë¶ˆê°€ëŠ¥í•´ ê°ì²´ì§€í–¥ìŠ¤ëŸ½ì§€ ì•Šë‹¤.
```java
Order order = em.find(Order.class, orderId);
Long memberId = order.getMemberId();
Member member = em.find(Member.class, memberId);
```
> - í•´ê²° : ì—°ê´€ê´€ê³„ ë§¤í•‘ì„ ì´ìš©. fieldì— Memberë¥¼ ë‘ê³  order.getMember() ì²˜ëŸ¼ ì£¼ë¬¸ìë¥¼ ì°¾ì„ ìˆ˜ ìˆë‹¤.


# ğŸ“Œ ì—°ê´€ê´€ê³„ ë§¤í•‘
***
- ë°©í–¥ : ë‹¨ë°©í–¥, ì–‘ë°©í–¥
- ë‹¤ì¤‘ì„± : ë‹¤ëŒ€ì¼, ì¼ëŒ€ë‹¤, ì¼ëŒ€ì¼, ë‹¤ëŒ€ë‹¤
- ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ : ê°ì²´ ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ëŠ” ê´€ë¦¬ ì£¼ì¸ì´ í•„ìš”í•˜ë‹¤.

### â˜ï¸ ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„
```java
public class Member {

    @Id @GeneratedValue
    @Column(name = "member_id")
    private Long id;

    private String name;

    @ManyToOne
    @JoinColumn(name = "team_id")
    private Team team;
```

```java
Member member = em.find(Member.class, 1L);
Team team = member.getTeam();
```


### â˜ï¸ ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„
```java
public class Team {

    @Id
    @GeneratedValue
    @Column(name = "team_id")
    private Long id;

    private String teamName;

    @OneToMany(mappedBy = "team")
    private List<Member> members = new ArrayList<>();
}
```
- Memberì˜ @ManyToOne ì— ëŒ€ì‘ë˜ëŠ” @OneToMany ì‚¬ìš©.
- mappedByë¥¼ ì‚¬ìš©í•˜ì—¬ ì–´ë–¤ê²ƒê³¼ ë§¤í•‘ëœ ê²ƒì¸ì§€ ì•Œë ¤ì¤Œ.
- ê·¸ëŸ¬ë‚˜ ê°ì²´ëŠ” ê°€ê¸‰ì ì´ë©´ ë‹¨ë°©í–¥ì¸ ê²ƒì´ ì¢‹ë‹¤.
- ì–‘ë°©í–¥ ë§¤í•‘ì€ ë°˜ëŒ€ ë°©í–¥ìœ¼ë¡œ ì¡°íšŒê°€ ì¶”ê°€ëœ ê²ƒ ë¿.
- ë‹¨ë°©í–¥ ë§¤í•‘ì„ ì˜ í•˜ê³  ì–‘ë°©í–¥ì€ í•„ìš”í•  ë•Œ ì¶”ê°€.(ì—­ë°©í–¥ìœ¼ë¡œ íƒìƒ‰í•  ì¼ì´ ë§ì„ ë•Œ, í…Œì´ë¸”ì— ì˜í–¥ì´ ê°€ì§€ ì•ŠëŠ”ë‹¤.)

### ğŸ¤” ê°ì²´ì™€ í…Œì´ë¸”ì´ ê´€ê³„ë¥¼ ë§ºëŠ” ì°¨ì´
> - ê°ì²´ : ì‚¬ì‹¤ìƒ íŒ€ -> ë©¤ë²„, ë©¤ë²„ -> íŒ€ ì˜ ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„ê°€ 2ê°œ ìˆëŠ”ê²ƒ.
> - í…Œì´ë¸” : ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ í•˜ë‚˜!

> ğŸ– ê°ì²´ ê´€ê³„ì—ì„œ ë©¤ë²„ì˜ íŒ€ì„ ë°”ê¾¸ë ¤ë©´ ë©¤ë²„ì˜ íŒ€ì„ ë°”ê¿”ì•¼ í•  ì§€, íŒ€ì˜ ë©¤ë²„ë¥¼ ë°”ê¿”ì•¼í•  ì§€ ì•Œ ìˆ˜ ì—†ë‹¤. ë•Œë¬¸ì— ë‘˜ì¤‘ í•˜ë‚˜ì—ì„œ ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬í•´ì•¼ í•œë‹¤.    
> -> ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸

### ğŸ”‘ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸
- ì–‘ë°©í–¥ ë§¤í•‘ ê·œì¹™
    - ê°ì²´ì˜ ë‘ ê´€ê³„ì¤‘ í•˜ë‚˜ë¥¼ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ìœ¼ë¡œ ì§€ì •.
    - ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì´ ì™¸ë˜í‚¤ë¥¼ ê°€ì§„ë‹¤.
    - <strong>ì£¼ì¸ì´ ì•„ë‹Œìª½ì€ ë°ì´í„°ì˜ ë³€ê²½ ë¶ˆê°€, ì½ê¸°ë§Œ ê°€ëŠ¥.</strong>
      - ì˜ˆë¥¼ ë“¤ì–´ ë©¤ë²„ê°€ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì¼ë•Œ ```team.getMembers().add(member);```ì„ ì‹¤í–‰í•˜ë©´ ì¿¼ë¦¬ëŠ” ë‚˜ê°€ì§€ë§Œ <mark>ì‹¤ì œ DBë¥¼ í™•ì¸í•´ë³´ë©´ ë§´ë²„ì˜ ì™¸ë˜í‚¤ ê°’ì´ nullë¡œ ì„¤ì •ëœë‹¤.</mark>
      - ```member.setTeam(team)```ìœ¼ë¡œ ì‚¬ìš©í•´ì•¼ í•œë‹¤.
    - ì£¼ì¸ì€ mappedBy ì†ì„±ì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.
    - ì£¼ì¸ì´ ì•„ë‹ˆë©´ mappedBy ì†ì„±ìœ¼ë¡œ ì£¼ì¸ì„ ì§€ì •í•´ì¤€ë‹¤.
    
    ```
    - ì£¼ë¡œ í…Œì´ë¸” ì„¤ê³„ì—ì„œ ì™¸ë˜ í‚¤ê°€ ìˆëŠ” ê³³ì„ ì£¼ì¸ìœ¼ë¡œ ì •í•œë‹¤.(Nì„ ë‹´ë‹¹í•˜ëŠ” ì—”í‹°í‹°)
  
    - ì˜ˆë¥¼ ë“¤ì–´ íŒ€ê³¼ ë©¤ë²„ì˜ ê´€ê³„ì—ì„œëŠ” ë©¤ë²„ê°€ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì´ ëœë‹¤.
    ë§Œì•½ íŒ€ì„ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ìœ¼ë¡œ ì„¤ì •í•˜ê²Œ ë˜ë©´ íŒ€ì— ë©¤ë²„ë¥¼ ì¶”ê°€í•˜ì˜€ëŠ”ë°,ë©¤ë²„ì˜ ì—…ë°ì´íŠ¸ ì¿¼ë¦¬ê°€ ë°œìƒí•˜ë¯€ë¡œ ë§ì§€ì•Šë‹¤.
    ì„±ëŠ¥ ì´ìŠˆ ë˜í•œ ë°œìƒ. 
    ```
      
    > ğŸ– ë°ì´í„°ë¥¼ ì €ì¥í•  ë–„ì—ëŠ” ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ ë¿ë§Œ ì•„ë‹ˆë¼ ì—­ë°©í–¥ì—ë„ ì„¸íŒ…ì„ í•´ì£¼ëŠ” ê²ƒì´ ì¢‹ë‹¤.
    > ```java
    >   member.setTeam(team);
    >   team.getMembers().add(member);
    > ```
    > - í•œ íŠ¸ëœì­ì…˜ ì•ˆì—ì„œ ì¡°íšŒë¥¼ í•˜ê³ ì í•  ë•Œ flush(), clear()ë¥¼ í•´ì£¼ê³  ë‹¤ì‹œ ì¡°íšŒë¥¼ í•œë‹¤ë©´ ìƒê´€ì—†ì§€ë§Œ, ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ 1ì°¨ ìºì‹œì— ìˆë˜ ë°ì´í„°ë¥¼ ê·¸ëŒ€ë¡œ ë¶ˆëŸ¬ì˜¤ê¸° ë•Œë¬¸ì— <mark>ì¶”ê°€í•œ ë°ì´í„°ë¥¼ team.getMembers()ë¡œ ì¡°íšŒí•  ìˆ˜ ì—†ê²Œ ëœë‹¤.</mark>(1ì°¨ ìºì‹œì— ì €ì¥ëœ ë°ì´í„°ì—ì„œ ë¶ˆëŸ¬ì˜¤ê²Œ ë¨)
    > - ê°ì²´ ì§€í–¥ì ìœ¼ë¡œë„ ì´ìƒì .
    > - í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì‘ì„±í•  ë•Œ ë” ìœ ì—°í•¨.
    > - ì—°ê´€ê´€ê³„ í¸ì˜ ë©”ì„œë“œë¥¼ ì‘ì„± (ìœ„ì˜ ë‘ ê³¼ì •ì„ í•˜ë‚˜ì˜ ë©¤ë²„ ë©”ì„œë“œë¡œ)
    
    > ğŸ– ì–‘ë°©í–¥ ë§¤í•‘ì‹œ ë¬´í•œ ë£¨í”„ë¥¼ ì¡°ì‹¬í•˜ì.
    > - ê¸°ë³¸ toString() ì‚¬ìš©ì‹œ ì„œë¡œë¥¼ í˜¸ì¶œí•˜ê¸° ë•Œë¬¸ì— ë¬´í•œë£¨í”„ê°€ ë°œìƒí•œë‹¤. (teamì—ì„œëŠ” memberë¥¼ meberì—ì„œëŠ” teamì„)
    > - JSON ìƒì„± ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œë„ ë§ˆì°¬ê°€ì§€ì˜ ìƒí™©ì´ ë°œìƒí•  ìˆ˜ ìˆë‹¤.    
     => í•´ê²° : ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œëŠ” ì—”í‹°í‹°ë¥¼ ë°˜í™˜í•˜ì§€ ë§ì•„ì•¼ í•œë‹¤. DTOë¡œ ë°˜í™˜í•´ì•¼ í•œë‹¤.

# ğŸ“Œ ë‹¤ì–‘í•œ ì—°ê´€ê´€ê³„ ë§¤í•‘
****
> âœï¸ ê³ ë ¤ ì‚¬í•­
> - ë‹¤ì¤‘ì„± : ë‹¤ëŒ€ì¼ ì¼ëŒ€ë‹¤, ì¼ëŒ€ì¼, ë‹¤ëŒ€ë‹¤(ì‚¬ìš© ì§€ì–‘)
> - ë‹¨ë°©í–¥ ,ì–‘ë°©í–¥
> > - í…Œì´ë¸” : ì™¸ë˜ í‚¤ í•˜ë‚˜ë¡œ ì–‘ìª½ ì¡°ì¸ì´ ê°€ëŠ¥, ë°©í–¥ì´ë¼ëŠ” ê°œë…ì´ ì—†ë‹¤.
> > - ê°ì²´ : ì°¸ì¡°ìš© í•„ë“œê°€ ìˆëŠ” ìª½ìœ¼ë¡œë§Œ ì°¸ì¡° ê°€ëŠ¥. ì–‘ë°©í–¥ì€ ì‚¬ì‹¤ìƒ ë‘ ê°œì˜ ë‹¨ë°©í–¥ -> ì™¸ë˜í‚¤ë¥¼ ê´€ë¦¬í•  ê³³ì„ ì •í•´ì£¼ì–´ì•¼ í•œë‹¤ -> ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸.


## â˜ï¸ ë‹¤ëŒ€ì¼ (N:1)
> ![img_4.png](img/img_4.png)
- Nì— í•´ë‹¹í•˜ëŠ” ê³³ì´ ì™¸ë˜í‚¤ë¥¼ ê´€ë¦¬.
  ```java
  @ManyToOne
  @JoinColumn(name="team_id")
  Team team;
  ```
- <mark>ì–‘ë°©í–¥</mark>ì€ ë°˜ëŒ€ìª½ì— @OneToManyë¥¼ ì¶”ê°€í•˜ì—¬ ì½ì„ ìˆ˜ ìˆëŠ” ì°¸ì¡°ë¥¼ ì¶”ê°€.
- ë°˜ë“œì‹œ mappedByë¥¼ ì¶”ê°€.
  ````java  
  @OneToMany(maapedBy="team")
  List<Member> merbers = new ArrayList<>();
  ````
- ì–‘ë°©í–¥ì„ ìœ„í•´ ì°¸ì¡°ë¥¼ ì¶”ê°€í•˜ë”ë¼ë„ í…Œì´ë¸”ì— ì˜í–¥ì„ ì£¼ì§€ ì•ŠëŠ”ë‹¤.

## â˜ï¸ ì¼ëŒ€ë‹¤ (1:N) ë‹¨ë°©í–¥
> ![img_5.png](img/img_5.png)
- ì˜ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.
- <mark>ê°ì²´ì™€ í…Œì´ë¸”ì´ ì™¸ë˜í‚¤ë¥¼ ì„œë¡œ ë‹¤ë¥¸ê³³ì—ì„œ ê°€ì§€ê³  ìˆê²Œ ëœë‹¤.<mark>(í…Œì´ë¸”ì€ í•­ìƒ Nìª½ì— ì™¸ë˜í‚¤ê°€ ìˆìŒ.)
- Teamì˜ List<Member>ë¥¼ ë³€ê²½ì‹œí‚¤ë©´ Member í…Œì´ë¸”ì— TEAM_IDê°€ ë°”ë€Œë„ë¡ ì¿¼ë¦¬ê°€ ë°œìƒí•œë‹¤.(ë©¤ë²„ í…Œì´ë¸”ì˜ ì—…ë°ì´íŠ¸ ì¿¼ë¦¬ê°€ ë°œìƒ)
    ```java
    @OneToMany
    @JoinColumn(name = "team_id")
    private List<Member> members = new ArrayList<>();
    ```
  - ë©¤ë²„ í…Œì´ë¸”ì˜ team_idì™€ ì¡°ì¸.(JoinColumnì„ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë©´ JoinTableë°©ì‹ì„ ì‚¬ìš©í•˜ê²Œ ëœë‹¤. -> <mark>ì¤‘ê°„ í…Œì´ë¸”ì´ ìƒˆë¡œ ìƒì„±ë¨</mark>)
- íŒ€ ê°ì²´ë¥¼ ìˆ˜ì •í–ˆëŠ”ë° ë©¤ë²„ í…Œì´ë¸”ì— ì¿¼ë¦¬ê°€ ë‚˜ê°€ë¯€ë¡œ í—·ê°ˆë¦´ ìˆ˜ ìˆë‹¤. -> ì°¨ë¼ë¦¬ ë‹¤ëŒ€ì¼ ì–‘ë°©í–¥ì„ ì‚¬ìš©.

## â˜ï¸ ì¼ëŒ€ì¼ (1:1)
- ì£¼ í…Œì´ë¸”ê³¼ ëŒ€ìƒ í…Œì´ë¸” ì¤‘ì— ì™¸ë˜í‚¤ ì„ íƒ ê°€ëŠ¥.

> - ì£¼ í…Œì´ë¸”ì— ì™¸ë˜í‚¤
> 
> ![img_6.png](img/img_6.png)
```java
// Member
@OneToOne
@JoinColumn(name="locker_id")
private Locker locker;
```
- ì–‘ë°©í–¥ìœ¼ë¡œ ë§Œë“¤ê³  ì‹¶ìœ¼ë©´ ë°˜ëŒ€í¸ì— ì°¸ì¡°ë¥¼ ì¶”ê°€í•˜ê³  mappedByë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.
```java
//Locker                 
@OneToOne(mappedBy = "locker")
private Member member;
```
- ìì‹ ì˜ í…Œì´ë¸”ì— ìˆëŠ” ì™¸ë˜í‚¤ë¥¼ ê´€ë¦¬í•œë‹¤. ìƒëŒ€ í…Œì´ë¸”ì˜ ì™¸ë˜í‚¤ ê´€ë¦¬ ë¶ˆê°€ëŠ¥.
```
- ì£¼ í…Œì´ë¸”ì— ì™¸ë˜í‚¤ : ì£¼ ê°ì²´ê°€ ëŒ€ìƒ ê°ì²´ì˜ ì°¸ì¡°ë¥¼ ê°€ì§€ëŠ” í˜•íƒœ. ê°ì²´ ì§€í–¥ ê°œë°œìê°€ ì„ í˜¸, JPA ë§¤í•‘ í¸ë¦¬
  ì¥ì : ì£¼ í…Œì´ë¸”ë§Œ ì¡°íšŒí•´ë„ ëŒ€ìƒ í…Œì´ë¸” ë°ì´í„° ì—¬ë¶€ í™•ì¸ ê°€ëŠ¥, ë‹¤ëŒ€ì¼ë¡œ ë³€ê²½ í…Œì´ë¸” êµ¬ì¡° ìœ ì§€.
  ë‹¨ì : ê°’ì´ ì—†ë‹¤ë©´ nullì„ í—ˆìš©í•˜ê²Œ ë¨.
- ëŒ€ìƒ í…Œì´ë¸”ì— ì™¸ë˜ í‚¤ : ì „í†µì ì¸ DBAê°€ ì„ í˜¸
  ì¥ì : ì£¼ í…Œì´ë¸”ê³¼ ëŒ€ìƒ í…Œì´ë¸”ì„ ì¼ëŒ€ì¼ì—ì„œ ì¼ëŒ€ë‹¤ ê´€ê³„ë¡œ ë³€ê²½í•  ë•Œ í…Œì´ë¸” êµ¬ì¡° ìœ ì§€.
  ë‹¨ì : í”„ë¡ì‹œ ê¸°ëŠ¥ì˜ í•œê³„ë¡œ í•­ìƒ ì¦‰ì‹œ ë¡œë”©ìœ¼ë¡œ ì‚¬ìš© ë¨.(ì–´ì°¨í”¼ ëŒ€ìƒ í…Œì´ë¸”ì„ ì¿¼ë¦¬í•´ì•¼ ì•Œ ìˆ˜ ìˆìŒ.)
```

## â˜ï¸ ë‹¤ëŒ€ë‹¤ (N:M)
```java
// Member
@ManyToMany
@JoinTable(name="MEMBER_PRODUCT")
private List<Product> products = new ArrayList<>();
```

- ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ëŠ” ì •ê·œí™”ëœ í…Œì´ë¸” ë‘ ê°œë¡œ ë‹¤ëŒ€ë‹¤ ê´€ê³„ë¥¼ í‘œí˜„í•  ìˆ˜ ì—†ë‹¤.
- JPAì—ì„œ ë‹¤ëŒ€ë‹¤ ê´€ê³„ ë§¤í•‘ìœ¼ë¡œ ìë™ìœ¼ë¡œ ìƒì„±ëœ í…Œì´ë¸”ì— ì¶”ê°€ì ì¸ ì •ë³´ë¥¼ ë„£ëŠ”ê²ƒì´ ë¶ˆê°€ëŠ¥í•˜ë‹¤.
- ìƒê°ì§€ë„ ëª»í•œ ì¿¼ë¦¬ê°€ ë°œìƒí•˜ê¸°ë„ í•œë‹¤.
- ì‹¤ë¬´ì—ì„œ ì‚¬ìš© ì§€ì–‘. <mark>ì¼ëŒ€ë‹¤ + ë‹¤ëŒ€ì¼ + ì¼ëŒ€ë‹¤ ê´€ê³„ë¡œ í’€ì–´ë‚´ì•¼ í•œë‹¤.</mark>

> ![img_7.png](img/img_7.png)
> - ì¤‘ê°„ í…Œì´ë¸”ì„ ì—”í‹°í‹°ë¡œ ìŠ¹ê²©.
> - ì¼ëŒ€ë‹¤, ë‹¤ëŒ€ì¼, ì¼ëŒ€ë‹¤ë¡œ í’ˆì–´ë‚¸ë‹¤.

```java
// Member
@OneToMany(mappedBy = "member")
private List<MemberProduct> memberProducts = new ArrayList<>();
```
```java
// MemberProduct
@ManyToOne
@JoinColumn(name = "member_id")
Member member;

@ManyToOne
@JoinColumn(name = "product_id")
Product product;
```

```java
// Product
@OneToMany(mappedBy = "product")
private List<MemberProduct> memberProducts = new ArrayList<>();
```


### ğŸ¤” @JoinColumn ì£¼ìš” ì†ì„±
- name : ë§¤í•‘í•  ì™¸ë˜ í‚¤ ì´ë¦„ 
    ```java
    @JoinColumn(name = "member_id")
    Member member;
    ```
- referencedColumnName : ì™¸ë˜ í‚¤ê°€ ì°¸ì¡°í•˜ëŠ” ëŒ€ìƒ í…Œì´ë¸”ì˜ ì»¬ëŸ¼ëª….(ë‹¤ë¥¼ ê²½ìš° ì‚¬ìš©)
- foreignKey(DDL) : ì™¸ë˜ í‚¤ ì œì•½ ì¡°ê±´ì„ ì§ì ‘ ì§€ì •, í…Œì´ë¸”ì„ ìƒì„±í• ë•Œë§Œ ì‚¬ìš©ëœë‹¤.
- unique, nullable, insertale, updatable, columnDefinition, table ...

### ğŸ¤” @ManyToOne ì£¼ìš” ì†ì„±
- optional : falseë¡œ ì„¤ì •í•˜ë©´ ì—°ê´€ëœ ì—”í‹°í‹°ê°€ í•­ìƒ ìˆì–´ì•¼ í•œë‹¤ (default = true)
- fetch : ê¸€ë¡œë²Œ íŒ¨ì¹˜ ì „ëµì„ ì„¤ì •. (default = FetchType.EAGER)
- cascade : ì˜ì†ì„  ì „ì´ ê¸°ëŠ¥.

### ğŸ¤” @OneToMany
- mappedBy : ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ í•„ë“œë¥¼ ì„ íƒ.
- fetch : ê¸€ë¡œë²Œ íŒ¨ì¹˜ ì „ëµì„ ì„¤ì •. (default = FetchType.LAZY)
- cascade : ì˜ì†ì„  ì „ì´ ê¸°ëŠ¥. 

# ğŸ“Œ ìƒì†ê´€ê³„ ë§¤í•‘
****
- ê´€ê³„í˜• DBì—ëŠ” ìƒì†ê´€ê³„ê°€ ì—†ë‹¤.
- ê°€ì¥ ìœ ì‚¬í•œ ë°©ë²•ì´ ìŠˆí¼íƒ€ì… ì„œë¸Œíƒ€ì… ê´€ê³„.
- ìƒì†ê´€ê³„ ë§¤í•‘: ê°ì²´ì˜ ìƒì† êµ¬ì¡°ì™€ DBì˜ ìŠˆí¼íƒ€ì… ì„œë¸Œíƒ€ì… ê´€ê³„ë¥¼ ë§¤í•‘.     
     ![img_8.png](img/img_8.png)
  
### â˜ï¸ ì¡°ì¸ ì „ëµ (JOINED)
> ![img_9.png](img/img_9.png)
> - ë°ì´í„°ë¥¼ ë‚˜ëˆ„ê³  ë‘ë²ˆì˜ insert
> - ì¡°íšŒí•˜ê¸° ìœ„í•´ì„œëŠ” item_idë¡œ ì¡°ì¸í•´ì„œ ê°€ì ¸ì˜¨ë‹¤.    
> > ğŸ‘ ì¥ì : 
> > - í…Œì´ë¸” ì •ê·œí™”
> > - ì™¸ë˜í‚¤ ì°¸ì¡° ë¬´ê²°ì„± ì œì•½ì¡°ê±´ í™œìš© ê°€ëŠ¥
> > - ì €ì¥ê³µê°„ íš¨ìœ¨í™”. 
> 
> > ğŸ‘ ë‹¨ì 
> > - ì¡°íšŒí• ë•Œ ì¡°ì¸ì„ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ì„±ëŠ¥ ì €í•˜. ì¿¼ë¦¬ê°€ ë³µì¡í•˜ë‹¤.
> > - ë°ì´í„° ì €ì¥ì‹œ INSERT ë‘ë²ˆ í˜¸ì¶œ.

### â˜ï¸ ë‹¨ì¼ í…Œì´ë¸” ì „ëµ (SINGLE_TABLE)
> ![img_10.png](img/img_10.png)
> - í•œ í…Œì´ë¸”ì— ëª¨ë“  ë°ì´í„°ë¥¼ ì§‘ì–´ë†“ê³  Type Column(DTYPE)ì„ ë‘ì–´ êµ¬ë¶„.
> > ğŸ‘ ì¥ì :
> > - ì¡°ì¸ì´ í•„ìš” ì—†ìœ¼ë¯€ë¡œ ì¼ë°˜ì ìœ¼ë¡œ ì¡°íšŒ ì„±ëŠ¥ì´ ì¢‹ë‹¤. 
> > - ì¡°íšŒ ì¿¼ë¦¬ê°€ ë‹¨ìˆœ.
>
> > ğŸ‘ ë‹¨ì 
> > - ìì‹ ì—”í‹°í‹°ê°€ ë§¤í•‘í•œ ì»¬ëŸ¼ì€ ëª¨ë‘ nullì„ í—ˆìš©í•œë‹¤.(movieë¥¼ ì €ì¥í•œë‹¤ë©´ movieì˜ ì»¬ëŸ¼ì´ ì•„ë‹Œ ì»¬ëŸ¼ë“¤ì€ ëª¨ë‘ null)
> > - ë‹¨ì¼ í…Œì´ë¸”ì— ëª¨ë“  ê²ƒì„ ì €ì¥í•˜ë¯€ë¡œ í…Œì´ë¸”ì´ ì»¤ì§ˆ ìˆ˜ ìˆë‹¤. ìƒí™©ì— ë”°ë¼ ì¡°íšŒ ì„±ëŠ¥ì´ ì˜¤íˆë ¤ í•˜ë½.

### â˜ï¸ êµ¬í˜„ í´ë˜ìŠ¤ë§ˆë‹¤ í…Œì´ë¸” ë‘ê¸° ì „ëµ (TABLE_PER_CLASS)
> ![img_11.png](img/img_11.png)
> - âŒ ì¶”ì²œí•˜ì§€ ì•ŠëŠ” ì „ëµ.
> - ê° íƒ€ì…ë§ˆë‹¤ í…Œì´ë¸”ì„ í•˜ë‚˜ì”© ìƒì„±. ê°ê°ì˜ ë°ì´í„°ë¥¼ ê°€ì§.
> > ğŸ‘ ì¥ì :
> > - ì„œë¸Œ íƒ€ì…ì„ ëª…í™•í•˜ê²Œ êµ¬ë¶„í•˜ì—¬ ì²˜ë¦¬í•  ë•Œ íš¨ê³¼ì 
> > - not null ì œì•½ì¡°ê±´ ì‚¬ìš© ê°€ëŠ¥.
>
> > ğŸ‘ ë‹¨ì 
> > - ì—¬ëŸ¬ ìì‹ í…Œì´ë¸”ê³¼ í•¨ê»˜ ì¡°íšŒí•  ë•Œ ì„±ëŠ¥ì´ ëŠë¦¼(UNION SQL í•„ìš”, DTYPEì´ ì—†ì–´ ëª¨ë“  í…Œì´ë¸”ì„ ë‹¤ ì¡°íšŒí•´ì•¼ í•œë‹¤.)
> > - ìì‹ í…Œì´ë¸”ì„ í†µí•©í•˜ì—¬ ì¿¼ë¦¬í•˜ê¸° ì–´ë ¤ì›€.


## ğŸ§ ì£¼ìš” ì–´ë…¸í…Œì´ì…˜
```@Inheritance(strategy=InheritanceType.XXX)```
- JOINED : ì¡°ì¸ ì „ëµ.
- SINGLE_TABLE : ë‹¨ì¼ í…Œì´ë¸” ì „ëµ (JPA default)
- TABLE_PER_CLASS : êµ¬í˜„ í´ë˜ìŠ¤ë§ˆë‹¤ í…Œì´ë¸” ìƒì„±.

```@DiscriminatorColumn(name="DTYPE")```    
- ìƒìœ„ í´ë˜ìŠ¤ì— DTYPEì„ ë„£ì–´ì¤€ë‹¤ (ì˜ˆì‹œì—ì„œëŠ” itemì—)
- ì˜ˆ) join ì „ëµìœ¼ë¡œ movie ë°ì´í„°ë¥¼ ì¶”ê°€í•˜ì˜€ì„ ë•Œ, itemì˜ DTYPEì»¬ëŸ¼ì— MOVIEê°€ ë“¤ì–´ê°„ë‹¤(default = Entity Name)
- SINGLE_TABLE ì „ëµì—ì„œëŠ” ì• ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•˜ì§€ ì•Šì•„ë„ ìë™ìœ¼ë¡œ ë“¤ì–´ê°„ë‹¤.

```@DiscriminatorValue("XXX")```
- DTYPEì— ë“¤ì–´ê°ˆ ì´ë¦„ì„ ì—”í‹°í‹° ëª…ì´ ì•„ë‹Œ ì„ì˜ì˜ ì´ë¦„ì„ ë„£ì–´ì¤„ ìˆ˜ ìˆë‹¤.

```java
@Inheritance(strategy = InheritanceType.JOINED)
@DiscriminatorColumn(name = "DTYPE")
@Entity
public abstract class Item {
    ...
}
```
- ìƒìœ„ í´ë˜ìŠ¤ëŠ” ìƒì„±í•´ì„œ ì‚¬ìš©í•˜ì§€ ì•Šê¸° ë–„ë¬¸ì— ì¶”ìƒí´ë˜ìŠ¤ë¡œ ìƒì„±.
```java
@Entity
@DiscriminatorValue("B")
public class Book extends Item{

    private String author;
    private String isbn;
}
```

# ğŸ“Œ @MappedSuperclass
***
![img_12.png](img/img_12.png)
- ê³µí†µ ë§¤í•‘ ì •ë³´ë¥¼ ìƒì„±í•˜ì—¬ ì‚¬ìš©í•˜ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©. ì£¼ë¡œ ë“±ë¡ì¼, ìˆ˜ì •ì¼ ë“±ê³¼ê°™ì´ ì „ì²´ ì—”í‹°í‹°ì—ì„œ ê³µí†µìœ¼ë¡œ ì ìš©í•  ì†ì„±ì— ì‚¬ìš©.
- ì—”í‹°í‹°ê°€ ì•„ë‹ˆê¸°ë•Œë¬¸ì— í…Œì´ë¸”ì— ë§¤í•‘ë˜ì§€ ì•ŠëŠ”ë‹¤. ì¡°íšŒ ë˜í•œ ë¶ˆê°€.
- ìƒì†ê´€ê³„ ë§¤í•‘ì´ ì•„ë‹˜.
- ì§ì ‘ ìƒì„±í•´ì„œ ì‚¬ìš©í•  ì¼ì´ ì—†ìœ¼ë¯€ë¡œ ì¶”ìƒ í´ë˜ìŠ¤ë¡œ ìƒì„±.

```java
@MappedSuperclass
public class BaseEntity {

    @Column(name = "createdDate")
    private LocalDateTime createdDateTime;

    private LocalDateTime lastModifiedDateTime;
}
```
```java
public class Member extends BaseEntity{
    
            ...
    
}
```
![img_13.png](img/img_13.png)

# ğŸ“Œ í”„ë¡ì‹œ
****
![img_14.png](img/img_14.png)
- em.getReference() : ë°ì´í„° ë² ì´ìŠ¤ ì¡°íšŒë¥¼ ë¯¸ë£¨ëŠ” ê°€ì§œ(í”„ë¡ì‹œ)ì—”í‹°í‹° ê°ì²´ ì¡°íšŒ.
    - em.gerReference()ê°€ ì‹¤í–‰ë  ë•Œì—ëŠ” ì¿¼ë¦¬ê°€ ë‚˜ê°€ì§€ ì•Šë‹¤ê°€, í•´ë‹¹ ê°ì²´ì—ì„œ ê°’ì„ êº¼ë‚¼ ë•Œ ì¿¼ë¦¬ê°€ ë°œìƒí•œë‹¤.
    - getReference()ë¡œ ê°€ì ¸ì˜¨ ê°ì²´ì˜ í´ë˜ìŠ¤ë¥¼ í™•ì¸í•´ ë³´ë©´ Proxy ì„ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.         
      ```class com.shop.domain.Order$HibernateProxy$naIZTxPo```

![img_15.png](img/img_15.png)
- ì›ë³¸ì˜ ì°¸ì¡°ì¸ targetì„ ê°€ì§€ê³  ìˆë‹¤. ì‹¤ì œ ì—”í‹°í‹°ë¥¼ ìƒì†ë°›ì•„ ë§Œë“¤ì–´ì§„ë‹¤.
- ì´ˆê¸°í™”: ì²˜ìŒì—ëŠ” targetì´ null ì´ì§€ë§Œ í”„ë¡ì‹œì˜ ê°’ì„ í˜¸ì¶œí•  ë•Œ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œ ì‹¤ì œ ì—”í‹°í‹°ë¥¼ ê°€ì ¸ì™€ ì´ë¥¼ ì—°ê²°ì‹œí‚¨ë‹¤.
- í”„ë¡ì‹œì˜ ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ë©´ targetì˜ ë©”ì†Œë“œë¥¼ í˜¸ì¶œ í•´ ì¤€ë‹¤.
- ì‚¬ìš©í•˜ëŠ” ì…ì¥ì—ì„œëŠ” ì´ë¡ ìƒìœ¼ë¡œ ì›ë³¸ê³¼ êµ¬ë¶„í•˜ì§€ ì•Šê³  ì‚¬ìš©í•´ë„ ëœë‹¤.

### ğŸ”‘ í”„ë¡ì‹œì˜ íŠ¹ì§•
- í”„ë¡ì‹œ ê°ì²´ëŠ” ì²˜ìŒ ì‚¬ìš©í•  ë•Œ í•œ ë²ˆë§Œ ì´ˆê¸°í™”
- ì´ˆê¸°í™”ë¥¼ í•˜ë”ë¼ë„ í”„ë¡ì‹œ ê°ì²´ê°€ ì‹¤ì œ ì—”í‹°í‹°ë¡œ ë°”ë€ŒëŠ” ê²ƒì´ ì•„ë‹ˆë‹¤. í”„ë¡ì‹œ ê°ì²´ë¥¼ í†µí•´ ì‹¤ì œ ì—”í‹°í‹°ì— ì ‘ê·¼í•˜ëŠ” ê²ƒ.
- í”„ë¡ì‹œ ê°ì²´ëŠ” ì›ë³¸ ì—”í‹°í‹°ë¥¼ ìƒì†ë°›ìŒ, ë”°ë¼ì„œ íƒ€ì… ì²´í¬ì‹œ '=='ì´ ì•„ë‹Œ instance ofë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤.
- <mark>ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì°¾ëŠ” ì—”í‹°í‹°ê°€ ì´ë¯¸ ìˆë‹¤ë©´ getReference()ë¥¼ í•˜ë”ë¼ë„ ì‹¤ì œ ì—”í‹°í‹°ë¥¼ ë°˜í™˜.</mark>
    - JPAì—ì„œëŠ” í•œ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œ ê°™ì€ PKë¡œ ê°€ì ¸ì˜¨ ê°ì²´ëŠ” í•­ìƒ ==ë¹„êµì—ì„œ trueê°€ ë‚˜ì™€ì•¼í•œë‹¤.
      - ```ë•Œë¬¸ì— í•œ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œ getReference()ë¥¼ í†µí•´ proxy ê°ì²´ë¥¼ ì´ë¯¸ ê°€ì ¸ì™”ë‹¤ë©´, ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œ  getReference()ë¡œ ê°ì²´ë¥¼ ê°€ì ¸ì˜¤ê±°ë‚˜ find()ë¡œ ê°ì²´ë¥¼ ê°€ì ¸ì˜¤ë”ë¼ë„ proxyê°ì²´ê°€ ëœë‹¤.```
    - ì´ë¯¸ ê°€ì ¸ì˜¨ ê°ì²´ë¥¼ í”„ë¡ì‹œë¡œ ê°€ì ¸ì™€ì„œ ì–»ì„ ìˆ˜ ìˆëŠ” ì´ì ì´ ì—†ë‹¤.
- ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ ë„ì›€ì„ ë°›ì„ ìˆ˜ ì—†ëŠ” ì¤€ì˜ì† ìƒíƒœì¼ ë•Œ, í”„ë¡ì‹œë¥¼ ì´ˆê¸°í™”í•˜ë©´ ì˜ˆì™¸ ë°œìƒ.
    - detach(), close(), clear()    
    ```org.hibernate.LazyInitializationException: could not initialize proxy```
      

### ğŸ– í”„ë¡ì‹œ í™•ì¸
- í”„ë¡ì‹œ ì¸ìŠ¤í„´ìŠ¤ì˜ ì´ˆê¸°í™” ì—¬ë¶€ í™•ì¸(boolean) : ```emf.getPersistenceUnitUtil().isLoaded(Object entity)```
- í”„ë¡ì‹œ í´ë˜ìŠ¤ í™•ì¸ ë°©ë²• : ```entity.getClass().getName()```
- í”„ë¡ì‹œ ê°•ì œ ì´ˆê¸°í™”(Hibernate) : ```Hibernate.initialize(entity);```
        

# ğŸ“Œ ì¦‰ì‹œ ë¡œë”©ê³¼ ì§€ì—° ë¡œë”©
***
- ì§€ì—° ë¡œë”© : fetch = FetchType.LAZY
    - ex) @ManyToOne(fetch = FetchType.LAZY)
    - í”„ë¡ì‹œë¡œ ì¡°íšŒí•˜ê²Œ ëœë‹¤. ì‹¤ì œ ì‚¬ìš©(ë©”ì†Œë“œ í˜¸ì¶œ ë“±)í•˜ëŠ” ì‹œì ì— ì´ˆê¸°í™”.(ì¿¼ë¦¬ ë°œìƒ)

- ì¦‰ì‹œ ë¡œë”© : fetch = FetchType.EAGER
    - ì¡°íšŒí• ë•Œ ì• ì´ˆì— ëª¨ë‘ í•¨ê»˜ ì¡°íšŒ.
    - ì‹¤ì œ ì—”í‹°í‹°ê°€ ë¶ˆë ¤ì˜¨ë‹¤.
    - JPA êµ¬í˜„ì²´ëŠ” ê°€ëŠ¥í•˜ë©´ ì¡°ì¸ì„ ì‚¬ìš©í•˜ì—¬ SQL í•œë²ˆì— ëª¨ë‘ ì¡°íšŒ.
    

#### ğŸ– ì¦‰ì‹œë¡œë”© ì£¼ì˜ì 
- ê°€ê¸‰ì  ì§€ì—° ë¡œë”©ì„ ì‚¬ìš©(íŠ¹íˆ ì‹¤ë¬´)
- ì¦‰ì‹œ ë¡œë”©ì„ ì ìš©í•˜ë©´ ì˜ˆìƒí•˜ì§€ ëª»í•œ SQLì´ ë°œìƒ.
- JPQL ì‚¬ìš©ì‹œ ì¦‰ì‹œ ë¡œë”©ì€ N+1 ì¿¼ë¦¬ ë¬¸ì œë¥¼ ë°œìƒì‹œí‚¨ë‹¤.
    - ì „ì²´ ë©¤ë²„ë¥¼ ì¡°íšŒí•  ë•Œ ë©¤ë²„ í•œëª…ë‹¹ íŒ€ ì¡°íšŒì¿¼ë¦¬ê°€ ë°œìƒ
- <mark>@ManyToOne, @OneToOneì€ **ê¸°ë³¸ì´ ì¦‰ì‹œë¡œë”©**ì´ê¸° ë•Œë¬¸ì— LAZYë¡œ ë³€ê²½í•´ ì£¼ì–´ì•¼ í•œë‹¤.</mark>

#### ğŸ’¡ N + 1 ë¬¸ì œì˜ í•´ê²°       
    1. fetchJoin       
    2. Entity Graph   

# ğŸ“Œ ì˜ì†ì„± ì „ì´ (CASCADE)ì™€ ê³ ì•„ ê°ì²´
***
###  â˜ï¸CASCADE
- íŠ¹ì • ì—”í‹°í‹°ë¥¼ ì˜ì† ìƒíƒœë¡œ ë§Œë“¤ ë•Œ ì—°ê´€ ì—”í‹°í‹°ë„ í•¨ê»˜ ì˜ì† ìƒíƒœë¡œ ë§Œë“¤ê³  ì‹¶ì„ ë•Œ.
    ```java
    @OneToMany(mappedBy = "parent", cascade = CascadeType.PERSIST)
    private List<Child> childList = new ArrayList<>();
    ```
    ì˜ ìƒíƒœì—ì„œ.
    
    ```java
    perent.getChildList().add(child1);
    perent.getChildList().add(child2);
    
    em.persist(perent);
    ```
    ë¥¼ ì‹¤í–‰í•˜ë©´ perentì˜ ì°¸ì¡°ì— ìˆëŠ” child1, child2 ë˜í•œ persistê°€ ì‹¤í–‰ëœë‹¤.    

    - ì˜ì†ì„± ì „ì´ëŠ” ì—°ê´€ê´€ê³„ë¥¼ ë§¤í•‘í•˜ëŠ” ê²ƒê³¼ ì•„ë¬´ ê´€ë ¨ì´ ì—†ë‹¤. í¸ë¦¬í•¨ì„ ì œê³µ í•  ë¿.

    #### ğŸ– CASCADEì˜ ì¢…ë¥˜
    - ALL: ëª¨ë‘ ì ìš©, ë¼ì´í”„ ì‹¸ì´í´ì´ ìœ ì‚¬í•  ë•Œ.
    - PERSIST: ì˜ì†. ì €ì¥í• ë•Œë§Œ.
    - REMOVE, DETACH
    - MERGE, REFRESH: ì—”í‹°í‹°ê°€ ìˆ˜ì •ë˜ì—ˆì„ ë•Œ DBì™€ì˜ ë™ê¸°í™”(MERGEëŠ” ê°ì²´->DB, REFRESHëŠ” DB->ê°ì²´) 

    #### ğŸ– ì£¼ë¡œ í•œ ë¶€ëª¨ê°€ ì—¬ëŸ¬ ìì‹ì„ ê´€ë¦¬í•  ë•Œ ì‚¬ìš© (ê²Œì‹œíŒ, ì²¨ë¶€íŒŒì¼), ë‹¤ë¥¸ ì—”í‹°í‹°ì™€ ì—°ê´€ì´ ì—†ì–´ì•¼ í•œë‹¤. ì¦‰ ì†Œìœ ìê°€ í•˜ë‚˜ì¼ ë•Œ.

### â˜ï¸ ê³ ì•„ ê°ì²´
- ê³ ì•„ ê°ì²´ ì œê±° : ë¶€ëª¨ ì—”í‹°í‹°ì™€ ì—°ê´€ê´€ê³„ê°€ ëŠì–´ì§„ ìì‹ ì—”í‹°í‹°ë¥¼ ìë™ìœ¼ë¡œ ì‚­ì œ.
    ```java
    @OneToMany(mappedBy = "parent", orphanRemoval = true)
    ```
    - ex) ```perent.getChildren().remove(0)```

    #### ğŸ– ì°¸ì¡°í•˜ëŠ” ê³³ì´ í•˜ë‚˜ì¼ ë•Œ ì‚¬ìš©(í•˜ë‚˜ì˜ ì—”í‹°í‹°ê°€ ì†Œìœ í•  ë•Œ.)
    #### ğŸ– ë¶€ëª¨ë¥¼ ì œê±°í•˜ë©´ ëª¨ë‘ ê³ ì•„ê°€ ë˜ê¸° ë•Œë¬¸ì— CascadeType.REMOVE ì²˜ëŸ¼ ë™ì‘.

    #### ğŸ’¡ Cascade.REMOVE ì™€ orphanRemovalì€ ë­ê°€ ë‹¤ë¥¼ê¹Œ?
    ëª…ì‹œì ìœ¼ë¡œ remove ë˜ëŠ” ê²½ìš°ì—ëŠ” ë™ì¼í•˜ì§€ë§Œ parent.setChildren(null)ì˜ ê²½ìš°ì—ëŠ” ë™ì‘ì´ ë‹¬ë¼ì§„ë‹¤.
    Cascade.REMOVE ê°™ì€ ê²½ìš°ì—ëŠ” parent ì™€ì˜ ê´€ê³„ëŠ” ëŠì–´ì§€ì§€ë§Œ ë¶€ëª¨ê°€ ì‚­ì œëœ ê²ƒì´ ì•„ë‹ˆë¯€ë¡œ DB ì—ëŠ” ì—¬ì „íˆ Children ì—”í‹°í‹°ê°€ ì¡´ì¬í•œë‹¤.
    í•˜ì§€ë§Œ orphanRemoval ì€ ì°¸ì¡° ê´€ê³„ë¥¼ í™•ì¸í•˜ê¸° ë•Œë¬¸ì— ë¶€ëª¨ì™€ì˜ ê´€ê³„ê°€ ëŠì–´ì§€ë©´ ê³ ì•„ê°ì²´ë¡œ íŒë‹¨í•˜ê³  DBì—ì„œë„ Children ê°ì²´ë¥¼ ì œê±°í•œë‹¤.
  
  
### ğŸ”‘ CascadeType.ALL + orphanRemovar
    - ë‘ ì˜µì…˜ì„ ëª¨ë‘ í™œìƒí™”í•˜ë©´ ìì‹ì˜ ìƒëª…ì£¼ê¸°ë¥¼ ë¶€ëª¨ ì—”í‹°í‹°ê°€ ê´€ë¦¬.
    - ë„ë©”ì¸ ì£¼ë„ ì„¤ê³„(DDD)ì˜ *Aggregate Root ê°œë…ì„ êµ¬í˜„í•  ë•Œ ìœ ìš©í•˜ë‹¤.
        ğŸ¤” *Aggregate Root: Rootë§Œ Repositoryë¥¼ ìƒì„±í•˜ê³ , ë‚˜ë¨¸ì§€ëŠ” ë§Œë“¤ì§€ ì•ŠëŠ”ê²ƒì´ ë‚«ë‹¤.
            Rootë¥¼ í†µí•´ ìƒëª…ì£¼ê¸°ë¥¼ ê´€ë¦¬.


# ğŸ“Œ ê°’ íƒ€ì…
****

## ğŸ§ï¸ ì—”í‹°í‹° íƒ€ì…
- @Entityë¡œ ì •ì˜í•˜ëŠ” ê°ì²´. 
- ë°ì´í„°ê°€ ë³€í•´ë„ ì‹ë³„ìë¡œ ì§€ì†í•´ì„œ ì¶”ì  ê°€ëŠ¥. 

## ğŸ§ï¸ï¸ ê°’ íƒ€ì…
- int, Integer, String ì²˜ëŸ¼ ë‹¨ìˆœí•œ ê°’, ìë°” ê¸°ë³¸ íƒ€ì…ì´ë‚˜ ê°ì²´.
- ì‹ë³„ìê°€ ì—†ê³  ê°’ë§Œ ìˆìœ¼ë¯€ë¡œ ë³€ê²½ì‹œ ì¶”ì  ë¶ˆê°€. (ì™„ì „íˆ ë‹¤ë¥¸ ê°’ìœ¼ë¡œ ëŒ€ì²´ ë¨.)
- ëª¨ë“  ê°’ íƒ€ì…ì€, í•´ë‹¹ ê°’ì„ ì†Œìœ í•œ ì—”í‹°í‹°ì˜ ìƒëª…ì£¼ê¸°ì— ì˜ì¡´.

- ### â˜ï¸ï¸ ê¸°ë³¸ ê°’ íƒ€ì…
    - ìë°” ê¸°ë³¸íƒ€ì…, ë˜í¼ í´ë˜ìŠ¤, String
    - ìƒëª… ì£¼ê¸°ë¥¼ ì—”í‹°í‹°ì— ì˜ì¡´
    - ê¸°ë³¸ ê°’ íƒ€ì…ì€ ê³µìœ ë˜ì§€ ì•ŠëŠ”ë‹¤.(ë˜í¼ í´ë˜ìŠ¤, Stringì€ ê³µìœ ëŠ” ë˜ë‚˜ ë³€ê²½í•  ìˆ˜ ì—†ëŠ” ê°’.)
    
- ### â˜ï¸ï¸ ì„ë² ë””ë“œ íƒ€ì…(embedded type, ë³µí•© ê°’ íƒ€ì…)
    > ![img_17.png](img/img_17.png)
    - DB ì…ì¥ì—ì„œëŠ” ë°”ë€ŒëŠ” ê²ƒì´ ì—†ë‹¤.   
    - classë¥¼ ì´ìš©í•œ ì»¤ìŠ¤í…€ ê°’( ex) ì£¼ì†Œ(city,zipcode ..ë¥¼ ë¬¶ì–´ë‚¸).
    - @Embeddableë¡œ ê°’ì„ ì •ì˜, @Embeddedë¡œ ê°’ íƒ€ì…ì„ ì‚¬ìš©.
      ```java
        @Embeddable
        public class Address {
            private String city;
        
            private String street;
    
            @Column(name = "zcode")
            private String zipcode;
        }
      ```
      ```java
        @Embedded
        private Address homeAddress;
      ```
    - AttributeOverridesë¥¼ ì‚¬ìš©í•˜ì—¬ ê°™ì€ ì„ë² ë””ë“œ íƒ€ì… ì—¬ëŸ¬ê°œ ì‚¬ìš©ê°€ëŠ¥. (ì»¬ëŸ¼ëª…ì„ ì¬ì •ì˜)
      ```java
        @Embedded
        @AttributeOverrides({
                @AttributeOverride(name = "city", column = @Column(name = "work_city")),
                @AttributeOverride(name = "street", column = @Column(name = "work_street")),
                @AttributeOverride(name = "zipcode", column = @Column(name = "work_zipcode"))
        })
        private Address workAddress;
      ```
    - ê¸°ë³¸ ìƒì„±ì í•„ìˆ˜.
    - ì£¼ë¡œ ê¸°ë³¸ê°’ íƒ€ì…ì„ ëª¨ì•„ ë§Œë“¤ì–´ì„œ ë³µí•© ê°’ íƒ€ì…ì´ë¼ê³ ë„ í•œë‹¤.
    
    > ğŸ‘ ì¥ì 
    > - ì¬ì‚¬ìš© ê°€ëŠ¥, ë†’ì€ ì‘ì§‘ë„
    > - ê°’ íƒ€ì…ë§Œ ì‚¬ìš©í•˜ëŠ” ì˜ë¯¸ ìˆëŠ” ë©”ì†Œë“œë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤. (Point.moveLeft(1))
  
    ![img_18.png](img/img_18.png)
    - ì„ë² ë””ë“œ íƒ€ì…ì€ ì„ë² ë””ë“œ íƒ€ì…ì„ ê°€ì§ˆ ìˆ˜ ìˆë‹¤.
    - ì„ë² ë””ë“œ íƒ€ì…ì€ ì—”í‹°í‹° ë˜í•œ ê°€ì§ˆ ìˆ˜ ìˆë‹¤.
    
    #### ğŸ–  ì„ë² ë””ë“œ íƒ€ì…ì€ ê³µìœ ë¡œ ì¸í•œ Side Effectê°€ ë°œìƒí•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ì£¼ì˜.
    ![img_19.png](img/img_19.png)
    - ë©¤ë²„1 ê³¼ ë©¤ë²„2ê°€ ê°™ì€ Address ê°ì²´ë¥¼ ê³µìœ í•˜ê²Œ ë˜ë©´ address í•„ë“œì—ì„œ ê°’ì„ ë³€ê²½í•˜ë©´ ë‘˜ë‹¤ í•¨ê»˜ ë³€ê²½ëœë‹¤.
    - ì˜ë„ì ìœ¼ë¡œ ê³µìœ í•˜ê³  ì‹¶ë‹¤ë©´ ì„ë² ë””ë“œ íƒ€ì…ì´ ì•„ë‹Œ ì—”í‹°í‹°ë¥¼ ë§Œë“¤ì–´ ê³µìœ í•´ì•¼ í•œë‹¤.
    - ê°™ì€ ê°’ë§Œì„ ì‚¬ìš©í•˜ê³  ì‹¶ë‹¤ë©´ ì°¸ì¡°ê°€ ì•„ë‹Œ ê°ì²´ë¥¼ ë³µì‚¬í•˜ì—¬ ì‚¬ìš©í•´ì•¼í•œë‹¤.
      
        ```
        ğŸ¤” ê°ì²´ íƒ€ì…ì˜ í•œê³„ : ê°ì²´ íƒ€ì…ì˜ ì°¸ì¡°ê°’ì„ ëŒ€ì…í•˜ëŠ” ê²ƒì„ ì›ì²œì ìœ¼ë¡œ ë§‰ì„ ë°©ë²•ì´ ì—†ë‹¤.
            - ê°ì²´íƒ€ì…ì„ ë¶ˆë³€ ê°ì²´ë¡œ ì„¤ê³„í•´ì•¼ í•œë‹¤.
            - ë¶ˆë³€ ê°ì²´(Immutable Object) : ìƒì„± ì´í›„ ì ˆëŒ€ ê°’ì„ ë³€ê²½í•  ìˆ˜ ì—†ëŠ” ê°ì²´. ìƒì„±ìë¡œ ê°’ì„ ì„¤ì •, setterë¥¼ ë§Œë“¤ì§€ ì•ŠëŠ”ë‹¤.(or private)
            - ë¶ˆë³€ ê°ì²´ì˜ ê°’ì„ ë³€ê²½í•˜ê³  ì‹¶ì„ ë• ê°ì²´ë¥¼ ìƒˆë¡œ ìƒì„±í•´ì•¼ í•œë‹¤.
        ```
    
    #### ğŸ– ê°’ íƒ€ì…ì˜ ë¹„êµëŠ” ë‚´ìš©ì´ ê°™ë‹¤ë©´ trueê°€ ë‚˜ì™€ì•¼ í•œë‹¤.
        - ê·¸ëŸ¬ë‚˜ ì„ë² ë””ë“œ íƒ€ì…ì€ ê°ì²´ì˜ ì°¸ì¡°ë¥¼ ë¹„êµí•˜ê¸° ë•Œë¬¸ì— falseê°€ ë‚˜ì˜¨ë‹¤. ë•Œë¬¸ì— ë™ë“±ì„± ë¹„êµ(equals)ë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤.
        - ê°ì²´ íƒ€ì…ì˜ ë™ë“±ì„± ë¹„êµëŠ” ê¸°ë³¸ì ìœ¼ë¡œ'==' ë¹„êµì´ê¸° ë•Œë¬¸ì— equals() & hashCode() ë©”ì„œë“œì˜ ì¬ì •ì˜ê°€ í•„ìš”í•˜ë‹¤.
            (í”„ë¡ì‹œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ getterë¥¼ ì‚¬ìš©í•˜ë„ë¡ ì¬ì •ì˜. - í”„ë¡ì‹œë¥¼ ì‚¬ìš©í•  ë•Œ getterë¥¼ ì‚¬ìš©í•˜ë©´ ì›ë˜ ê°ì²´ë¥¼ ì°¾ì•„ê°ˆ ìˆ˜ ìˆë‹¤.)
                
    
    

     
 
- ### â˜ï¸ ì»¬ë ‰ì…˜ ê°’ íƒ€ì…(collection value type)
    - ê°’ íƒ€ì…ì„ ì»¬ë ‰ì…˜ì— ë‹´ì•„ ì‚¬ìš©.
    > ![img_20.png](img/img_20.png)
    > - DBì˜ ì…ì¥ì—ì„œëŠ” ìƒˆë¡œìš´ í…Œì´ë¸”ì´ í•˜ë‚˜ ìƒê¸°ê³  ë§ˆì¹˜ ì¼ëŒ€ë‹¤ì™€ ê°™ì€ ê´€ê³„ë¥¼ í˜•ì„±í•œë‹¤.
    > - ëª¨ë“  í•„ë“œì˜ ì¡°í•©ìœ¼ë¡œ PKê°€ ëœë‹¤(íŠ¹ì • ê°’í•˜ë‚˜ë¡œ PKë¥¼ ì§€ì •í•˜ê²Œ ë˜ë©´ ì´ê²ƒì€ ê°’ íƒ€ì…ì´ ì•„ë‹Œ ì—”í‹°í‹°ë‹¤.)
    
    - ```@ElementCollection```
    - í…Œì´ë¸” ëª… ì§€ì • : ```@CollectionTable(name = "table_name")```
    - ì™¸ë˜í‚¤ ì§€ì • : @CollectionTableì˜ ì†ì„±ìœ¼ë¡œ ```joinColumns = @JoinColumn(name = "column_name")```
    - ì»¬ëŸ¼ ëª… ì§€ì •(ê¸°ë³¸ ê°’ íƒ€ì…) : ```@Column(name = "column_name")```
    - ì»¬ëŸ¼ ëª… ì§€ì •(ì„ë² ë””ë“œ ê°’ íƒ€ì…) : ```@AttributeOverrides``` ì‚¬ìš© ì„ë² ë””ë“œ ê°’ íƒ€ì… ì„¤ëª… ì°¸ì¡°.
        ```java
        @ElementCollection
        @CollectionTable(name = "member_favorite_food", joinColumns = @JoinColumn (name = "member_id"))
        @Column(name = "food_name")
        private List<String> favoriteFood = new ArrayList<>();
        
        @OneToMany(mappedBy = "member",cascade = PERSIST)
        private List<Order> orders = new ArrayList<>();
        ```    
    - ê°’ íƒ€ì… ì»¬ë ‰ì…˜ì€ ì—”í‹°í‹°ì˜ ë¼ì´í”„ ì‚¬ì´í´ì— ì˜ì¡´. ì¦‰, [Cascade] + [OrphanRemovar = true] ì™€ ë™ì¼(ë³„ë„ì˜ persist, update ë“±ì´ í•„ìš” ì—†ë‹¤.)
    - ê°’ íƒ€ì… ì»¬ë ‰ì…˜ë„ ì§€ì—° ë¡œë”© ì „ëµì„ ì‚¬ìš©í•œë‹¤.
    - #### ğŸ– ì»¬ë ‰ ì…˜ ê°’ íƒ€ì…ì˜ ê°’ ìˆ˜ì • : ê°’ íƒ€ì…ì€ ë¶ˆë³€í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— Setterë¥¼ ì´ìš©í•˜ì—¬ ìˆ˜ì •í•˜ì§€ ì•Šê³ , ìƒˆë¡œìš´ ê°ì²´ë¥¼ ìƒì„±í•˜ì—¬ ê°’ì„ ë„£ëŠ”ë‹¤. ê¸°ì¡´ ê°ì²´ëŠ” remove
        - equals()) , hashCode()ë¥¼ ì¬ì •ì˜ í–ˆë‹¤ë©´ ```address.remove(new Address("city", "street", "zipcode"))```ì™€ ê°™ì´ ì‚¬ìš©í•˜ì—¬ë„ ë™ë“±í•œ ê°ì²´ë¥¼ ì œê±°í•´ì¤€ë‹¤. 


- #### ğŸ”‘ ê°’ íƒ€ì… ì»¬ë ‰ì…˜ì˜ ì œì•½ ì‚¬í•­
    - ê°’ íƒ€ì…ì€ ì—”í‹°í‹°ì™€ ë‹¬ë¦¬ ì‹ë³„ì ê°œë…ì´ ì—†ë‹¤. ë•Œë¬¸ì— ê°’ì„ ë³€ê²½í•˜ë©´ ì¶”ì ì´ ì–´ë µë‹¤.
    - ê°’ íƒ€ì… ì»¬ë ‰ì…˜ì„ ë³€ê²½í•˜ë©´ ì£¼ì¸ ì—”í‹°í‹°ì™€ ì—°ê´€ëœ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•œ í›„ í˜„ì¬ ë‚¨ì€ ê°’ì„ ëª¨ë‘ ë‹¤ì‹œ ì €ì¥ -> ë§¤ìš° ë¹„íš¨ìœ¨ì .
    - ê°’ íƒ€ì… ì»¬ë ‰ì…˜ì„ ë§¤í•‘í•˜ëŠ” í…Œì´ë¸”ì€ ëª¨ë“  ì»¬ëŸ¼ì„ ë¬¶ì–´ì„œ ê¸°ë³¸í‚¤ë¥¼ êµ¬ì„±.(null ì•ˆë¨, ì¤‘ë³µ ì €ì¥ ì•ˆë¨.)
    
    #### âœï¸ ì‹¤ë¬´ì—ì„œëŠ” ê°’ íƒ€ì… ì»¬ë ‰ì…˜ ëŒ€ì‹ ì— ì¼ëŒ€ë‹¤ ê´€ê³„ë¥¼ ê³ ë ¤í•œë‹¤.(ê°’ íƒ€ì…ì„ ì—”í‹°í‹°ë¡œ ìŠ¹ê¸‰)
        - ì¼ëŒ€ë‹¤ë¥¼ ìœ„í•œ ì—”í‹°í‹°ë¥¼ ë§Œë“¤ê³  ì—”í‹°í‹°ì—ì„œ ê°’ íƒ€ì…ì„ ì‚¬ìš©.(List<Address> -> AddressEntity ì˜ í•„ë“œë¡œ Address íƒ€ì….
        - Cascade + OrphanRemovar = true ì‚¬ìš©.

    


# ğŸ“Œ ê°ì²´ì§€í–¥ ì¿¼ë¦¬ ì–¸ì–´(JPQL)
****
> JPAëŠ” ë‹¤ì–‘í•œ ì¿¼ë¦¬ ë°©ë²•ì„ ì§€ì›
> - JPQL
> - QueryDSL
> - JPA criteria
> - ë„¤ì´í‹°ë¸Œ SQL
> - JDBC API ì§ì ‘ ì‚¬ìš©, Mybatis, SpringJdbcTemplate í•¨ê»˜ ì‚¬ìš©.


## ğŸ§ JPQL
- SQLì„ ì¶”ìƒí™”í•œ ê°ì²´ ì§€í–¥ ì¿¼ë¦¬ ì–¸ì–´.
- ì—”í‹°í‹° ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ ì¿¼ë¦¬
    ```java
    List<Member> resultList = em.createQuery("select m from Member m where m.name like %kim%", Member.class)
            .getResultList();
    ```
- ë¬¸ìì—´ì´ê¸° ë•Œë¬¸ì— ë™ì  ì¿¼ë¦¬ë¥¼ ì‘ì„±í•˜ê¸° ì–´ë µë‹¤.
- QueryDSLì„ ì‚¬ìš©í•˜ì—¬ í•´ê²°.

## ğŸ§ QueryDSL
```java
JPAQueryFactory qeury = new JPAQueryFactory();
QMember m = QMember.member;

List<Member> members = query
        .select(m)
        .from(m)
        .where(m.name.like("kim"))
        .orderBy(m.id.desc())
        .fetch();
```
- ì½”ë“œë¡œ ì‘ì„±ì´ ê°€ëŠ¥í•˜ê¸° ë•Œë¬¸ì— íƒ€ì… ì„¸ì´í”„.
- ì»´íŒŒì¼ íƒ€ì„ì— ì˜¤ë¥˜ ë°œê²¬ ê°€ëŠ¥.
- ë™ì ì¸ ì¿¼ë¦¬ ì‘ì„±ì´ ë” ì‰½ë‹¤.(ë©”ì†Œë“œ ë°˜í™˜ê°’ì„ ì´ìš©í•˜ì—¬ ê°„í¸í•˜ê²Œ ì¶”ì¶œ ê°€ëŠ¥.)
- ê·¸ëŸ¬ë‚˜ ê²°êµ­ ê¸°ë³¸ì ìœ¼ë¡œ JPQLì„ ì•Œì•„ì•¼ í•œë‹¤.

## ğŸ§ ë„¤ì´í‹°ë¸Œ SQL
- JPAê°€ ì œê³µí•˜ëŠ” SQLì„ ì§ì ‘ ì‚¬ìš©.
- JPQLë¡œ í•´ê²°í•  ìˆ˜ ì—†ëŠ” íŠ¹ì • DBì— ì˜ì¡´ì ì¸ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ë•Œ.   
  ex) ì˜¤ë¼í´ì˜ CONNECT BY
- SQLì„ ì‘ì„±í•˜ê³  ```em.createNativeQuery(query, Member.class)```    

## ğŸ§ JDBC ì§ì ‘ ì‚¬ìš©, SpringJdbcTemplate ë“±..
- JPAë¥¼ ì‚¬ìš©í•˜ë©´ì„œ JDBC ì»¤ë„¥ì…˜ì„ ì§ì ‘ ì‚¬ìš©, ë˜ëŠ” ìŠ¤í”„ë§ JdbcTemplate, ë§ˆì´ë°”í‹°ìŠ¤ ë“±ì„ í•¨ê»˜ ì‚¬ìš©.
- ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ì ì ˆí•œ ì‹œì ì— flush í•„ìš”.(JPAì™€ ì—°ê´€ ì—†ëŠ” SQLì„ ì‹¤í–‰í•  ë•Œ - dbconnetcion ì—ì„œ executeë¡œ ì¿¼ë¦¬ ì‹¤í–‰.)


## ğŸ¤” JPQL - ê¸°ë³¸ ë¬¸ë²•ê³¼ ê¸°ëŠ¥
- JPQLì€ SQLì„ ì¶”ìƒí™”í•˜ì—¬ íŠ¹ì • DBì˜ SQLì— ì˜ì¡´í•˜ì§€ ì•ŠëŠ”ë‹¤.
- JPQLì€ ê²°êµ­ SQLë¡œ ë³€í™˜ëœë‹¤.

> ![img_21.png](img/img_21.png)

- ì—”í‹°í‹°ì™€ ì†ì„±ì€ ëŒ€ì†Œë¬¸ìë¥¼ êµ¬ë¶„í•œë‹¤.
- JPQL í‚¤ì›Œë“œëŠ” ëŒ€ì†Œë¬¸ìë¥¼ êµ¬ë¶„í•˜ì§€ ì•ŠëŠ”ë‹¤ (select, FROM ..)
- í…Œì´ë¸” ëª…ì´ ì•„ë‹Œ ì—”í‹°í‹° ì´ë¦„ì„ ì‚¬ìš©í•œë‹¤.
- ë³„ì¹­ì€ í•„ìˆ˜ (Member [as] m, asëŠ” ìƒëµ ê°€ëŠ¥)
- ì§‘í•© ì •ë ¬ ì§€ì›
    ```sql
        select
            count(m),
            sum(m.age),
            avg(m.age)
            max(m.age)
            min(m.age)
        from Member as m
    ```
  
- ### â˜ï¸ TypeQuery, Query
    - TypeQuery : ë°˜í™˜ íƒ€ì…ì´ ëª…í™•í•  ë•Œ ì‚¬ìš©.
      ```java
      TypedQuery<Member> query = em.createQuery("select m from Member m", Member.class); 
      ```
    - Query : ë°˜í™˜ íƒ€ì…ì´ ëª…í™•í•˜ì§€ ì•Šì„ ë•Œ ì‚¬ìš©.
      ```java
      Query query = em.createQuery("select m.age, m.username from Member m");
      ```

- ### â˜ï¸ ê²°ê³¼ ì¡°íšŒ API
    - ê²°ê³¼ê°€ ì»¬ë ‰ì…˜ : query.getResultList(), ë¦¬ìŠ¤íŠ¸ ë°˜í™˜
        - ê²°ê³¼ê°€ ì—†ìœ¼ë©´ **ë¹ˆ ë¦¬ìŠ¤íŠ¸** ë°˜í™˜.
    - ê²°ê³¼ê°€ ì •í™•íˆ í•˜ë‚˜ : query.getSingleResult()
        - ê²°ê³¼ê°€ ì—†ìœ¼ë©´ : javax.persistence.NoResultException
        - ê²°ê³¼ê°€ ë‘ê°œ ì´ìƒ : javax.persistence.NonUniqueResultException
    
- ### â˜ï¸ íŒŒë¼ë¯¸í„° ë°”ì¸ë”© (ì´ë¦„ ê¸°ì¤€, ìœ„ì¹˜ ê¸°ì¤€)
    - ì´ë¦„ ê¸°ì¤€
        ```java
        em.createQuery("select m from Member m where m.username=:username", Member.class);
                    .setParameter("username","kim");
        ```
    - ìœ„ì¹˜ ê¸°ì¤€
        ```java
        em.createQuery("select m from Member m where m.username=?1", Member.class)
                    .setParameter(1, "kim")
        ```
      
# ğŸ“Œ í”„ë¡œì ì…˜
***
- SELECT ì ˆì— ì¡°íšŒí•  ëŒ€ìƒì„ ì§€ì •í•˜ëŠ” ê²ƒ.
- ### â˜ï¸ í”„ë¡œì ì…˜ ëŒ€ìƒ
    - ì—”í‹°í‹° í”„ë¡œì ì…˜ : ```SELECT m FROM Member m```
    - ì—”í‹°í‹° í”„ë¡œì ì…˜ : ```SELECT m.team FROM Member m```
        - ì‹¤ì œ ë‚˜ê°€ëŠ” ì¿¼ë¦¬ì™€ ê°™ê²Œí•˜ê¸° ìœ„í•´ ```SELECT t FROM Member m join m.team t``` ë¡œ ì‘ì„±í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.
    - ìŠ¤ì¹¼ë¼ í”„ë¡œì ì…˜(ìˆ«ì,ë¬¸ì ë“± ê¸°ë³¸ ë°ì´í„° íƒ€ì…)) : ```SELECT m.age, m.username FROM Member m```
    - ì„ë² ë””ë“œ í”„ë¡œì ì…˜ : ```SELECT m.address FROM Member m```
    - DISTINCTë¡œ ì¤‘ë³µ ì œê±° : ```SELECT distinct m.username FROM Member m```
    
- ### â˜ï¸ í•œë²ˆì— ì—¬ëŸ¬ íƒ€ì…ì˜ ê°’ ì¡°íšŒ
    -  ```select m.username, m.age from Member m``` ê³¼ ê°™ì€ ì¿¼ë¦¬.
    
    - #### Query íƒ€ì…ìœ¼ë¡œ ì¡°íšŒ.
      ```java
      List resultList = em.createQuery("select m.age, m.username from Member m")
                .getResultList();
      Object o = resultList.get(0);
      Object[] result = (Object[]) o;
      System.out.println("age : " + result[0]);
      System.out.println("username : " + result[1]);        
      ```
      
    - #### Object[] íƒ€ì…ìœ¼ë¡œ ì¡°íšŒ.
      ```java
      List<Object[]> resultList = em.createQuery("select m.age, m.username from Member m")
                .getResultList();
      Object[] result = resultList.get(0);
      System.out.println("age : " + result[0]);
      System.out.println("username : " + result[1]);
      ```
    - #### new ëª…ë ¹ì–´ë¡œ ì¡°íšŒ.
        - ë‹¨ìˆœ ê°’ì„ DTOë¡œ ë°”ë¡œ ì¡°íšŒ.
        - íŒ¨í‚¤ì§€ëª…ì„ í¬í•¨í•œ ì „ì²´ í´ë˜ìŠ¤ ëª… ì…ë ¥.
        - ìˆœì„œì™€ íƒ€ì…ì´ ì¼ì¹˜í•˜ëŠ” ìƒì„±ì í•„ìš”.
        ```java
        List<MemberDto> results = em.createQuery("select new com.jpql.module.jpql.MemberDto(m.username, m.age) from Member m", MemberDto)
                .getResultList();
        MemberDto memberDto = results.get(0);
        System.out.println("age : " + memberDto.getAge());
        System.out.println("username : " + memberDto.getUsername());
        ```
        
# ğŸ“Œ í˜ì´ì§•
****
- JPAëŠ” í˜ì´ì§•ì„ ë‘ê°œì˜ APIë¡œ ì¶”ìƒí™”.
- ì¡°íšŒ ì‹œì‘ ìœ„ì¹˜: ```setFirstResult(int startPosition)```
- ì¡°íšŒí•  ë°ì´í„° ìˆ˜: ```setMaxResults(int maxResult)```
```java
List<Member> pagingResult = em.createQuery("select m from Member m order by m.age desc", Member.class)
                    .setFirstResult(0)
                    .setMaxResults(23)
                    .getResultList();
```
- í˜ì´ì§• MySQL ë°©ì–¸.
```sql
SELECT
    M.ID AS ID,
    M.AGE AS AGE,
    M.TEAM_ID AS TEAM_ID,
    M.NAME AS NAME       
FROM
     MEMBER M
ORDER BY
    M.AGE DESC LIMIT ?, ?
    
    
```

# ğŸ“Œ ì¡°ì¸
***
```java
 // Inner Join [inner ìƒëµ ê°€ëŠ¥]
em.createQuery("select m from Member m join m.team t");

//left outer join [outer ìƒëµ ê°€ëŠ¥]
em.createQuery("select m from Member m left join m.team t ")

// theta join
em.createQuery("select m from Member m, Team t where m.username = t.name")
```

## ğŸ§ ON ì ˆì„ ì´ìš©í•œ ì¡°ì¸.
- JPA 2.1 ë¶€í„° ì§€ì›
- ì¡°ì¸ ëŒ€ìƒ í•„í„°ë§
     ```sql
    -- í•„í„° : íŒ€ ì´ë¦„ì´ Aì¸ íŒ€ë§Œ ì¡°ì¸.
    select m,t from Member m left join m.team t on t.name = 'A'
    ```
    ```sql
    -- ì‹¤ì œ SQL
    select m.*,t.* 
    from Member m 
        left join team t 
            on m.team_id=t.id and t.name = 'A'
    ```
- ì—°ê´€ê´€ê³„ ì—†ëŠ” ì—”í‹°í‹° ì™¸ë¶€ ì¡°ì¸.
    ```sql
    -- íšŒì› ì´ë¦„ê³¼ íŒ€ì´ë¦„ì´ ê°™ì€ ëŒ€ìƒ ì™¸ë¶€ ì¡°ì¸
    select m, t from Member m left join Team t on m.username = t.name
    ```
    ```sql
    -- ì‹¤ì œ SQL
    select m.*,t.* from Member m left join Team t on m.username = t.name
    ```

# ğŸ“Œ ì„œë¸Œ ì¿¼ë¦¬
### â˜ï¸ ì„œë¸Œ ì¿¼ë¦¬ ì§€ì› í•¨ìˆ˜.
- [NOT] EXISTS (subquery): ì„œë¸Œ ì¿¼ë¦¬ì˜ ê²°ê³¼ê°€ ì¡´ì¬í•˜ë©´ ì°¸.
  ```sql
    -- íŒ€ Aì— ì†Œì†ëœ íšŒì›.
    select m from Member m
    where exist(select t from m.team t where t.name = 'A')
    ```
- {ALL | ANY | SOME} (subquery)
    - ALL: ëª¨ë‘ ë§Œì¡±í•´ì•¼ ì°¸.
    - ANY, SOME: í•˜ë‚˜ë¼ë„ ë§Œì¡±í•˜ë©´ ì°¸.
    ```sql
    -- ì „ì²´ ìƒí’ˆì˜ ì¬ê³ ë³´ë‹¤ ì£¼ë¬¸ëŸ‰ì´ ë§ì€ ì£¼ë¬¸ë“¤
    select o from Order o 
    where o.orderAmout > ALL(select p.stockAmout from Product p)
    ```
    ```sql
    -- ì–´ë–¤ íŒ€ì´ë“  íŒ€ì— ì†Œì†ëœ íšŒì›
    select m from Member m
    where m.team = ANY(select t from Team t)
    ```
- [NOY] IN (subquery): ì„œë¸Œì¿¼ë¦¬ì˜ ê²°ê³¼ì¤‘ í•˜ë‚˜ë¼ë„ ê°™ì€ ê²ƒì´ ìˆìœ¼ë©´ ì°¸.

### â˜ï¸ JPA ì„œë¸Œ ì¿¼ë¦¬ì˜ í•œê³„
- WHERE, HAVING ì ˆì—ì„œë§Œ ì„œë¸Œ ì¿¼ë¦¬ê°€ ì‚¬ìš© ê°€ëŠ¥í•˜ë‹¤.
- SELECT ì ˆì—ì„œë„ ê°€ëŠ¥(í•˜ì´ë²„ë„¤ì´íŠ¸ì—ì„œ ì§€ì›.)
- FROM ì ˆì˜ ì„œë¸Œ ì¿¼ë¦¬ëŠ” í˜„ì¬ JPQLì—ì„œ ë¶ˆê°€ëŠ¥. 
    - ì¡°ì¸ìœ¼ë¡œ í’€ ìˆ˜ ìˆë‹¤ë©´ í’€ì–´ì„œ í•´ê²°.


# ğŸ“Œ JPQL íƒ€ì… í‘œí˜„
***
- ë¬¸ìì—´ : 'Hello', 'She''s'(She's)
- ìˆ«ì : 10L, 10D, 10F
- Boolean : true, false (ëŒ€ì†Œë¬¸ì êµ¬ë¶„ ì—†ìŒ.)
- ENUM : package.MemberType.ADMIN(íŒ¨í‚¤ì§€ëª…ì„ í¬í•¨)
    - ê·¸ëŸ¬ë‚˜ íŒŒë¼ë¯¸í„°ë¡œ ì‚¬ìš©í•˜ê²Œ ë˜ë©´
        ```.setParameter("userType", MemberType.ADMIN)``` ìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥í•˜ë‹¤.
- ì—”í‹°í‹° íƒ€ì… : ```where type(i) = Book```
    - ìƒì†ê´€ê³„ì—ì„œ ì‚¬ìš©. Itemì„ ìƒì†í•œ ë°›ì€ ê²ƒë“¤ ì¤‘ Book íƒ€ì…ì— í•´ë‹¹í•˜ëŠ” íƒ€ì…ë§Œ ì¡°íšŒ.(Item.DTYPE = Bookìœ¼ë¡œ ì¿¼ë¦¬ ë°œìƒ.)

- ê¸°íƒ€ : EXISTS, IN, AND, OR, NOT, =, >... (BETWEEN i and j), LIKE, IS NULL

# ğŸ“Œ ì¡°ê±´ì‹(CASE ë“±..)
***
- ê¸°ë³¸ CASE ì‹
```java
List<String> resultList4 = em.createQuery("select " +
                    "case " +
                    "when m.age <=19 then 'í•™ìƒìš”ê¸ˆ' " +
                    "when m.age >=60 then 'ê²½ë¡œìš”ê¸ˆ' " +
                    "else 'ì¼ë°˜ìš”ê¸ˆ' " +
                    "end " +
                    "from Member m", String.class)
                    .getResultList();
```
- ë‹¨ìˆœ CASE ì‹
```java
List<String> resultList5 = em.createQuery("select " +
        "case t.name " +
        "when 'TeamA' then '110%' " +
        "when 'TeamB' then '120%' " +
        "else '100%' " +
        "end " +
        "from Team t", String.class)
        .getResultList();
```

- COALESCE : í•˜ë‚˜ì”© ì¡°íšŒí•˜ë©´ nullì´ ì•„ë‹ˆë©´ ë°˜í™˜, nullì´ë©´ ë‘ë²ˆì§¸ ì¸ì ê°’ ë°˜í™˜.
```java
em.createQuery("select coalesce(m.username, 'unknown') from Member m");
```
- NULLIF : ê°’ì´ ë‘ë²ˆì§¸ ì¸ìì™€ ê°™ìœ¼ë©´ nullì„, ë‹¤ë¥´ë‹¤ë©´ ì›ë˜ ê°’ì„ ë°˜í™˜.
```java
em.createQuery("select nullif(m.username, 'ê´€ë¦¬ì') from Member m");
```


# ğŸ“Œ JPQL  í•¨ìˆ˜
***
## ğŸ§ ê¸°ë³¸ í•¨ìˆ˜
- CONCAT : ```select concat('a', 'b') ...```
- SUBSTRING : ```select substring(m.username,0,3) ...```
- TRIM, LOWER, UPPER, LENGTH, ABS, SQRT, MOD
- LOCATE : ì²« ë²ˆì§¸ ì¸ìë¥¼ ë‘ë²ˆì§¸ ì¸ìì—ì„œ ì°¾ì•„ ìœ„ì¹˜ ë°˜í™˜(1ë¶€í„° ì‹œì‘)    
  ```select locate('de','abcdef')```
- SIZE : ì»¬ë ‰ì…˜ì˜ í¬ê¸° ë°˜í™˜    
  ```select size(t.members) from Team t```
    
## ğŸ§ ì‚¬ìš©ì í•¨ìˆ˜
- í•˜ì´ë²„ë„¤ì´íŠ¸ëŠ” ì‚¬ìš©ì „ì— ë°©ì–¸ì„ ìƒì„±í•´ì•¼ í•œë‹¤.
- ê° ë°ì´í„°ë² ì´ìŠ¤ì˜ ë°©ì–¸ì—ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ë‹¤ì–‘í•œ í•¨ìˆ˜ê°€ ì´ë¯¸ ì •ì˜ë˜ì–´ ìˆë‹¤.

> - H2Dialect     
> ![img_22.png](img/img_22.png)

- ### ì‚¬ìš©ì ì •ì˜
```java
public class MyH2Dialect extends H2Dialect {

    public MyH2Dialect() {
        registerFunction("my_concat", new VarArgsSQLFunction(StandardBasicTypes.STRING, "(", "||", ")"));
    }
}
```
> - ë°©ì–¸ì„ ìƒˆë¡œ ìƒì„±í•œ ë°©ì–¸ìœ¼ë¡œ ì‚¬ìš©.
> - ```<property name="hibernate.dialect" value="com.jpql.dialect.MyH2Dialect"/>```
```java
em.createQuery("select function('my_concat', m.username) from Member m", String.class);

// hibernate
em.createQuery("select my_concat(m.username) from Member m", String.class)
```

# ğŸ“Œ ê²½ë¡œ í‘œí˜„ì‹
****
- ì ì„ ì°ì–´ ê°ì²´ ê·¸ë˜í”„ë¥¼ íƒìƒ‰í•˜ëŠ” ê²ƒ.
    
### â˜ï¸ ìƒíƒœ í•„ë“œ
- ```m.username```
- ë‹¨ìˆœíˆ ê°’ì„ ì €ì¥í•˜ê¸° ìœ„í•œ í•„ë“œ
- ê²½ë¡œ íƒìƒ‰ì˜ ë, ë”ì´ìƒ íƒìƒ‰ì´ ë¶ˆê°€ëŠ¥.

### â˜ï¸ ì—°ê´€ í•„ë“œ
- ë‹¨ì¼ ê°’ ì—°ê´€ í•„ë“œ : @ManyToOne, @OneToOne, ëŒ€ìƒì´ ì—”í‹°í‹°
    -  ```m.team```
    - ë¬µì‹œì ì¸ ë‚´ë¶€ ì¡°ì¸ì´ ë°œìƒ, ì¶”ê°€ì  íƒìƒ‰ì´ ê°€ëŠ¥(t.name ..)
        - ```select t from Member m join m.team t```
  
- ì»¬ë ‰ì…˜ ê°’ ì—°ê´€ í•„ë“œ: @OneToMany, @ManyToMant, ëŒ€ìƒì´ ì»¬ë ‰ì…˜
    - ```t.members ```
    - ë¬µì‹œì  ë‚´ë¶€ ì¡°ì¸(inner join)ì´ ë°œìƒ.(ë°œìƒ ì¿¼ë¦¬ë¥¼ ì§ê´€ì ìœ¼ë¡œ ì•Œê¸° ì–´ë µê¸° ë•Œë¬¸ì— ì£¼ì˜.)
    - ë”ì´ìƒ íƒìƒ‰í•  ìˆ˜ ì—†ë‹¤.(FROM ì ˆì—ì„œ ëª…ì‹œì  ì¡°ì¸ì„ í†µí•´ ë³„ì¹­ì„ ì–»ìœ¼ë©´ <mark>ë³„ì¹­ì„ í†µí•´ íƒìƒ‰ ê°€ëŠ¥.</mark>)
        ```sql
        -- member.username ê³¼ ê°™ìœ¼ë¯€ë¡œ ê°€ëŠ¥í•˜ë‹¤.
        select m.username from Team t join t.members m 
        ```
    - .sizeë¡œ ì»¬ë ‰ì…˜ì˜ ì‚¬ì´ì¦ˆëŠ” ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.

ğŸ– <mark>ë¬µì‹œì  ì¡°ì¸ë³´ë‹¤ëŠ” ì¡°ì¸ì„ ì§ì ‘ ëª…ì‹œí•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.</mark>
    

# ğŸ“Œ Fetch Join
***
- JPQLì—ì„œ ì„±ëŠ¥ ìµœì í™”ë¥¼ ìœ„í•´ ì œê³µí•˜ëŠ” ê¸°ëŠ¥.
- ì—°ê´€ëœ ì—”í‹°í‹°ë‚˜ ì»¬ë ‰ì…˜ì„ SQL í•œ ë²ˆì— í•¨ê»˜ ì¡°íšŒí•˜ëŠ” ê¸°ëŠ¥.
- ```[left [outer] | inner] join fetch```
  
### â˜ï¸ ì—”í‹°í‹° í˜ì¹˜ ì¡°ì¸
- íšŒì›ì„ ì¡°íšŒí•˜ë©´ì„œ ì—°ê´€ëœ íŒ€ë„ í•¨ê»˜ ì¡°íšŒ(SQL í•œë²ˆ)

![img_23.png](img/img_23.png)
```sql
select m from Member m join fetch m.team
```
```sql
-- ì‹¤ì œ sql
SELECT M.*, T.* FROM MEMBER M INNER JOIN TEAM T ON M.TEAM_ID=T.ID
```
- Member ë¿ë§Œ ì•„ë‹ˆë¼ Teamë„ í•¨ê»˜ SELECT í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
- í•¨ê»˜ ì¡°íšŒí•˜ì—¬ ê°€ì ¸ì˜¤ê¸° ë•Œë¬¸ì— ì§€ì—° ë¡œë”©ì´ ì ìš©ë˜ì§€ ì•ŠëŠ”ë‹¤.
- N + 1 ì¿¼ë¦¬ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆë‹¤.

### â˜ï¸ ì»¬ë ‰ì…˜ í˜ì¹˜ ì¡°ì¸
![img_25.png](img/img_25.png)
```sql
select t from Team t join fetch t.members;
```
```sql
-- ì‹¤ì œ sql
SELECT T.*, M.* FROM TEAM T INNER JOIN MEMBERM ON T.ID=M.TEAM.ID
```
- ì¼ëŒ€ë‹¤ì˜ ì¡°ì¸ì—ì„œëŠ” ì¤‘ë³µëœ íˆ¬í”Œì´ ìƒê¸°ê²Œ ëœë‹¤. (ê·¸ë¦¼ì²˜ëŸ¼ ë‘ ë©¤ë²„ì˜ íŒ€ì´ ê°™ë‹¤ë©´ ê°™ì€ íŒ€ ë‘ê°œê°€ ì¡°íšŒëœë‹¤.)   
> ![img_24.png](img/img_24.png)

#### ğŸ– ì¤‘ë³µ ê°’ì˜ ì œê±° DISTINCT

```java
em.createQuery("select distinct t from Team t join fetch t.members", Team.class)
```
- ê·¸ëŸ¬ë‚˜ ì‹¤ì œë¡œ íˆ¬í”Œì˜ ê°’ì€ ë‹¤ë¥´ê¸° ë•Œë¬¸ì— SQLì˜ DISTINCTë§Œìœ¼ë¡œëŠ” ëª¨ë‘ ì œê±°í•  ìˆ˜ ì—†ë‹¤.
- JPQLì˜ DISTINCTëŠ” SQLì— DISTINCTë¥¼ ì¶”ê°€í•˜ëŠ” ê²ƒ ë§ê³ ë„ <mark>ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì—”í‹°í‹° ì¤‘ë³µì„ ì œê±°í•˜ëŠ” ê¸°ëŠ¥</mark>ì„ ê°€ì§€ê³  ìˆë‹¤.
> ![img_26.png](img/img_26.png)
> - ì •ìƒì ìœ¼ë¡œ í•˜ë‚˜ë§Œ ì¡°íšŒëœë‹¤ .

## ğŸ§ Fetch Joinì˜ íŠ¹ì§•ê³¼ í•œê³„

### â˜ï¸ íŠ¹ì§•
- #### ì—°ê´€ëœ ì—”í‹°í‹°ë“¤ì„ SQL í•œ ë²ˆìœ¼ë¡œ ëª¨ë‘ ì¡°íšŒí•˜ì—¬ ì„±ëŠ¥ ìµœì í™”.
- #### ì—”í‹°í‹°ì— ì ìš©í•˜ëŠ” ê¸€ë¡œë²Œ ë¡œë”© ì „ëµë³´ë‹¤ ìš°ì„ í•œë‹¤.(fetch = FetchType.LAZY ë“±)
- #### ì‹¤ë¬´ì—ì„œ ê¸€ë¡œë²Œ ë¡œë”© ì „ëµì€ ëª¨ë‘ ì§€ì—° ë¡œë”©, ìµœì í™”ê°€ í•„ìš”í•œ ê³³(N+1)ì—ì„œ í˜ì¹˜ ì¡°ì¸ì„ ì ìš©í•œë‹¤.
- #### í˜ì¹˜ ì¡°ì¸ì€ ì—”í‹°í‹° ê·¸ë˜í”„ë¥¼ ìœ ì§€í•  ë•Œ ì‚¬ìš©í•˜ë©´ íš¨ê³¼ì  (member.team ë“±)
- ì—¬ëŸ¬ í…Œì´ë¸”ì„ ì¡°ì¸í•´ì„œ ì—”í‹°í‹°ê°€ ê°€ì§„ ëª¨ì–‘ì´ ì•„ë‹Œ ì „í˜€ ë‹¤ë¥¸ ê²°ê³¼ë¥¼ ë‚´ì•¼í•œë‹¤ë©´ ì¼ë°˜ ì¡°ì¸ì„ ì‚¬ìš©í•˜ì—¬ í•„ìš”í•œ ë°ì´í„°ë§Œ ì¡°íšŒ, DTOë¡œ ë°˜í™˜í•˜ëŠ” ê²ƒì´ íš¨ê³¼ì ì´ë‹¤.


### â˜ï¸ í•œê³„
- #### í˜ì¹˜ ì¡°ì¸ ëŒ€ìƒì—ëŠ” ë³„ì¹­ì„ ì¤„ ìˆ˜ ì—†ë‹¤.
    - í•˜ì´ë²„ë„¤ì´íŠ¸ì—ì„œëŠ” ê°€ëŠ¥í•˜ì§€ë§Œ ê°€ê¸‰ì  ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê²ƒì´ ì¢‹ë‹¤.
    - ë³„ì¹­ì„ íƒ€ê³  ê·¸ë˜í”„ë¥¼ íƒìƒ‰í•  ë•Œ ë°ì´í„° ì •í•©ì„±ì´ ë§ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤.
- #### ë‘˜ ì´ìƒì˜ ì»¬ë ‰ì…˜ì€ í˜ì¹˜ ì¡°ì¸ í•  ìˆ˜ ì—†ë‹¤.
    - OneToMany í•˜ë‚˜ë§Œ í•´ë„ ë°ì´í„°ê°€ ì¦ê°€, ë‘ê°œë©´ ê³±ìœ¼ë¡œ ë°ì´í„°ê°€ ì¦ê°€í•œë‹¤.
- #### ì»¬ë ‰ì…˜ì„ í˜ì¹˜ ì¡°ì¸ í•˜ë©´ í˜ì´ì§• APIë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤.
    - ì¼ëŒ€ì¼, ë‹¤ëŒ€ì¼ ê°™ì€ ë‹¨ì¼ ê°’ ì—°ê´€ í•„ë“œë“¤ì—ì„œëŠ” ê°€ëŠ¥í•˜ë‹¤.
    - ê·¸ëŸ¬ë‚˜ ì¼ëŒ€ë‹¤ì™€ ê°™ì€ ì»¬ë ‰ì…˜ì—ì„œëŠ” í•˜ì´ë²„ë„¤ì´íŠ¸ì—ì„œ ê²½ê³  ë¡œê·¸ë¥¼ ë‚¨ê¸°ê³  ë©”ëª¨ë¦¬ì—ì„œ í˜ì´ì§•(ë§¤ìš° ìœ„í—˜)
        - í˜ì´ì§€ë¥¼ ë‚˜ëˆŒ ë•Œ í•´ë‹¹ ì»¬ë ‰ì…˜ì˜ ë°ì´í„°ê°€ ì œëŒ€ë¡œ í‘œí˜„ë˜ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤.    
          (TeamA -member1, TeamA - member2 ê°€ ë‹¤ë¥¸ í˜ì´ì§€ì— ìˆë‹¤ë©´ ê° í˜ì´ì§€ì—ì„œëŠ” ìì‹ ì˜ memberë§Œ ìˆëŠ”ê±¸ë¡œ íŒë‹¨.)
    
    #### ğŸ– ì»¬ë ‰ì…˜ì—ì„œ í˜ì´ì§•ì„ í•˜ê³  ì‹¶ë‹¤ë©´?
        - ì¼ë°˜ ì¿¼ë¦¬ë¥¼ ì‘ì„± select t from Team t
            -> N + 1 ì¿¼ë¦¬ ë°œìƒ.
        - ì»¬ë ‰ì…˜ì— @BatchSize(size = n) (n<=1000)
        - ë˜ëŠ” persistence.xmlì—  <property name="hibernate.default_batch_fetch_size" value="100"/>
        - batch sizeì˜ í¬ê¸°ë§Œí¼ ì¿¼ë¦¬ê°€ ë¬¶ì–´ì„œ ë‚˜ê°„ë‹¤ (where team_id in (? ,?, ? ..))
            - ex) Team ê³¼ memberì˜ ê´€ê³„ì—ì„œ batch sizeë§Œí¼ì˜ team.members í•œ ì¿¼ë¦¬ì—ì„œ ì¡°íšŒ.
        - N + 1 -> 2ë²ˆì˜ ì¿¼ë¦¬ë¡œ ê°ì†Œ(íŒ€ ì¡°íšŒì¿¼ë¦¬, ë©¤ë²„ ì¡°íšŒì¿¼ë¦¬)

# ğŸ“Œ ë‹¤í˜•ì„± ì¿¼ë¦¬
***

### â˜ï¸ TYPE
- ì¡°íšŒ ëŒ€ìƒì„ íŠ¹ì • ìì‹ìœ¼ë¡œ í•œì •.
- DTYPEë¡œ ì¿¼ë¦¬.
```sql
-- Item ì¤‘ì— Book, Movie ì¡°íšŒí•´ë¼
select i from Item i where type(i) in (Book,Movie)

--[SQL]
select i from Item i where i.DTYPE in('Book', 'Movie')
```

### â˜ï¸ TREAT
- ìë°”ì˜ íƒ€ì… ì¼€ìŠ¤íŒ…ê³¼ ìœ ì‚¬.
- ìƒì† êµ¬ì¡°ì—ì„œ ë¶€ëª¨ íƒ€ì…ì„ íŠ¹ì • ìì‹ íƒ€ì…ìœ¼ë¡œ ë‹¤ë£° ë•Œ ì‚¬ìš©.
- FROM, WHERE, SELECT ì ˆì—ì„œ ì‚¬ìš©
```sql
--Book íƒ€ì…ì˜ author 
select i from Item i where treat(i as Book).author='kim'

--[SQL]
select i from Item i where i.DTYPE ='book' and i.author ='kim'
```

# ğŸ“Œ ì—”í‹°í‹° ì§ì ‘ ì‚¬ìš©
***
#### - JPQLì—ì„œ ì—”í‹°í‹°ë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ë©´ SQLì—ì„œ í•´ë‹¹ ì—”í‹°í‹°ì˜ ê¸°ë³¸ í‚¤ ê°’ì„ ì‚¬ìš©
```sql
--[JPQL]
select count(m) from Member m

--[ì‹¤í–‰ëœ SQL]
select count(m.id) from Member m
```
```sql
--[JPQL]
select m from Member m where m = :member

--[ì‹¤í–‰ëœ SQL]
select m from Member m where m.id = ?

```
- íŒŒë¼ë¯¸í„°ë¡œ ì—”í‹°í‹° ê°ì²´ë¥¼ ì „ë‹¬í•´ë„ ë§ˆì°¬ê°€ì§€ë¡œ ê¸°ë³¸ í‚¤ ê°’ìœ¼ë¡œ ì¿¼ë¦¬ê°€ ë°œìƒí•œë‹¤.

#### - ì™¸ë˜ í‚¤ ê°’
```sql
--[JPQL]
select  m from Member m where m.team = :team

--[ì‹¤í–‰ëœ SQL]
select m from Member m where m.team_id = ?
```
- ì™¸ë˜í‚¤ ë˜í•œ ì—”í‹°í‹°ë¡œ ì£¼ì–´ì ¸ë„ ë™ì¼í•˜ê²Œ ì ìš©ëœë‹¤.

# ğŸ“Œ Named ì¿¼ë¦¬
***
- ë¯¸ë¦¬ ì •ì˜í•´ë‘ê³  ì´ë¦„ì„ ë¶€ì—¬í•˜ì—¬ ì‚¬ìš©í•˜ëŠ” JPQL
- ì •ì  ì¿¼ë¦¬
- ì–´ë…¸í…Œì´ì…˜ | XMLì— ì •ì˜(ìš°ì„ )
- ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œë”© ì‹œì ì— ì´ˆê¸°í™” í›„ ì¬ì‚¬ìš© ê°€ëŠ¥. -> <mark>íŒŒì‹± í›„ ìºì‹œí•˜ê³  ìˆëŠ”ë‹¤.</mark>
- <mark>ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œë”© ì‹œì ì— ì¿¼ë¦¬ë¥¼ ê²€ì¦í•  ìˆ˜ ìˆì–´ ë¹ ë¥´ê²Œ ì˜¤ë¥˜ ë°œê²¬ ê°€ëŠ¥.</mark>

```java
@NamedQuery(
        name = "Member.findByUsername",
        query = "select m from Member m where  m.username =: username"
)
public class Member {
    ..
}
```
```java
em.createNamedQuery("Member.findByUsername", Member.class)
        .setParameter("username", "kim");
```


# ğŸ“Œ ë²Œí¬ ì—°ì‚°
***
- ì¿¼ë¦¬ í•œë²ˆìœ¼ë¡œ ì—¬ëŸ¬ ë°ì´í„°ì˜ UPDATE, DELETE
- JPA ë³€ê²½ê°ì§€ ê¸°ëŠ¥ìœ¼ë¡œ ì‹¤í–‰í•˜ë ¤ë©´ ë„ˆë¬´ ë§ì€ SQLì´ ì‹¤í–‰ëœë‹¤.
    - ë³€ê²½ëœ ë°ì´í„°ê°€ 100ê±´ì´ë¼ë©´ 100ë²ˆì˜ UPDATE ì¿¼ë¦¬ê°€ ë°œìƒ.
    
```java
int count = em.createQuery("update Member m set age=20")
                .executeUpdate();

int count = em.createQuery("delete from Member m where m.username='kim'")
            .executeUpdate();
```
- countëŠ” ì˜í–¥ì„ ë°›ì€ ì—°ì‚° íšŸìˆ˜.

### ğŸ¤” ì£¼ì˜ í•  ì .
- ë²Œí¬ ì—°ì‚°ì€ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ë¬´ì‹œí•˜ê³  **ë°ì´í„°ë² ì´ìŠ¤ì— ì§ì ‘ ì¿¼ë¦¬**
  (ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì´ë¯¸ ìˆë‹¤ë©´ ë³€ê²½ëœ ê°’ì„ ê°€ì ¸ì˜¤ì§€ ëª»í•œë‹¤.)   
    í•´ê²°: 
    - ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ì €ì¥ ì „ì— ë²Œí¬ ì—°ì‚°ì„ ë¨¼ì € ì‹¤í–‰.
    - ë²Œí¬ ì—°ì‚° ìˆ˜í–‰ í›„ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ì´ˆê¸°í™”.
    

<br><br><br>
> - https://www.inflearn.com/course/ORM-JPA-Basic
> - https://msolo021015.medium.com/jpa-persistence-context-deep-dive-2f36f9bd6214
> - https://m.blog.naver.com/PostView.naver?isHttpsRedirect=true&blogId=heops79&logNo=220734819674